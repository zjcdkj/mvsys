"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/files/[action]";
exports.ids = ["pages/api/files/[action]"];
exports.modules = {

/***/ "@ffmpeg-installer/ffmpeg":
/*!*******************************************!*\
  !*** external "@ffmpeg-installer/ffmpeg" ***!
  \*******************************************/
/***/ ((module) => {

module.exports = require("@ffmpeg-installer/ffmpeg");

/***/ }),

/***/ "fluent-ffmpeg":
/*!********************************!*\
  !*** external "fluent-ffmpeg" ***!
  \********************************/
/***/ ((module) => {

module.exports = require("fluent-ffmpeg");

/***/ }),

/***/ "mongodb":
/*!**************************!*\
  !*** external "mongodb" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("mongodb");

/***/ }),

/***/ "openai":
/*!*************************!*\
  !*** external "openai" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("openai");

/***/ }),

/***/ "formidable":
/*!*****************************!*\
  !*** external "formidable" ***!
  \*****************************/
/***/ ((module) => {

module.exports = import("formidable");;

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "(api)/./pages/api/files/[action].ts":
/*!*************************************!*\
  !*** ./pages/api/files/[action].ts ***!
  \*************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var formidable__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! formidable */ \"formidable\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _utils_videoProcessor__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../utils/videoProcessor */ \"(api)/./utils/videoProcessor.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([formidable__WEBPACK_IMPORTED_MODULE_0__]);\nformidable__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\nconst config = {\n    api: {\n        bodyParser: false\n    }\n};\nconst uploadDir = path__WEBPACK_IMPORTED_MODULE_2___default().join(process.cwd(), \"uploads\");\nconst recordsFile = path__WEBPACK_IMPORTED_MODULE_2___default().join(process.cwd(), \"upload_records.json\");\n// 确保上传目录存在\nif (!fs__WEBPACK_IMPORTED_MODULE_1___default().existsSync(uploadDir)) {\n    fs__WEBPACK_IMPORTED_MODULE_1___default().mkdirSync(uploadDir, {\n        recursive: true\n    });\n}\n// 确保记录文件存在\nif (!fs__WEBPACK_IMPORTED_MODULE_1___default().existsSync(recordsFile)) {\n    fs__WEBPACK_IMPORTED_MODULE_1___default().writeFileSync(recordsFile, JSON.stringify([]));\n}\nasync function handler(req, res) {\n    const { action } = req.query;\n    console.log(`Received ${req.method} request for action: ${action}`);\n    try {\n        switch(action){\n            case \"upload\":\n                if (req.method === \"POST\") {\n                    console.log(\"Processing file upload\");\n                    const form = (0,formidable__WEBPACK_IMPORTED_MODULE_0__[\"default\"])({\n                        uploadDir: uploadDir,\n                        keepExtensions: true,\n                        maxFileSize: 200 * 1024 * 1024\n                    });\n                    form.parse(req, (err, fields, files)=>{\n                        if (err) {\n                            console.error(\"Error parsing form:\", err);\n                            return res.status(500).json({\n                                error: \"Error parsing form data\",\n                                details: err.message\n                            });\n                        }\n                        console.log(\"Form parsed successfully\");\n                        const file = files.file?.[0];\n                        if (!file) {\n                            console.error(\"No file uploaded\");\n                            return res.status(400).json({\n                                error: \"No file uploaded\"\n                            });\n                        }\n                        console.log(\"File received:\", file.originalFilename);\n                        if (file.size > 200 * 1024 * 1024) {\n                            console.error(\"File size exceeds limit:\", file.size);\n                            return res.status(400).json({\n                                error: \"File size exceeds 200MB limit\"\n                            });\n                        }\n                        if (file.mimetype !== \"video/mp4\") {\n                            console.error(\"Invalid file type:\", file.mimetype);\n                            return res.status(400).json({\n                                error: \"Only MP4 files are allowed\"\n                            });\n                        }\n                        // 生成新的文件名\n                        const originalName = path__WEBPACK_IMPORTED_MODULE_2___default().parse(file.originalFilename || \"\").name;\n                        const extension = path__WEBPACK_IMPORTED_MODULE_2___default().parse(file.originalFilename || \"\").ext;\n                        let newFilename = `${originalName}${extension}`;\n                        let counter = 1;\n                        // 检查文件是否已存在，如果存在则重命名\n                        while(fs__WEBPACK_IMPORTED_MODULE_1___default().existsSync(path__WEBPACK_IMPORTED_MODULE_2___default().join(uploadDir, newFilename))){\n                            newFilename = `${originalName}(${counter})${extension}`;\n                            counter++;\n                        }\n                        const newPath = path__WEBPACK_IMPORTED_MODULE_2___default().join(uploadDir, newFilename);\n                        fs__WEBPACK_IMPORTED_MODULE_1___default().renameSync(file.filepath, newPath);\n                        const fileInfo = {\n                            originalName: file.originalFilename,\n                            name: newFilename,\n                            size: file.size,\n                            type: file.mimetype,\n                            uploadedAt: new Date().toISOString()\n                        };\n                        // 添加文件记录\n                        const records = JSON.parse(fs__WEBPACK_IMPORTED_MODULE_1___default().readFileSync(recordsFile, \"utf-8\"));\n                        records.push(fileInfo);\n                        fs__WEBPACK_IMPORTED_MODULE_1___default().writeFileSync(recordsFile, JSON.stringify(records, null, 2));\n                        console.log(\"File uploaded successfully:\", fileInfo);\n                        return res.status(200).json({\n                            message: \"File uploaded successfully\",\n                            fileInfo\n                        });\n                    });\n                } else {\n                    res.setHeader(\"Allow\", [\n                        \"POST\"\n                    ]);\n                    res.status(405).end(`Method ${req.method} Not Allowed`);\n                }\n                break;\n            case \"list\":\n                if (req.method === \"GET\") {\n                    try {\n                        const records = JSON.parse(fs__WEBPACK_IMPORTED_MODULE_1___default().readFileSync(recordsFile, \"utf-8\"));\n                        console.log(\"Records retrieved:\", records); // 添加这行日志\n                        res.status(200).json(records);\n                    } catch (error) {\n                        console.error(\"Error reading records file:\", error);\n                        res.status(500).json({\n                            error: \"Error retrieving file records\"\n                        });\n                    }\n                } else {\n                    res.setHeader(\"Allow\", [\n                        \"GET\"\n                    ]);\n                    res.status(405).end(`Method ${req.method} Not Allowed`);\n                }\n                break;\n            case \"delete\":\n                if (req.method === \"DELETE\") {\n                    // 使用 URL 参数而不是请求体\n                    const { filename } = req.query;\n                    if (!filename || typeof filename !== \"string\") {\n                        return res.status(400).json({\n                            error: \"Filename is required\"\n                        });\n                    }\n                    const filePath = path__WEBPACK_IMPORTED_MODULE_2___default().join(uploadDir, filename);\n                    const audioFilePath = path__WEBPACK_IMPORTED_MODULE_2___default().join(process.cwd(), \"download\", \"mp3\", `${path__WEBPACK_IMPORTED_MODULE_2___default().parse(filename).name}.mp3`);\n                    console.log(\"Attempting to delete file:\", filePath);\n                    if (fs__WEBPACK_IMPORTED_MODULE_1___default().existsSync(filePath)) {\n                        fs__WEBPACK_IMPORTED_MODULE_1___default().unlinkSync(filePath);\n                        console.log(\"Video file deleted successfully\");\n                        // 删除对应的音频文件（如果存在）\n                        if (fs__WEBPACK_IMPORTED_MODULE_1___default().existsSync(audioFilePath)) {\n                            fs__WEBPACK_IMPORTED_MODULE_1___default().unlinkSync(audioFilePath);\n                            console.log(\"Audio file deleted successfully\");\n                        }\n                        // 更新记录文件\n                        const records = JSON.parse(fs__WEBPACK_IMPORTED_MODULE_1___default().readFileSync(recordsFile, \"utf-8\"));\n                        const updatedRecords = records.filter((record)=>record.name !== filename);\n                        fs__WEBPACK_IMPORTED_MODULE_1___default().writeFileSync(recordsFile, JSON.stringify(updatedRecords, null, 2));\n                        res.status(200).json({\n                            message: \"File deleted successfully\"\n                        });\n                    } else {\n                        console.log(\"File not found:\", filePath);\n                        res.status(404).json({\n                            error: \"File not found\"\n                        });\n                    }\n                } else {\n                    res.setHeader(\"Allow\", [\n                        \"DELETE\"\n                    ]);\n                    res.status(405).end(`Method ${req.method} Not Allowed`);\n                }\n                break;\n            case \"rename\":\n                if (req.method === \"PUT\") {\n                    const { oldName, newName } = req.body;\n                    const oldPath = path__WEBPACK_IMPORTED_MODULE_2___default().join(uploadDir, oldName);\n                    const newPath = path__WEBPACK_IMPORTED_MODULE_2___default().join(uploadDir, newName);\n                    if (fs__WEBPACK_IMPORTED_MODULE_1___default().existsSync(oldPath)) {\n                        fs__WEBPACK_IMPORTED_MODULE_1___default().renameSync(oldPath, newPath);\n                        res.status(200).json({\n                            message: \"File renamed successfully\"\n                        });\n                    } else {\n                        res.status(404).json({\n                            error: \"File not found\"\n                        });\n                    }\n                } else {\n                    res.setHeader(\"Allow\", [\n                        \"PUT\"\n                    ]);\n                    res.status(405).end(`Method ${req.method} Not Allowed`);\n                }\n                break;\n            case \"extractAudio\":\n                if (req.method === \"POST\") {\n                    const form = (0,formidable__WEBPACK_IMPORTED_MODULE_0__[\"default\"])();\n                    form.parse(req, async (err, fields, files)=>{\n                        if (err) {\n                            console.error(\"Error parsing form:\", err);\n                            return res.status(500).json({\n                                error: \"Error parsing form data\"\n                            });\n                        }\n                        const filename = Array.isArray(fields.filename) ? fields.filename[0] : fields.filename;\n                        if (!filename) {\n                            return res.status(400).json({\n                                error: \"Filename is required\"\n                            });\n                        }\n                        console.log(\"Extracting audio for file:\", filename);\n                        const videoPath = path__WEBPACK_IMPORTED_MODULE_2___default().join(uploadDir, filename);\n                        console.log(\"Full video path:\", videoPath);\n                        if (!fs__WEBPACK_IMPORTED_MODULE_1___default().existsSync(videoPath)) {\n                            console.error(\"Video file not found:\", videoPath);\n                            return res.status(404).json({\n                                error: \"Video file not found\"\n                            });\n                        }\n                        try {\n                            // 使用 SSE (Server-Sent Events) 来报告进度\n                            res.writeHead(200, {\n                                \"Content-Type\": \"text/event-stream\",\n                                \"Cache-Control\": \"no-cache\",\n                                \"Connection\": \"keep-alive\"\n                            });\n                            const sendProgress = (progress)=>{\n                                res.write(`data: ${JSON.stringify({\n                                    progress\n                                })}\\n\\n`);\n                            };\n                            const audioPath = await (0,_utils_videoProcessor__WEBPACK_IMPORTED_MODULE_3__.extractAudio)(videoPath, sendProgress);\n                            const audioFilename = path__WEBPACK_IMPORTED_MODULE_2___default().basename(audioPath);\n                            console.log(\"Audio extracted successfully:\", audioFilename);\n                            // 获取音频时长\n                            const duration = await (0,_utils_videoProcessor__WEBPACK_IMPORTED_MODULE_3__.getAudioDuration)(audioPath);\n                            // 获取音频文件大小\n                            const { size } = fs__WEBPACK_IMPORTED_MODULE_1___default().statSync(audioPath);\n                            // 更新文件记录\n                            const records = JSON.parse(fs__WEBPACK_IMPORTED_MODULE_1___default().readFileSync(recordsFile, \"utf-8\"));\n                            const updatedRecords = records.map((record)=>{\n                                if (record.name === filename) {\n                                    return {\n                                        ...record,\n                                        audioFile: audioFilename\n                                    };\n                                }\n                                return record;\n                            });\n                            fs__WEBPACK_IMPORTED_MODULE_1___default().writeFileSync(recordsFile, JSON.stringify(updatedRecords, null, 2));\n                            res.write(`data: ${JSON.stringify({\n                                complete: true,\n                                audioFile: audioFilename,\n                                duration,\n                                size\n                            })}\\n\\n`);\n                            res.end();\n                        } catch (error) {\n                            console.error(\"Error extracting audio:\", error);\n                            res.write(`data: ${JSON.stringify({\n                                error: \"Error extracting audio\"\n                            })}\\n\\n`);\n                            res.end();\n                        }\n                    });\n                } else {\n                    res.setHeader(\"Allow\", [\n                        \"POST\"\n                    ]);\n                    res.status(405).end(`Method ${req.method} Not Allowed`);\n                }\n                break;\n            case \"getAudio\":\n                if (req.method === \"GET\") {\n                    const { filename } = req.query;\n                    if (!filename || typeof filename !== \"string\") {\n                        return res.status(400).json({\n                            error: \"Filename is required\"\n                        });\n                    }\n                    const audioPath = path__WEBPACK_IMPORTED_MODULE_2___default().join(process.cwd(), \"download\", \"mp3\", filename);\n                    console.log(\"Attempting to serve audio file:\", audioPath);\n                    if (fs__WEBPACK_IMPORTED_MODULE_1___default().existsSync(audioPath)) {\n                        const stat = fs__WEBPACK_IMPORTED_MODULE_1___default().statSync(audioPath);\n                        res.writeHead(200, {\n                            \"Content-Type\": \"audio/mpeg\",\n                            \"Content-Length\": stat.size\n                        });\n                        const readStream = fs__WEBPACK_IMPORTED_MODULE_1___default().createReadStream(audioPath);\n                        readStream.pipe(res);\n                    } else {\n                        console.log(\"Audio file not found:\", audioPath);\n                        res.status(404).json({\n                            error: \"Audio file not found\"\n                        });\n                    }\n                } else {\n                    res.setHeader(\"Allow\", [\n                        \"GET\"\n                    ]);\n                    res.status(405).end(`Method ${req.method} Not Allowed`);\n                }\n                break;\n            default:\n                console.error(\"Invalid action:\", action);\n                res.status(404).json({\n                    error: \"Action not found\"\n                });\n        }\n    } catch (error) {\n        console.error(\"Unexpected error:\", error);\n        res.status(500).json({\n            error: \"An unexpected error occurred\",\n            details: error.message\n        });\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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O1lBRUY7Z0JBQ0VGLFFBQVFVLEtBQUssQ0FBQyxtQkFBbUJaO2dCQUNqQ0QsSUFBSWMsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztvQkFBRUYsT0FBTztnQkFBbUI7UUFDckQ7SUFDRixFQUFFLE9BQU9BLE9BQU87UUFDZFYsUUFBUVUsS0FBSyxDQUFDLHFCQUFxQkE7UUFDbkNiLElBQUljLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFBRUYsT0FBTztZQUFnQ0csU0FBUyxNQUFpQkMsT0FBTztRQUFDO0lBQ2xHO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly92aWRlby1hbmFseXNpcy1zeXN0ZW0vLi9wYWdlcy9hcGkvZmlsZXMvW2FjdGlvbl0udHM/ZDBiZSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0QXBpUmVxdWVzdCwgTmV4dEFwaVJlc3BvbnNlIH0gZnJvbSAnbmV4dCc7XHJcbmltcG9ydCBmb3JtaWRhYmxlIGZyb20gJ2Zvcm1pZGFibGUnO1xyXG5pbXBvcnQgZnMgZnJvbSAnZnMnO1xyXG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcclxuaW1wb3J0IHsgZXh0cmFjdEF1ZGlvLCBnZXRBdWRpb0R1cmF0aW9uIH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvdmlkZW9Qcm9jZXNzb3InO1xyXG5cclxuLy8g5Zyo5paH5Lu26aG26YOo5re75Yqg6L+Z5Liq5o6l5Y+j5a6a5LmJXHJcbmludGVyZmFjZSBGaWxlSW5mbyB7XHJcbiAgbmFtZTogc3RyaW5nO1xyXG4gIHNpemU6IG51bWJlcjtcclxuICB0eXBlOiBzdHJpbmc7XHJcbiAgdXBsb2FkZWRBdDogc3RyaW5nO1xyXG4gIGF1ZGlvRmlsZT86IHN0cmluZztcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IHtcclxuICBhcGk6IHtcclxuICAgIGJvZHlQYXJzZXI6IGZhbHNlLFxyXG4gIH0sXHJcbn07XHJcblxyXG5jb25zdCB1cGxvYWREaXIgPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJ3VwbG9hZHMnKTtcclxuY29uc3QgcmVjb3Jkc0ZpbGUgPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJ3VwbG9hZF9yZWNvcmRzLmpzb24nKTtcclxuXHJcbi8vIOehruS/neS4iuS8oOebruW9leWtmOWcqFxyXG5pZiAoIWZzLmV4aXN0c1N5bmModXBsb2FkRGlyKSkge1xyXG4gIGZzLm1rZGlyU3luYyh1cGxvYWREaXIsIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xyXG59XHJcblxyXG4vLyDnoa7kv53orrDlvZXmlofku7blrZjlnKhcclxuaWYgKCFmcy5leGlzdHNTeW5jKHJlY29yZHNGaWxlKSkge1xyXG4gIGZzLndyaXRlRmlsZVN5bmMocmVjb3Jkc0ZpbGUsIEpTT04uc3RyaW5naWZ5KFtdKSk7XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZXIocmVxOiBOZXh0QXBpUmVxdWVzdCwgcmVzOiBOZXh0QXBpUmVzcG9uc2UpIHtcclxuICBjb25zdCB7IGFjdGlvbiB9ID0gcmVxLnF1ZXJ5O1xyXG5cclxuICBjb25zb2xlLmxvZyhgUmVjZWl2ZWQgJHtyZXEubWV0aG9kfSByZXF1ZXN0IGZvciBhY3Rpb246ICR7YWN0aW9ufWApO1xyXG5cclxuICB0cnkge1xyXG4gICAgc3dpdGNoIChhY3Rpb24pIHtcclxuICAgICAgY2FzZSAndXBsb2FkJzpcclxuICAgICAgICBpZiAocmVxLm1ldGhvZCA9PT0gJ1BPU1QnKSB7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZygnUHJvY2Vzc2luZyBmaWxlIHVwbG9hZCcpO1xyXG4gICAgICAgICAgY29uc3QgZm9ybSA9IGZvcm1pZGFibGUoe1xyXG4gICAgICAgICAgICB1cGxvYWREaXI6IHVwbG9hZERpcixcclxuICAgICAgICAgICAga2VlcEV4dGVuc2lvbnM6IHRydWUsXHJcbiAgICAgICAgICAgIG1heEZpbGVTaXplOiAyMDAgKiAxMDI0ICogMTAyNCwgLy8gMjAwTUJcclxuICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgIGZvcm0ucGFyc2UocmVxLCAoZXJyLCBmaWVsZHMsIGZpbGVzKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChlcnIpIHtcclxuICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBwYXJzaW5nIGZvcm06JywgZXJyKTtcclxuICAgICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oeyBlcnJvcjogJ0Vycm9yIHBhcnNpbmcgZm9ybSBkYXRhJywgZGV0YWlsczogZXJyLm1lc3NhZ2UgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdGb3JtIHBhcnNlZCBzdWNjZXNzZnVsbHknKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGZpbGUgPSBmaWxlcy5maWxlPy5bMF07XHJcbiAgICAgICAgICAgIGlmICghZmlsZSkge1xyXG4gICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ05vIGZpbGUgdXBsb2FkZWQnKTtcclxuICAgICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogJ05vIGZpbGUgdXBsb2FkZWQnIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnRmlsZSByZWNlaXZlZDonLCBmaWxlLm9yaWdpbmFsRmlsZW5hbWUpO1xyXG5cclxuICAgICAgICAgICAgaWYgKGZpbGUuc2l6ZSA+IDIwMCAqIDEwMjQgKiAxMDI0KSB7XHJcbiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignRmlsZSBzaXplIGV4Y2VlZHMgbGltaXQ6JywgZmlsZS5zaXplKTtcclxuICAgICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogJ0ZpbGUgc2l6ZSBleGNlZWRzIDIwME1CIGxpbWl0JyB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGZpbGUubWltZXR5cGUgIT09ICd2aWRlby9tcDQnKSB7XHJcbiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignSW52YWxpZCBmaWxlIHR5cGU6JywgZmlsZS5taW1ldHlwZSk7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6ICdPbmx5IE1QNCBmaWxlcyBhcmUgYWxsb3dlZCcgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIOeUn+aIkOaWsOeahOaWh+S7tuWQjVxyXG4gICAgICAgICAgICBjb25zdCBvcmlnaW5hbE5hbWUgPSBwYXRoLnBhcnNlKGZpbGUub3JpZ2luYWxGaWxlbmFtZSB8fCAnJykubmFtZTtcclxuICAgICAgICAgICAgY29uc3QgZXh0ZW5zaW9uID0gcGF0aC5wYXJzZShmaWxlLm9yaWdpbmFsRmlsZW5hbWUgfHwgJycpLmV4dDtcclxuICAgICAgICAgICAgbGV0IG5ld0ZpbGVuYW1lID0gYCR7b3JpZ2luYWxOYW1lfSR7ZXh0ZW5zaW9ufWA7XHJcbiAgICAgICAgICAgIGxldCBjb3VudGVyID0gMTtcclxuXHJcbiAgICAgICAgICAgIC8vIOajgOafpeaWh+S7tuaYr+WQpuW3suWtmOWcqO+8jOWmguaenOWtmOWcqOWImemHjeWRveWQjVxyXG4gICAgICAgICAgICB3aGlsZSAoZnMuZXhpc3RzU3luYyhwYXRoLmpvaW4odXBsb2FkRGlyLCBuZXdGaWxlbmFtZSkpKSB7XHJcbiAgICAgICAgICAgICAgbmV3RmlsZW5hbWUgPSBgJHtvcmlnaW5hbE5hbWV9KCR7Y291bnRlcn0pJHtleHRlbnNpb259YDtcclxuICAgICAgICAgICAgICBjb3VudGVyKys7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNvbnN0IG5ld1BhdGggPSBwYXRoLmpvaW4odXBsb2FkRGlyLCBuZXdGaWxlbmFtZSk7XHJcbiAgICAgICAgICAgIGZzLnJlbmFtZVN5bmMoZmlsZS5maWxlcGF0aCwgbmV3UGF0aCk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBmaWxlSW5mbyA9IHtcclxuICAgICAgICAgICAgICBvcmlnaW5hbE5hbWU6IGZpbGUub3JpZ2luYWxGaWxlbmFtZSxcclxuICAgICAgICAgICAgICBuYW1lOiBuZXdGaWxlbmFtZSxcclxuICAgICAgICAgICAgICBzaXplOiBmaWxlLnNpemUsXHJcbiAgICAgICAgICAgICAgdHlwZTogZmlsZS5taW1ldHlwZSxcclxuICAgICAgICAgICAgICB1cGxvYWRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAvLyDmt7vliqDmlofku7borrDlvZVcclxuICAgICAgICAgICAgY29uc3QgcmVjb3JkcyA9IEpTT04ucGFyc2UoZnMucmVhZEZpbGVTeW5jKHJlY29yZHNGaWxlLCAndXRmLTgnKSk7XHJcbiAgICAgICAgICAgIHJlY29yZHMucHVzaChmaWxlSW5mbyk7XHJcbiAgICAgICAgICAgIGZzLndyaXRlRmlsZVN5bmMocmVjb3Jkc0ZpbGUsIEpTT04uc3RyaW5naWZ5KHJlY29yZHMsIG51bGwsIDIpKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdGaWxlIHVwbG9hZGVkIHN1Y2Nlc3NmdWxseTonLCBmaWxlSW5mbyk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oeyBtZXNzYWdlOiAnRmlsZSB1cGxvYWRlZCBzdWNjZXNzZnVsbHknLCBmaWxlSW5mbyB9KTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZXMuc2V0SGVhZGVyKCdBbGxvdycsIFsnUE9TVCddKTtcclxuICAgICAgICAgIHJlcy5zdGF0dXMoNDA1KS5lbmQoYE1ldGhvZCAke3JlcS5tZXRob2R9IE5vdCBBbGxvd2VkYCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgY2FzZSAnbGlzdCc6XHJcbiAgICAgICAgaWYgKHJlcS5tZXRob2QgPT09ICdHRVQnKSB7XHJcbiAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb25zdCByZWNvcmRzID0gSlNPTi5wYXJzZShmcy5yZWFkRmlsZVN5bmMocmVjb3Jkc0ZpbGUsICd1dGYtOCcpKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1JlY29yZHMgcmV0cmlldmVkOicsIHJlY29yZHMpOyAvLyDmt7vliqDov5nooYzml6Xlv5dcclxuICAgICAgICAgICAgcmVzLnN0YXR1cygyMDApLmpzb24ocmVjb3Jkcyk7XHJcbiAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciByZWFkaW5nIHJlY29yZHMgZmlsZTonLCBlcnJvcik7XHJcbiAgICAgICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6ICdFcnJvciByZXRyaWV2aW5nIGZpbGUgcmVjb3JkcycgfSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJlcy5zZXRIZWFkZXIoJ0FsbG93JywgWydHRVQnXSk7XHJcbiAgICAgICAgICByZXMuc3RhdHVzKDQwNSkuZW5kKGBNZXRob2QgJHtyZXEubWV0aG9kfSBOb3QgQWxsb3dlZGApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBicmVhaztcclxuXHJcbiAgICAgIGNhc2UgJ2RlbGV0ZSc6XHJcbiAgICAgICAgaWYgKHJlcS5tZXRob2QgPT09ICdERUxFVEUnKSB7XHJcbiAgICAgICAgICAvLyDkvb/nlKggVVJMIOWPguaVsOiAjOS4jeaYr+ivt+axguS9k1xyXG4gICAgICAgICAgY29uc3QgeyBmaWxlbmFtZSB9ID0gcmVxLnF1ZXJ5O1xyXG4gICAgICAgICAgaWYgKCFmaWxlbmFtZSB8fCB0eXBlb2YgZmlsZW5hbWUgIT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiAnRmlsZW5hbWUgaXMgcmVxdWlyZWQnIH0pO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIGNvbnN0IGZpbGVQYXRoID0gcGF0aC5qb2luKHVwbG9hZERpciwgZmlsZW5hbWUpO1xyXG4gICAgICAgICAgY29uc3QgYXVkaW9GaWxlUGF0aCA9IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCAnZG93bmxvYWQnLCAnbXAzJywgYCR7cGF0aC5wYXJzZShmaWxlbmFtZSkubmFtZX0ubXAzYCk7XHJcbiAgICAgICAgICBcclxuICAgICAgICAgIGNvbnNvbGUubG9nKCdBdHRlbXB0aW5nIHRvIGRlbGV0ZSBmaWxlOicsIGZpbGVQYXRoKTtcclxuICAgICAgICAgIFxyXG4gICAgICAgICAgaWYgKGZzLmV4aXN0c1N5bmMoZmlsZVBhdGgpKSB7XHJcbiAgICAgICAgICAgIGZzLnVubGlua1N5bmMoZmlsZVBhdGgpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnVmlkZW8gZmlsZSBkZWxldGVkIHN1Y2Nlc3NmdWxseScpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8g5Yig6Zmk5a+55bqU55qE6Z+z6aKR5paH5Lu277yI5aaC5p6c5a2Y5Zyo77yJXHJcbiAgICAgICAgICAgIGlmIChmcy5leGlzdHNTeW5jKGF1ZGlvRmlsZVBhdGgpKSB7XHJcbiAgICAgICAgICAgICAgZnMudW5saW5rU3luYyhhdWRpb0ZpbGVQYXRoKTtcclxuICAgICAgICAgICAgICBjb25zb2xlLmxvZygnQXVkaW8gZmlsZSBkZWxldGVkIHN1Y2Nlc3NmdWxseScpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyDmm7TmlrDorrDlvZXmlofku7ZcclxuICAgICAgICAgICAgY29uc3QgcmVjb3JkcyA9IEpTT04ucGFyc2UoZnMucmVhZEZpbGVTeW5jKHJlY29yZHNGaWxlLCAndXRmLTgnKSk7XHJcbiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZWRSZWNvcmRzID0gcmVjb3Jkcy5maWx0ZXIoKHJlY29yZDogRmlsZUluZm8pID0+IHJlY29yZC5uYW1lICE9PSBmaWxlbmFtZSk7XHJcbiAgICAgICAgICAgIGZzLndyaXRlRmlsZVN5bmMocmVjb3Jkc0ZpbGUsIEpTT04uc3RyaW5naWZ5KHVwZGF0ZWRSZWNvcmRzLCBudWxsLCAyKSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICByZXMuc3RhdHVzKDIwMCkuanNvbih7IG1lc3NhZ2U6ICdGaWxlIGRlbGV0ZWQgc3VjY2Vzc2Z1bGx5JyB9KTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdGaWxlIG5vdCBmb3VuZDonLCBmaWxlUGF0aCk7XHJcbiAgICAgICAgICAgIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgZXJyb3I6ICdGaWxlIG5vdCBmb3VuZCcgfSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJlcy5zZXRIZWFkZXIoJ0FsbG93JywgWydERUxFVEUnXSk7XHJcbiAgICAgICAgICByZXMuc3RhdHVzKDQwNSkuZW5kKGBNZXRob2QgJHtyZXEubWV0aG9kfSBOb3QgQWxsb3dlZGApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBicmVhaztcclxuXHJcbiAgICAgIGNhc2UgJ3JlbmFtZSc6XHJcbiAgICAgICAgaWYgKHJlcS5tZXRob2QgPT09ICdQVVQnKSB7XHJcbiAgICAgICAgICBjb25zdCB7IG9sZE5hbWUsIG5ld05hbWUgfSA9IHJlcS5ib2R5O1xyXG4gICAgICAgICAgY29uc3Qgb2xkUGF0aCA9IHBhdGguam9pbih1cGxvYWREaXIsIG9sZE5hbWUpO1xyXG4gICAgICAgICAgY29uc3QgbmV3UGF0aCA9IHBhdGguam9pbih1cGxvYWREaXIsIG5ld05hbWUpO1xyXG4gICAgICAgICAgaWYgKGZzLmV4aXN0c1N5bmMob2xkUGF0aCkpIHtcclxuICAgICAgICAgICAgZnMucmVuYW1lU3luYyhvbGRQYXRoLCBuZXdQYXRoKTtcclxuICAgICAgICAgICAgcmVzLnN0YXR1cygyMDApLmpzb24oeyBtZXNzYWdlOiAnRmlsZSByZW5hbWVkIHN1Y2Nlc3NmdWxseScgfSk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXMuc3RhdHVzKDQwNCkuanNvbih7IGVycm9yOiAnRmlsZSBub3QgZm91bmQnIH0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZXMuc2V0SGVhZGVyKCdBbGxvdycsIFsnUFVUJ10pO1xyXG4gICAgICAgICAgcmVzLnN0YXR1cyg0MDUpLmVuZChgTWV0aG9kICR7cmVxLm1ldGhvZH0gTm90IEFsbG93ZWRgKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICBjYXNlICdleHRyYWN0QXVkaW8nOlxyXG4gICAgICAgIGlmIChyZXEubWV0aG9kID09PSAnUE9TVCcpIHtcclxuICAgICAgICAgIGNvbnN0IGZvcm0gPSBmb3JtaWRhYmxlKCk7XHJcbiAgICAgICAgICBmb3JtLnBhcnNlKHJlcSwgYXN5bmMgKGVyciwgZmllbGRzLCBmaWxlcykgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgcGFyc2luZyBmb3JtOicsIGVycik7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6ICdFcnJvciBwYXJzaW5nIGZvcm0gZGF0YScgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGZpbGVuYW1lID0gQXJyYXkuaXNBcnJheShmaWVsZHMuZmlsZW5hbWUpID8gZmllbGRzLmZpbGVuYW1lWzBdIDogZmllbGRzLmZpbGVuYW1lO1xyXG4gICAgICAgICAgICBpZiAoIWZpbGVuYW1lKSB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6ICdGaWxlbmFtZSBpcyByZXF1aXJlZCcgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdFeHRyYWN0aW5nIGF1ZGlvIGZvciBmaWxlOicsIGZpbGVuYW1lKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHZpZGVvUGF0aCA9IHBhdGguam9pbih1cGxvYWREaXIsIGZpbGVuYW1lKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ0Z1bGwgdmlkZW8gcGF0aDonLCB2aWRlb1BhdGgpO1xyXG5cclxuICAgICAgICAgICAgaWYgKCFmcy5leGlzdHNTeW5jKHZpZGVvUGF0aCkpIHtcclxuICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdWaWRlbyBmaWxlIG5vdCBmb3VuZDonLCB2aWRlb1BhdGgpO1xyXG4gICAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IGVycm9yOiAnVmlkZW8gZmlsZSBub3QgZm91bmQnIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgIC8vIOS9v+eUqCBTU0UgKFNlcnZlci1TZW50IEV2ZW50cykg5p2l5oql5ZGK6L+b5bqmXHJcbiAgICAgICAgICAgICAgcmVzLndyaXRlSGVhZCgyMDAsIHtcclxuICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAndGV4dC9ldmVudC1zdHJlYW0nLFxyXG4gICAgICAgICAgICAgICAgJ0NhY2hlLUNvbnRyb2wnOiAnbm8tY2FjaGUnLFxyXG4gICAgICAgICAgICAgICAgJ0Nvbm5lY3Rpb24nOiAna2VlcC1hbGl2ZSdcclxuICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgY29uc3Qgc2VuZFByb2dyZXNzID0gKHByb2dyZXNzOiBudW1iZXIpID0+IHtcclxuICAgICAgICAgICAgICAgIHJlcy53cml0ZShgZGF0YTogJHtKU09OLnN0cmluZ2lmeSh7IHByb2dyZXNzIH0pfVxcblxcbmApO1xyXG4gICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgIGNvbnN0IGF1ZGlvUGF0aCA9IGF3YWl0IGV4dHJhY3RBdWRpbyh2aWRlb1BhdGgsIHNlbmRQcm9ncmVzcyk7XHJcbiAgICAgICAgICAgICAgY29uc3QgYXVkaW9GaWxlbmFtZSA9IHBhdGguYmFzZW5hbWUoYXVkaW9QYXRoKTtcclxuICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICBjb25zb2xlLmxvZygnQXVkaW8gZXh0cmFjdGVkIHN1Y2Nlc3NmdWxseTonLCBhdWRpb0ZpbGVuYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgLy8g6I635Y+W6Z+z6aKR5pe26ZW/XHJcbiAgICAgICAgICAgICAgY29uc3QgZHVyYXRpb24gPSBhd2FpdCBnZXRBdWRpb0R1cmF0aW9uKGF1ZGlvUGF0aCk7XHJcblxyXG4gICAgICAgICAgICAgIC8vIOiOt+WPlumfs+mikeaWh+S7tuWkp+Wwj1xyXG4gICAgICAgICAgICAgIGNvbnN0IHsgc2l6ZSB9ID0gZnMuc3RhdFN5bmMoYXVkaW9QYXRoKTtcclxuXHJcbiAgICAgICAgICAgICAgLy8g5pu05paw5paH5Lu26K6w5b2VXHJcbiAgICAgICAgICAgICAgY29uc3QgcmVjb3JkcyA9IEpTT04ucGFyc2UoZnMucmVhZEZpbGVTeW5jKHJlY29yZHNGaWxlLCAndXRmLTgnKSk7XHJcbiAgICAgICAgICAgICAgY29uc3QgdXBkYXRlZFJlY29yZHMgPSByZWNvcmRzLm1hcCgocmVjb3JkOiBGaWxlSW5mbykgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlY29yZC5uYW1lID09PSBmaWxlbmFtZSkge1xyXG4gICAgICAgICAgICAgICAgICByZXR1cm4geyAuLi5yZWNvcmQsIGF1ZGlvRmlsZTogYXVkaW9GaWxlbmFtZSB9O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlY29yZDtcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICBmcy53cml0ZUZpbGVTeW5jKHJlY29yZHNGaWxlLCBKU09OLnN0cmluZ2lmeSh1cGRhdGVkUmVjb3JkcywgbnVsbCwgMikpO1xyXG5cclxuICAgICAgICAgICAgICByZXMud3JpdGUoYGRhdGE6ICR7SlNPTi5zdHJpbmdpZnkoeyBjb21wbGV0ZTogdHJ1ZSwgYXVkaW9GaWxlOiBhdWRpb0ZpbGVuYW1lLCBkdXJhdGlvbiwgc2l6ZSB9KX1cXG5cXG5gKTtcclxuICAgICAgICAgICAgICByZXMuZW5kKCk7XHJcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZXh0cmFjdGluZyBhdWRpbzonLCBlcnJvcik7XHJcbiAgICAgICAgICAgICAgcmVzLndyaXRlKGBkYXRhOiAke0pTT04uc3RyaW5naWZ5KHsgZXJyb3I6ICdFcnJvciBleHRyYWN0aW5nIGF1ZGlvJyB9KX1cXG5cXG5gKTtcclxuICAgICAgICAgICAgICByZXMuZW5kKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZXMuc2V0SGVhZGVyKCdBbGxvdycsIFsnUE9TVCddKTtcclxuICAgICAgICAgIHJlcy5zdGF0dXMoNDA1KS5lbmQoYE1ldGhvZCAke3JlcS5tZXRob2R9IE5vdCBBbGxvd2VkYCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgY2FzZSAnZ2V0QXVkaW8nOlxyXG4gICAgICAgIGlmIChyZXEubWV0aG9kID09PSAnR0VUJykge1xyXG4gICAgICAgICAgY29uc3QgeyBmaWxlbmFtZSB9ID0gcmVxLnF1ZXJ5O1xyXG4gICAgICAgICAgaWYgKCFmaWxlbmFtZSB8fCB0eXBlb2YgZmlsZW5hbWUgIT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiAnRmlsZW5hbWUgaXMgcmVxdWlyZWQnIH0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgY29uc3QgYXVkaW9QYXRoID0gcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksICdkb3dubG9hZCcsICdtcDMnLCBmaWxlbmFtZSk7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZygnQXR0ZW1wdGluZyB0byBzZXJ2ZSBhdWRpbyBmaWxlOicsIGF1ZGlvUGF0aCk7XHJcbiAgICAgICAgICBpZiAoZnMuZXhpc3RzU3luYyhhdWRpb1BhdGgpKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHN0YXQgPSBmcy5zdGF0U3luYyhhdWRpb1BhdGgpO1xyXG4gICAgICAgICAgICByZXMud3JpdGVIZWFkKDIwMCwge1xyXG4gICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXVkaW8vbXBlZycsXHJcbiAgICAgICAgICAgICAgJ0NvbnRlbnQtTGVuZ3RoJzogc3RhdC5zaXplXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBjb25zdCByZWFkU3RyZWFtID0gZnMuY3JlYXRlUmVhZFN0cmVhbShhdWRpb1BhdGgpO1xyXG4gICAgICAgICAgICByZWFkU3RyZWFtLnBpcGUocmVzKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdBdWRpbyBmaWxlIG5vdCBmb3VuZDonLCBhdWRpb1BhdGgpO1xyXG4gICAgICAgICAgICByZXMuc3RhdHVzKDQwNCkuanNvbih7IGVycm9yOiAnQXVkaW8gZmlsZSBub3QgZm91bmQnIH0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZXMuc2V0SGVhZGVyKCdBbGxvdycsIFsnR0VUJ10pO1xyXG4gICAgICAgICAgcmVzLnN0YXR1cyg0MDUpLmVuZChgTWV0aG9kICR7cmVxLm1ldGhvZH0gTm90IEFsbG93ZWRgKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ludmFsaWQgYWN0aW9uOicsIGFjdGlvbik7XHJcbiAgICAgICAgcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBlcnJvcjogJ0FjdGlvbiBub3QgZm91bmQnIH0pO1xyXG4gICAgfVxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdVbmV4cGVjdGVkIGVycm9yOicsIGVycm9yKTtcclxuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6ICdBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkJywgZGV0YWlsczogKGVycm9yIGFzIEVycm9yKS5tZXNzYWdlIH0pO1xyXG4gIH1cclxufVxyXG4iXSwibmFtZXMiOlsiZm9ybWlkYWJsZSIsImZzIiwicGF0aCIsImV4dHJhY3RBdWRpbyIsImdldEF1ZGlvRHVyYXRpb24iLCJjb25maWciLCJhcGkiLCJib2R5UGFyc2VyIiwidXBsb2FkRGlyIiwiam9pbiIsInByb2Nlc3MiLCJjd2QiLCJyZWNvcmRzRmlsZSIsImV4aXN0c1N5bmMiLCJta2RpclN5bmMiLCJyZWN1cnNpdmUiLCJ3cml0ZUZpbGVTeW5jIiwiSlNPTiIsInN0cmluZ2lmeSIsImhhbmRsZXIiLCJyZXEiLCJyZXMiLCJhY3Rpb24iLCJxdWVyeSIsImNvbnNvbGUiLCJsb2ciLCJtZXRob2QiLCJmb3JtIiwia2VlcEV4dGVuc2lvbnMiLCJtYXhGaWxlU2l6ZSIsInBhcnNlIiwiZXJyIiwiZmllbGRzIiwiZmlsZXMiLCJlcnJvciIsInN0YXR1cyIsImpzb24iLCJkZXRhaWxzIiwibWVzc2FnZSIsImZpbGUiLCJvcmlnaW5hbEZpbGVuYW1lIiwic2l6ZSIsIm1pbWV0eXBlIiwib3JpZ2luYWxOYW1lIiwibmFtZSIsImV4dGVuc2lvbiIsImV4dCIsIm5ld0ZpbGVuYW1lIiwiY291bnRlciIsIm5ld1BhdGgiLCJyZW5hbWVTeW5jIiwiZmlsZXBhdGgiLCJmaWxlSW5mbyIsInR5cGUiLCJ1cGxvYWRlZEF0IiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwicmVjb3JkcyIsInJlYWRGaWxlU3luYyIsInB1c2giLCJzZXRIZWFkZXIiLCJlbmQiLCJmaWxlbmFtZSIsImZpbGVQYXRoIiwiYXVkaW9GaWxlUGF0aCIsInVubGlua1N5bmMiLCJ1cGRhdGVkUmVjb3JkcyIsImZpbHRlciIsInJlY29yZCIsIm9sZE5hbWUiLCJuZXdOYW1lIiwiYm9keSIsIm9sZFBhdGgiLCJBcnJheSIsImlzQXJyYXkiLCJ2aWRlb1BhdGgiLCJ3cml0ZUhlYWQiLCJzZW5kUHJvZ3Jlc3MiLCJwcm9ncmVzcyIsIndyaXRlIiwiYXVkaW9QYXRoIiwiYXVkaW9GaWxlbmFtZSIsImJhc2VuYW1lIiwiZHVyYXRpb24iLCJzdGF0U3luYyIsIm1hcCIsImF1ZGlvRmlsZSIsImNvbXBsZXRlIiwic3RhdCIsInJlYWRTdHJlYW0iLCJjcmVhdGVSZWFkU3RyZWFtIiwicGlwZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./pages/api/files/[action].ts\n");

/***/ }),

/***/ "(api)/./utils/videoProcessor.ts":
/*!*********************************!*\
  !*** ./utils/videoProcessor.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   extractAudio: () => (/* binding */ extractAudio),\n/* harmony export */   getAudioDuration: () => (/* binding */ getAudioDuration),\n/* harmony export */   processVideo: () => (/* binding */ processVideo)\n/* harmony export */ });\n/* harmony import */ var fluent_ffmpeg__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! fluent-ffmpeg */ \"fluent-ffmpeg\");\n/* harmony import */ var fluent_ffmpeg__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(fluent_ffmpeg__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _ffmpeg_installer_ffmpeg__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @ffmpeg-installer/ffmpeg */ \"@ffmpeg-installer/ffmpeg\");\n/* harmony import */ var _ffmpeg_installer_ffmpeg__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_ffmpeg_installer_ffmpeg__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var openai__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! openai */ \"openai\");\n/* harmony import */ var openai__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(openai__WEBPACK_IMPORTED_MODULE_4__);\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_5__);\n\n\nfluent_ffmpeg__WEBPACK_IMPORTED_MODULE_0___default().setFfmpegPath((_ffmpeg_installer_ffmpeg__WEBPACK_IMPORTED_MODULE_1___default().path));\n\n\n\n\nconst configuration = new openai__WEBPACK_IMPORTED_MODULE_4__.Configuration({\n    apiKey: process.env.OPENAI_API_KEY,\n    basePath: process.env.OPENAI_BASE_URL\n});\nconst openai = new openai__WEBPACK_IMPORTED_MODULE_4__.OpenAIApi(configuration);\nconst mongoUri = process.env.MONGODB_URI;\nif (!mongoUri) {\n    console.error(\"MONGODB_URI is not defined in the environment variables\");\n    process.exit(1);\n}\nconsole.log(\"MongoDB URI:\", mongoUri); // 添加这行来打印 URI\nlet mongoClient = null;\nasync function getMongoClient() {\n    if (!mongoClient) {\n        try {\n            mongoClient = new mongodb__WEBPACK_IMPORTED_MODULE_5__.MongoClient(mongoUri);\n            await mongoClient.connect();\n            console.log(\"Connected successfully to MongoDB\");\n        } catch (error) {\n            console.error(\"Failed to connect to MongoDB:\", error);\n            throw error;\n        }\n    }\n    return mongoClient;\n}\nasync function processVideo(filePath) {\n    try {\n        // 1. 音频分离\n        const audioFile = await extractAudio(filePath);\n        // 2. 音频转文本\n        const textContent = await convertSpeechToText(audioFile);\n        // 3. 文本清洗\n        const cleanedText = cleanText(textContent);\n        // 4. 文本存储\n        await storeText([\n            cleanedText\n        ]);\n        // 5. 高级分析\n        const analysisResult = await performAdvancedAnalysis([\n            cleanedText\n        ]);\n        return analysisResult;\n    } catch (error) {\n        console.error(\"Error in video processing:\", error);\n        throw error;\n    }\n}\nasync function extractAudio(videoPath, onProgress) {\n    return new Promise((resolve, reject)=>{\n        const outputDir = path__WEBPACK_IMPORTED_MODULE_3___default().join(process.cwd(), \"download\", \"mp3\");\n        if (!fs__WEBPACK_IMPORTED_MODULE_2___default().existsSync(outputDir)) {\n            fs__WEBPACK_IMPORTED_MODULE_2___default().mkdirSync(outputDir, {\n                recursive: true\n            });\n        }\n        const outputPath = path__WEBPACK_IMPORTED_MODULE_3___default().join(outputDir, `${path__WEBPACK_IMPORTED_MODULE_3___default().basename(videoPath, \".mp4\")}.mp3`);\n        console.log(\"Input video path:\", videoPath);\n        console.log(\"Output audio path:\", outputPath);\n        fluent_ffmpeg__WEBPACK_IMPORTED_MODULE_0___default()(videoPath).outputOptions(\"-vn\").outputOptions(\"-acodec\", \"libmp3lame\").outputOptions(\"-ac\", \"2\").outputOptions(\"-b:a\", \"192k\").on(\"progress\", (progress)=>{\n            if (progress.percent) {\n                onProgress(Math.round(progress.percent));\n            }\n        }).on(\"end\", ()=>{\n            console.log(\"Audio extraction completed:\", outputPath);\n            resolve(outputPath);\n        }).on(\"error\", (err)=>{\n            console.error(\"Error during audio extraction:\", err);\n            reject(err);\n        }).save(outputPath);\n    });\n}\nasync function convertSpeechToText(audioFile) {\n    // 使用OpenAI的Whisper API进行语音识别\n    const response = await openai.createTranscription(fs__WEBPACK_IMPORTED_MODULE_2___default().createReadStream(audioFile), \"whisper-1\");\n    return response.data.text;\n}\nfunction cleanText(text) {\n    // 实现文本清洗逻辑\n    return text; // 临时返回，实际实现需要清洗文本\n}\nasync function storeText(texts) {\n    const client = await getMongoClient();\n    try {\n        const db = client.db(\"video_analysis\");\n        const collection = db.collection(\"transcripts\");\n        await collection.insertMany(texts.map((text)=>({\n                content: text\n            })));\n        console.log(\"Texts stored successfully in MongoDB\");\n    } catch (error) {\n        console.error(\"Error storing texts in MongoDB:\", error);\n        throw error;\n    }\n}\nasync function performAdvancedAnalysis(texts) {\n    // 实现高级分析逻辑\n    // 返回分析结果和知识图谱\n    return {\n        analysis: \"Sample analysis result\"\n    }; // 临时返回，实际实现需要进行高级分析\n}\nfunction getAudioDuration(filePath) {\n    return new Promise((resolve, reject)=>{\n        fluent_ffmpeg__WEBPACK_IMPORTED_MODULE_0___default().ffprobe(filePath, (err, metadata)=>{\n            if (err) {\n                reject(err);\n            } else {\n                resolve(metadata.format.duration || 0);\n            }\n        });\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QU8yQyxtQkFBbUIsQ0FDL0N0RCwwREFBbUIsQ0FBQ3VCLFlBQ3BCO0lBRUYsT0FBTzhCLFNBQVNHLElBQUksQ0FBQ0MsSUFBSTtBQUMzQjtBQUVBLFNBQVM3QixVQUFVNkIsSUFBWTtJQUM3QixXQUFXO0lBQ1gsT0FBT0EsTUFBTSxrQkFBa0I7QUFDakM7QUFFQSxlQUFlNUIsVUFBVTZCLEtBQWU7SUFDdEMsTUFBTUMsU0FBUyxNQUFNeEM7SUFDckIsSUFBSTtRQUNGLE1BQU15QyxLQUFLRCxPQUFPQyxFQUFFLENBQUM7UUFDckIsTUFBTUMsYUFBYUQsR0FBR0MsVUFBVSxDQUFDO1FBQ2pDLE1BQU1BLFdBQVdDLFVBQVUsQ0FBQ0osTUFBTUssR0FBRyxDQUFDTixDQUFBQSxPQUFTO2dCQUFFTyxTQUFTUDtZQUFLO1FBQy9EM0MsUUFBUUcsR0FBRyxDQUFDO0lBQ2QsRUFBRSxPQUFPRixPQUFPO1FBQ2RELFFBQVFDLEtBQUssQ0FBQyxtQ0FBbUNBO1FBQ2pELE1BQU1BO0lBQ1I7QUFDRjtBQUVBLGVBQWVnQix3QkFBd0IyQixLQUFlO0lBQ3BELFdBQVc7SUFDWCxjQUFjO0lBQ2QsT0FBTztRQUFFTyxVQUFVO0lBQXlCLEdBQUcsb0JBQW9CO0FBQ3JFO0FBRU8sU0FBU0MsaUJBQWlCNUMsUUFBZ0I7SUFDL0MsT0FBTyxJQUFJWSxRQUFRLENBQUNDLFNBQVNDO1FBQzNCeEMsNERBQWMsQ0FBQzBCLFVBQVUsQ0FBQzZCLEtBQUtpQjtZQUM3QixJQUFJakIsS0FBSztnQkFDUGYsT0FBT2U7WUFDVCxPQUFPO2dCQUNMaEIsUUFBUWlDLFNBQVNDLE1BQU0sQ0FBQ0MsUUFBUSxJQUFJO1lBQ3RDO1FBQ0Y7SUFDRjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdmlkZW8tYW5hbHlzaXMtc3lzdGVtLy4vdXRpbHMvdmlkZW9Qcm9jZXNzb3IudHM/ZGI5ZCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZmZtcGVnIGZyb20gJ2ZsdWVudC1mZm1wZWcnO1xyXG5pbXBvcnQgZmZtcGVnSW5zdGFsbGVyIGZyb20gJ0BmZm1wZWctaW5zdGFsbGVyL2ZmbXBlZyc7XHJcblxyXG5mZm1wZWcuc2V0RmZtcGVnUGF0aChmZm1wZWdJbnN0YWxsZXIucGF0aCk7XHJcblxyXG5pbXBvcnQgZnMgZnJvbSAnZnMnO1xyXG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcclxuaW1wb3J0IHsgQ29uZmlndXJhdGlvbiwgT3BlbkFJQXBpIH0gZnJvbSAnb3BlbmFpJztcclxuaW1wb3J0IHsgTW9uZ29DbGllbnQgfSBmcm9tICdtb25nb2RiJztcclxuXHJcbmNvbnN0IGNvbmZpZ3VyYXRpb24gPSBuZXcgQ29uZmlndXJhdGlvbih7XHJcbiAgYXBpS2V5OiBwcm9jZXNzLmVudi5PUEVOQUlfQVBJX0tFWSxcclxuICBiYXNlUGF0aDogcHJvY2Vzcy5lbnYuT1BFTkFJX0JBU0VfVVJMLFxyXG59KTtcclxuY29uc3Qgb3BlbmFpID0gbmV3IE9wZW5BSUFwaShjb25maWd1cmF0aW9uKTtcclxuXHJcbmNvbnN0IG1vbmdvVXJpID0gcHJvY2Vzcy5lbnYuTU9OR09EQl9VUkk7XHJcbmlmICghbW9uZ29VcmkpIHtcclxuICBjb25zb2xlLmVycm9yKCdNT05HT0RCX1VSSSBpcyBub3QgZGVmaW5lZCBpbiB0aGUgZW52aXJvbm1lbnQgdmFyaWFibGVzJyk7XHJcbiAgcHJvY2Vzcy5leGl0KDEpO1xyXG59XHJcblxyXG5jb25zb2xlLmxvZygnTW9uZ29EQiBVUkk6JywgbW9uZ29VcmkpOyAvLyDmt7vliqDov5nooYzmnaXmiZPljbAgVVJJXHJcblxyXG5sZXQgbW9uZ29DbGllbnQ6IE1vbmdvQ2xpZW50IHwgbnVsbCA9IG51bGw7XHJcblxyXG5hc3luYyBmdW5jdGlvbiBnZXRNb25nb0NsaWVudCgpIHtcclxuICBpZiAoIW1vbmdvQ2xpZW50KSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBtb25nb0NsaWVudCA9IG5ldyBNb25nb0NsaWVudChtb25nb1VyaSk7XHJcbiAgICAgIGF3YWl0IG1vbmdvQ2xpZW50LmNvbm5lY3QoKTtcclxuICAgICAgY29uc29sZS5sb2coJ0Nvbm5lY3RlZCBzdWNjZXNzZnVsbHkgdG8gTW9uZ29EQicpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGNvbm5lY3QgdG8gTW9uZ29EQjonLCBlcnJvcik7XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gIH1cclxuICByZXR1cm4gbW9uZ29DbGllbnQ7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBwcm9jZXNzVmlkZW8oZmlsZVBhdGg6IHN0cmluZykge1xyXG4gIHRyeSB7XHJcbiAgICAvLyAxLiDpn7PpopHliIbnprtcclxuICAgIGNvbnN0IGF1ZGlvRmlsZSA9IGF3YWl0IGV4dHJhY3RBdWRpbyhmaWxlUGF0aCk7XHJcblxyXG4gICAgLy8gMi4g6Z+z6aKR6L2s5paH5pysXHJcbiAgICBjb25zdCB0ZXh0Q29udGVudCA9IGF3YWl0IGNvbnZlcnRTcGVlY2hUb1RleHQoYXVkaW9GaWxlKTtcclxuXHJcbiAgICAvLyAzLiDmlofmnKzmuIXmtJdcclxuICAgIGNvbnN0IGNsZWFuZWRUZXh0ID0gY2xlYW5UZXh0KHRleHRDb250ZW50KTtcclxuXHJcbiAgICAvLyA0LiDmlofmnKzlrZjlgqhcclxuICAgIGF3YWl0IHN0b3JlVGV4dChbY2xlYW5lZFRleHRdKTtcclxuXHJcbiAgICAvLyA1LiDpq5jnuqfliIbmnpBcclxuICAgIGNvbnN0IGFuYWx5c2lzUmVzdWx0ID0gYXdhaXQgcGVyZm9ybUFkdmFuY2VkQW5hbHlzaXMoW2NsZWFuZWRUZXh0XSk7XHJcblxyXG4gICAgcmV0dXJuIGFuYWx5c2lzUmVzdWx0O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiB2aWRlbyBwcm9jZXNzaW5nOicsIGVycm9yKTtcclxuICAgIHRocm93IGVycm9yO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGV4dHJhY3RBdWRpbyh2aWRlb1BhdGg6IHN0cmluZywgb25Qcm9ncmVzczogKHByb2dyZXNzOiBudW1iZXIpID0+IHZvaWQpOiBQcm9taXNlPHN0cmluZz4ge1xyXG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICBjb25zdCBvdXRwdXREaXIgPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJ2Rvd25sb2FkJywgJ21wMycpO1xyXG4gICAgaWYgKCFmcy5leGlzdHNTeW5jKG91dHB1dERpcikpIHtcclxuICAgICAgZnMubWtkaXJTeW5jKG91dHB1dERpciwgeyByZWN1cnNpdmU6IHRydWUgfSk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBvdXRwdXRQYXRoID0gcGF0aC5qb2luKG91dHB1dERpciwgYCR7cGF0aC5iYXNlbmFtZSh2aWRlb1BhdGgsICcubXA0Jyl9Lm1wM2ApO1xyXG4gICAgXHJcbiAgICBjb25zb2xlLmxvZygnSW5wdXQgdmlkZW8gcGF0aDonLCB2aWRlb1BhdGgpO1xyXG4gICAgY29uc29sZS5sb2coJ091dHB1dCBhdWRpbyBwYXRoOicsIG91dHB1dFBhdGgpO1xyXG5cclxuICAgIGZmbXBlZyh2aWRlb1BhdGgpXHJcbiAgICAgIC5vdXRwdXRPcHRpb25zKCctdm4nKVxyXG4gICAgICAub3V0cHV0T3B0aW9ucygnLWFjb2RlYycsICdsaWJtcDNsYW1lJylcclxuICAgICAgLm91dHB1dE9wdGlvbnMoJy1hYycsICcyJylcclxuICAgICAgLm91dHB1dE9wdGlvbnMoJy1iOmEnLCAnMTkyaycpXHJcbiAgICAgIC5vbigncHJvZ3Jlc3MnLCAocHJvZ3Jlc3MpID0+IHtcclxuICAgICAgICBpZiAocHJvZ3Jlc3MucGVyY2VudCkge1xyXG4gICAgICAgICAgb25Qcm9ncmVzcyhNYXRoLnJvdW5kKHByb2dyZXNzLnBlcmNlbnQpKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcbiAgICAgIC5vbignZW5kJywgKCkgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdBdWRpbyBleHRyYWN0aW9uIGNvbXBsZXRlZDonLCBvdXRwdXRQYXRoKTtcclxuICAgICAgICByZXNvbHZlKG91dHB1dFBhdGgpO1xyXG4gICAgICB9KVxyXG4gICAgICAub24oJ2Vycm9yJywgKGVycikgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGR1cmluZyBhdWRpbyBleHRyYWN0aW9uOicsIGVycik7XHJcbiAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5zYXZlKG91dHB1dFBhdGgpO1xyXG4gIH0pO1xyXG59XHJcblxyXG5hc3luYyBmdW5jdGlvbiBjb252ZXJ0U3BlZWNoVG9UZXh0KGF1ZGlvRmlsZTogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcclxuICAvLyDkvb/nlKhPcGVuQUnnmoRXaGlzcGVyIEFQSei/m+ihjOivremfs+ivhuWIq1xyXG4gIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgb3BlbmFpLmNyZWF0ZVRyYW5zY3JpcHRpb24oXHJcbiAgICBmcy5jcmVhdGVSZWFkU3RyZWFtKGF1ZGlvRmlsZSkgYXMgYW55LFxyXG4gICAgXCJ3aGlzcGVyLTFcIlxyXG4gICk7XHJcbiAgcmV0dXJuIHJlc3BvbnNlLmRhdGEudGV4dDtcclxufVxyXG5cclxuZnVuY3Rpb24gY2xlYW5UZXh0KHRleHQ6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgLy8g5a6e546w5paH5pys5riF5rSX6YC76L6RXHJcbiAgcmV0dXJuIHRleHQ7IC8vIOS4tOaXtui/lOWbnu+8jOWunumZheWunueOsOmcgOimgea4hea0l+aWh+acrFxyXG59XHJcblxyXG5hc3luYyBmdW5jdGlvbiBzdG9yZVRleHQodGV4dHM6IHN0cmluZ1tdKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgY29uc3QgY2xpZW50ID0gYXdhaXQgZ2V0TW9uZ29DbGllbnQoKTtcclxuICB0cnkge1xyXG4gICAgY29uc3QgZGIgPSBjbGllbnQuZGIoJ3ZpZGVvX2FuYWx5c2lzJyk7XHJcbiAgICBjb25zdCBjb2xsZWN0aW9uID0gZGIuY29sbGVjdGlvbigndHJhbnNjcmlwdHMnKTtcclxuICAgIGF3YWl0IGNvbGxlY3Rpb24uaW5zZXJ0TWFueSh0ZXh0cy5tYXAodGV4dCA9PiAoeyBjb250ZW50OiB0ZXh0IH0pKSk7XHJcbiAgICBjb25zb2xlLmxvZygnVGV4dHMgc3RvcmVkIHN1Y2Nlc3NmdWxseSBpbiBNb25nb0RCJyk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHN0b3JpbmcgdGV4dHMgaW4gTW9uZ29EQjonLCBlcnJvcik7XHJcbiAgICB0aHJvdyBlcnJvcjtcclxuICB9XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIHBlcmZvcm1BZHZhbmNlZEFuYWx5c2lzKHRleHRzOiBzdHJpbmdbXSk6IFByb21pc2U8YW55PiB7XHJcbiAgLy8g5a6e546w6auY57qn5YiG5p6Q6YC76L6RXHJcbiAgLy8g6L+U5Zue5YiG5p6Q57uT5p6c5ZKM55+l6K+G5Zu+6LCxXHJcbiAgcmV0dXJuIHsgYW5hbHlzaXM6IFwiU2FtcGxlIGFuYWx5c2lzIHJlc3VsdFwiIH07IC8vIOS4tOaXtui/lOWbnu+8jOWunumZheWunueOsOmcgOimgei/m+ihjOmrmOe6p+WIhuaekFxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0QXVkaW9EdXJhdGlvbihmaWxlUGF0aDogc3RyaW5nKTogUHJvbWlzZTxudW1iZXI+IHtcclxuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgZmZtcGVnLmZmcHJvYmUoZmlsZVBhdGgsIChlcnIsIG1ldGFkYXRhKSA9PiB7XHJcbiAgICAgIGlmIChlcnIpIHtcclxuICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXNvbHZlKG1ldGFkYXRhLmZvcm1hdC5kdXJhdGlvbiB8fCAwKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn1cclxuIl0sIm5hbWVzIjpbImZmbXBlZyIsImZmbXBlZ0luc3RhbGxlciIsInNldEZmbXBlZ1BhdGgiLCJwYXRoIiwiZnMiLCJDb25maWd1cmF0aW9uIiwiT3BlbkFJQXBpIiwiTW9uZ29DbGllbnQiLCJjb25maWd1cmF0aW9uIiwiYXBpS2V5IiwicHJvY2VzcyIsImVudiIsIk9QRU5BSV9BUElfS0VZIiwiYmFzZVBhdGgiLCJPUEVOQUlfQkFTRV9VUkwiLCJvcGVuYWkiLCJtb25nb1VyaSIsIk1PTkdPREJfVVJJIiwiY29uc29sZSIsImVycm9yIiwiZXhpdCIsImxvZyIsIm1vbmdvQ2xpZW50IiwiZ2V0TW9uZ29DbGllbnQiLCJjb25uZWN0IiwicHJvY2Vzc1ZpZGVvIiwiZmlsZVBhdGgiLCJhdWRpb0ZpbGUiLCJleHRyYWN0QXVkaW8iLCJ0ZXh0Q29udGVudCIsImNvbnZlcnRTcGVlY2hUb1RleHQiLCJjbGVhbmVkVGV4dCIsImNsZWFuVGV4dCIsInN0b3JlVGV4dCIsImFuYWx5c2lzUmVzdWx0IiwicGVyZm9ybUFkdmFuY2VkQW5hbHlzaXMiLCJ2aWRlb1BhdGgiLCJvblByb2dyZXNzIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJvdXRwdXREaXIiLCJqb2luIiwiY3dkIiwiZXhpc3RzU3luYyIsIm1rZGlyU3luYyIsInJlY3Vyc2l2ZSIsIm91dHB1dFBhdGgiLCJiYXNlbmFtZSIsIm91dHB1dE9wdGlvbnMiLCJvbiIsInByb2dyZXNzIiwicGVyY2VudCIsIk1hdGgiLCJyb3VuZCIsImVyciIsInNhdmUiLCJyZXNwb25zZSIsImNyZWF0ZVRyYW5zY3JpcHRpb24iLCJjcmVhdGVSZWFkU3RyZWFtIiwiZGF0YSIsInRleHQiLCJ0ZXh0cyIsImNsaWVudCIsImRiIiwiY29sbGVjdGlvbiIsImluc2VydE1hbnkiLCJtYXAiLCJjb250ZW50IiwiYW5hbHlzaXMiLCJnZXRBdWRpb0R1cmF0aW9uIiwiZmZwcm9iZSIsIm1ldGFkYXRhIiwiZm9ybWF0IiwiZHVyYXRpb24iXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./utils/videoProcessor.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = (__webpack_exec__("(api)/./pages/api/files/[action].ts"));
module.exports = __webpack_exports__;

})();