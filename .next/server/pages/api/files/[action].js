"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/files/[action]";
exports.ids = ["pages/api/files/[action]"];
exports.modules = {

/***/ "@ffmpeg-installer/ffmpeg":
/*!*******************************************!*\
  !*** external "@ffmpeg-installer/ffmpeg" ***!
  \*******************************************/
/***/ ((module) => {

module.exports = require("@ffmpeg-installer/ffmpeg");

/***/ }),

/***/ "@ffprobe-installer/ffprobe":
/*!*********************************************!*\
  !*** external "@ffprobe-installer/ffprobe" ***!
  \*********************************************/
/***/ ((module) => {

module.exports = require("@ffprobe-installer/ffprobe");

/***/ }),

/***/ "fluent-ffmpeg":
/*!********************************!*\
  !*** external "fluent-ffmpeg" ***!
  \********************************/
/***/ ((module) => {

module.exports = require("fluent-ffmpeg");

/***/ }),

/***/ "mongodb":
/*!**************************!*\
  !*** external "mongodb" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("mongodb");

/***/ }),

/***/ "formidable":
/*!*****************************!*\
  !*** external "formidable" ***!
  \*****************************/
/***/ ((module) => {

module.exports = import("formidable");;

/***/ }),

/***/ "openai":
/*!*************************!*\
  !*** external "openai" ***!
  \*************************/
/***/ ((module) => {

module.exports = import("openai");;

/***/ }),

/***/ "child_process":
/*!********************************!*\
  !*** external "child_process" ***!
  \********************************/
/***/ ((module) => {

module.exports = require("child_process");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "(api)/./pages/api/files/[action].ts":
/*!*************************************!*\
  !*** ./pages/api/files/[action].ts ***!
  \*************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var formidable__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! formidable */ \"formidable\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _utils_videoProcessor__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../utils/videoProcessor */ \"(api)/./utils/videoProcessor.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([formidable__WEBPACK_IMPORTED_MODULE_0__, _utils_videoProcessor__WEBPACK_IMPORTED_MODULE_3__]);\n([formidable__WEBPACK_IMPORTED_MODULE_0__, _utils_videoProcessor__WEBPACK_IMPORTED_MODULE_3__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\nconst config = {\n    api: {\n        bodyParser: false\n    }\n};\nconst uploadDir = path__WEBPACK_IMPORTED_MODULE_2___default().join(process.cwd(), \"uploads\");\nconst recordsFile = path__WEBPACK_IMPORTED_MODULE_2___default().join(process.cwd(), \"upload_records.json\");\n// 确保上传目录存在\nif (!fs__WEBPACK_IMPORTED_MODULE_1___default().existsSync(uploadDir)) {\n    fs__WEBPACK_IMPORTED_MODULE_1___default().mkdirSync(uploadDir, {\n        recursive: true\n    });\n}\n// 确保记录文件存在\nif (!fs__WEBPACK_IMPORTED_MODULE_1___default().existsSync(recordsFile)) {\n    fs__WEBPACK_IMPORTED_MODULE_1___default().writeFileSync(recordsFile, JSON.stringify([]));\n}\nasync function handler(req, res) {\n    const { action } = req.query;\n    console.log(`Received ${req.method} request for action: ${action}`);\n    try {\n        // 只在需要使用 FFmpeg 的操作中进行检查\n        if (action === \"extractAudio\") {\n            const ffmpegAvailable = await (0,_utils_videoProcessor__WEBPACK_IMPORTED_MODULE_3__.checkFFmpeg)();\n            if (!ffmpegAvailable) {\n                return res.status(500).json({\n                    error: \"FFmpeg is not available\"\n                });\n            }\n        }\n        switch(action){\n            case \"upload\":\n                if (req.method === \"POST\") {\n                    console.log(\"Processing file upload\");\n                    const form = (0,formidable__WEBPACK_IMPORTED_MODULE_0__[\"default\"])({\n                        uploadDir: uploadDir,\n                        keepExtensions: true,\n                        maxFileSize: 200 * 1024 * 1024\n                    });\n                    form.parse(req, (err, fields, files)=>{\n                        if (err) {\n                            console.error(\"Error parsing form:\", err);\n                            return res.status(500).json({\n                                error: \"Error parsing form data\",\n                                details: err.message\n                            });\n                        }\n                        console.log(\"Form parsed successfully\");\n                        const file = files.file?.[0];\n                        if (!file) {\n                            console.error(\"No file uploaded\");\n                            return res.status(400).json({\n                                error: \"No file uploaded\"\n                            });\n                        }\n                        console.log(\"File received:\", file.originalFilename);\n                        if (file.size > 200 * 1024 * 1024) {\n                            console.error(\"File size exceeds limit:\", file.size);\n                            return res.status(400).json({\n                                error: \"File size exceeds 200MB limit\"\n                            });\n                        }\n                        if (file.mimetype !== \"video/mp4\") {\n                            console.error(\"Invalid file type:\", file.mimetype);\n                            return res.status(400).json({\n                                error: \"Only MP4 files are allowed\"\n                            });\n                        }\n                        // 生成新的文件名\n                        const originalName = path__WEBPACK_IMPORTED_MODULE_2___default().parse(file.originalFilename || \"\").name;\n                        const extension = path__WEBPACK_IMPORTED_MODULE_2___default().parse(file.originalFilename || \"\").ext;\n                        let newFilename = `${originalName}${extension}`;\n                        let counter = 1;\n                        // 检查文件是否已存在，如果存在则重命名\n                        while(fs__WEBPACK_IMPORTED_MODULE_1___default().existsSync(path__WEBPACK_IMPORTED_MODULE_2___default().join(uploadDir, newFilename))){\n                            newFilename = `${originalName}(${counter})${extension}`;\n                            counter++;\n                        }\n                        const newPath = path__WEBPACK_IMPORTED_MODULE_2___default().join(uploadDir, newFilename);\n                        fs__WEBPACK_IMPORTED_MODULE_1___default().renameSync(file.filepath, newPath);\n                        const fileInfo = {\n                            originalName: file.originalFilename,\n                            name: newFilename,\n                            size: file.size,\n                            type: file.mimetype,\n                            uploadedAt: new Date().toISOString()\n                        };\n                        // 添加文件记录\n                        const records = JSON.parse(fs__WEBPACK_IMPORTED_MODULE_1___default().readFileSync(recordsFile, \"utf-8\"));\n                        records.push(fileInfo);\n                        fs__WEBPACK_IMPORTED_MODULE_1___default().writeFileSync(recordsFile, JSON.stringify(records, null, 2));\n                        console.log(\"File uploaded successfully:\", fileInfo);\n                        return res.status(200).json({\n                            message: \"File uploaded successfully\",\n                            fileInfo\n                        });\n                    });\n                } else {\n                    res.setHeader(\"Allow\", [\n                        \"POST\"\n                    ]);\n                    res.status(405).end(`Method ${req.method} Not Allowed`);\n                }\n                break;\n            case \"list\":\n                if (req.method === \"GET\") {\n                    try {\n                        const records = JSON.parse(fs__WEBPACK_IMPORTED_MODULE_1___default().readFileSync(recordsFile, \"utf-8\"));\n                        console.log(\"Records retrieved:\", records);\n                        res.status(200).json(records);\n                    } catch (error) {\n                        console.error(\"Error reading records file:\", error);\n                        res.status(500).json({\n                            error: \"Error retrieving file records\"\n                        });\n                    }\n                } else {\n                    res.setHeader(\"Allow\", [\n                        \"GET\"\n                    ]);\n                    res.status(405).end(`Method ${req.method} Not Allowed`);\n                }\n                break;\n            case \"delete\":\n                if (req.method === \"DELETE\") {\n                    // 使用 URL 参数而不是请求体\n                    const { filename } = req.query;\n                    if (!filename || typeof filename !== \"string\") {\n                        return res.status(400).json({\n                            error: \"Filename is required\"\n                        });\n                    }\n                    const filePath = path__WEBPACK_IMPORTED_MODULE_2___default().join(uploadDir, filename);\n                    const audioFilePath = path__WEBPACK_IMPORTED_MODULE_2___default().join(process.cwd(), \"download\", \"mp3\", `${path__WEBPACK_IMPORTED_MODULE_2___default().parse(filename).name}.mp3`);\n                    console.log(\"Attempting to delete file:\", filePath);\n                    if (fs__WEBPACK_IMPORTED_MODULE_1___default().existsSync(filePath)) {\n                        fs__WEBPACK_IMPORTED_MODULE_1___default().unlinkSync(filePath);\n                        console.log(\"Video file deleted successfully\");\n                        // 删除对应的音频文件（如果存��）\n                        if (fs__WEBPACK_IMPORTED_MODULE_1___default().existsSync(audioFilePath)) {\n                            fs__WEBPACK_IMPORTED_MODULE_1___default().unlinkSync(audioFilePath);\n                            console.log(\"Audio file deleted successfully\");\n                        }\n                        // 更新记录文件\n                        const records = JSON.parse(fs__WEBPACK_IMPORTED_MODULE_1___default().readFileSync(recordsFile, \"utf-8\"));\n                        const updatedRecords = records.filter((record)=>record.name !== filename);\n                        fs__WEBPACK_IMPORTED_MODULE_1___default().writeFileSync(recordsFile, JSON.stringify(updatedRecords, null, 2));\n                        res.status(200).json({\n                            message: \"File deleted successfully\"\n                        });\n                    } else {\n                        console.log(\"File not found:\", filePath);\n                        res.status(404).json({\n                            error: \"File not found\"\n                        });\n                    }\n                } else {\n                    res.setHeader(\"Allow\", [\n                        \"DELETE\"\n                    ]);\n                    res.status(405).end(`Method ${req.method} Not Allowed`);\n                }\n                break;\n            case \"rename\":\n                if (req.method === \"PUT\") {\n                    const { oldName, newName } = req.body;\n                    const oldPath = path__WEBPACK_IMPORTED_MODULE_2___default().join(uploadDir, oldName);\n                    const newPath = path__WEBPACK_IMPORTED_MODULE_2___default().join(uploadDir, newName);\n                    if (fs__WEBPACK_IMPORTED_MODULE_1___default().existsSync(oldPath)) {\n                        fs__WEBPACK_IMPORTED_MODULE_1___default().renameSync(oldPath, newPath);\n                        res.status(200).json({\n                            message: \"File renamed successfully\"\n                        });\n                    } else {\n                        res.status(404).json({\n                            error: \"File not found\"\n                        });\n                    }\n                } else {\n                    res.setHeader(\"Allow\", [\n                        \"PUT\"\n                    ]);\n                    res.status(405).end(`Method ${req.method} Not Allowed`);\n                }\n                break;\n            case \"extractAudio\":\n                if (req.method === \"POST\") {\n                    const form = (0,formidable__WEBPACK_IMPORTED_MODULE_0__[\"default\"])();\n                    form.parse(req, async (err, fields, files)=>{\n                        if (err) {\n                            console.error(\"Error parsing form:\", err);\n                            return res.status(500).json({\n                                error: \"Error parsing form data\"\n                            });\n                        }\n                        const filename = Array.isArray(fields.filename) ? fields.filename[0] : fields.filename;\n                        if (!filename) {\n                            return res.status(400).json({\n                                error: \"Filename is required\"\n                            });\n                        }\n                        console.log(\"Extracting audio for file:\", filename);\n                        const videoPath = path__WEBPACK_IMPORTED_MODULE_2___default().join(uploadDir, filename);\n                        console.log(\"Full video path:\", videoPath);\n                        if (!fs__WEBPACK_IMPORTED_MODULE_1___default().existsSync(videoPath)) {\n                            console.error(\"Video file not found:\", videoPath);\n                            return res.status(404).json({\n                                error: \"Video file not found\"\n                            });\n                        }\n                        try {\n                            // 在提取音频之前检查 FFmpeg\n                            const ffmpegAvailable = await (0,_utils_videoProcessor__WEBPACK_IMPORTED_MODULE_3__.checkFFmpeg)();\n                            if (!ffmpegAvailable) {\n                                return res.status(500).json({\n                                    error: \"FFmpeg is not available\"\n                                });\n                            }\n                            // 获取 FFmpeg 版本\n                            const ffmpegVersion = await (0,_utils_videoProcessor__WEBPACK_IMPORTED_MODULE_3__.getFFmpegVersion)();\n                            console.log(\"FFmpeg version:\", ffmpegVersion);\n                            // 使用 SSE (Server-Sent Events) 来报告进度\n                            res.writeHead(200, {\n                                \"Content-Type\": \"text/event-stream\",\n                                \"Cache-Control\": \"no-cache\",\n                                \"Connection\": \"keep-alive\"\n                            });\n                            const audioPath = await (0,_utils_videoProcessor__WEBPACK_IMPORTED_MODULE_3__.extractAudio)(videoPath);\n                            const audioFilename = path__WEBPACK_IMPORTED_MODULE_2___default().basename(audioPath);\n                            console.log(\"Audio extracted successfully:\", audioFilename);\n                            // 获取音频时长\n                            const duration = await (0,_utils_videoProcessor__WEBPACK_IMPORTED_MODULE_3__.getAudioDuration)(audioPath);\n                            // 获取音频文件大小\n                            const { size } = fs__WEBPACK_IMPORTED_MODULE_1___default().statSync(audioPath);\n                            // 更新文件记录\n                            const records = JSON.parse(fs__WEBPACK_IMPORTED_MODULE_1___default().readFileSync(recordsFile, \"utf-8\"));\n                            const updatedRecords = records.map((record)=>{\n                                if (record.name === filename) {\n                                    return {\n                                        ...record,\n                                        audioFile: audioFilename\n                                    };\n                                }\n                                return record;\n                            });\n                            fs__WEBPACK_IMPORTED_MODULE_1___default().writeFileSync(recordsFile, JSON.stringify(updatedRecords, null, 2));\n                            res.write(`data: ${JSON.stringify({\n                                complete: true,\n                                audioFile: audioFilename,\n                                duration,\n                                size\n                            })}\\n\\n`);\n                            res.end();\n                        } catch (error) {\n                            console.error(\"Error extracting audio:\", error);\n                            res.write(`data: ${JSON.stringify({\n                                error: \"Error extracting audio\",\n                                details: error.message\n                            })}\\n\\n`);\n                            res.end();\n                        }\n                    });\n                } else {\n                    res.setHeader(\"Allow\", [\n                        \"POST\"\n                    ]);\n                    res.status(405).end(`Method ${req.method} Not Allowed`);\n                }\n                break;\n            case \"getAudio\":\n                if (req.method === \"GET\") {\n                    const { filename } = req.query;\n                    if (!filename || typeof filename !== \"string\") {\n                        return res.status(400).json({\n                            error: \"Filename is required\"\n                        });\n                    }\n                    const audioPath = path__WEBPACK_IMPORTED_MODULE_2___default().join(process.cwd(), \"download\", \"mp3\", filename);\n                    console.log(\"Attempting to serve audio file:\", audioPath);\n                    if (fs__WEBPACK_IMPORTED_MODULE_1___default().existsSync(audioPath)) {\n                        const stat = fs__WEBPACK_IMPORTED_MODULE_1___default().statSync(audioPath);\n                        res.writeHead(200, {\n                            \"Content-Type\": \"audio/mpeg\",\n                            \"Content-Length\": stat.size\n                        });\n                        const readStream = fs__WEBPACK_IMPORTED_MODULE_1___default().createReadStream(audioPath);\n                        readStream.pipe(res);\n                    } else {\n                        console.log(\"Audio file not found:\", audioPath);\n                        res.status(404).json({\n                            error: \"Audio file not found\"\n                        });\n                    }\n                } else {\n                    res.setHeader(\"Allow\", [\n                        \"GET\"\n                    ]);\n                    res.status(405).end(`Method ${req.method} Not Allowed`);\n                }\n                break;\n            case \"getAudioUrl\":\n                if (req.method === \"GET\") {\n                    const { filename } = req.query;\n                    if (typeof filename !== \"string\") {\n                        return res.status(400).json({\n                            error: \"Invalid filename\"\n                        });\n                    }\n                    try {\n                        const url = await (0,_utils_videoProcessor__WEBPACK_IMPORTED_MODULE_3__.getAudioFileUrl)(filename);\n                        console.log(\"Audio URL generated:\", url); // 添加日志\n                        return res.status(200).json({\n                            url\n                        });\n                    } catch (error) {\n                        console.error(\"Error getting audio URL:\", error); // 添加错误日志\n                        return res.status(404).json({\n                            error: \"Audio file not found\"\n                        });\n                    }\n                } else {\n                    res.setHeader(\"Allow\", [\n                        \"GET\"\n                    ]);\n                    res.status(405).end(`Method ${req.method} Not Allowed`);\n                }\n                break;\n            default:\n                console.error(\"Invalid action:\", action);\n                res.status(404).json({\n                    error: \"Action not found\"\n                });\n        }\n    } catch (error) {\n        console.error(\"Unexpected error:\", error);\n        res.status(500).json({\n            error: \"An unexpected error occurred\",\n            details: error.message\n        });\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFZLENBQUM7Z0JBQ3hEO2dCQUNBO1lBRUY7Z0JBQ0VGLFFBQVFNLEtBQUssQ0FBQyxtQkFBbUJSO2dCQUNqQ0QsSUFBSU8sTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztvQkFBRUMsT0FBTztnQkFBbUI7UUFDckQ7SUFDRixFQUFFLE9BQU9BLE9BQU87UUFDZE4sUUFBUU0sS0FBSyxDQUFDLHFCQUFxQkE7UUFDbkNULElBQUlPLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFBRUMsT0FBTztZQUFnQ1EsU0FBUyxNQUFpQkMsT0FBTztRQUFDO0lBQ2xHO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly92aWRlby1hbmFseXNpcy1zeXN0ZW0vLi9wYWdlcy9hcGkvZmlsZXMvW2FjdGlvbl0udHM/ZDBiZSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0QXBpUmVxdWVzdCwgTmV4dEFwaVJlc3BvbnNlIH0gZnJvbSAnbmV4dCc7XG5pbXBvcnQgZm9ybWlkYWJsZSBmcm9tICdmb3JtaWRhYmxlJztcbmltcG9ydCBmcyBmcm9tICdmcyc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7IGV4dHJhY3RBdWRpbywgZ2V0QXVkaW9EdXJhdGlvbiwgY2hlY2tGRm1wZWcsIGdldEZGbXBlZ1ZlcnNpb24sIGdldEF1ZGlvRmlsZVVybCB9IGZyb20gJy4uLy4uLy4uL3V0aWxzL3ZpZGVvUHJvY2Vzc29yJztcblxuLy8g5Zyo5paH5Lu26aG26YOo5re75Yqg6L+Z5Liq5o6l5Y+j5a6a5LmJXG5pbnRlcmZhY2UgRmlsZUluZm8ge1xuICBuYW1lOiBzdHJpbmc7XG4gIHNpemU6IG51bWJlcjtcbiAgdHlwZTogc3RyaW5nO1xuICB1cGxvYWRlZEF0OiBzdHJpbmc7XG4gIGF1ZGlvRmlsZT86IHN0cmluZztcbn1cblxuLy8g5Zyo5paH5Lu26aG26YOo5re75Yqg6L+Z5Liq5a+85YWlXG5pbXBvcnQgeyBGaWxlIH0gZnJvbSAnZm9ybWlkYWJsZSc7XG5cbmV4cG9ydCBjb25zdCBjb25maWcgPSB7XG4gIGFwaToge1xuICAgIGJvZHlQYXJzZXI6IGZhbHNlLFxuICB9LFxufTtcblxuY29uc3QgdXBsb2FkRGlyID0gcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksICd1cGxvYWRzJyk7XG5jb25zdCByZWNvcmRzRmlsZSA9IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCAndXBsb2FkX3JlY29yZHMuanNvbicpO1xuXG4vLyDnoa7kv53kuIrkvKDnm67lvZXlrZjlnKhcbmlmICghZnMuZXhpc3RzU3luYyh1cGxvYWREaXIpKSB7XG4gIGZzLm1rZGlyU3luYyh1cGxvYWREaXIsIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xufVxuXG4vLyDnoa7kv53orrDlvZXmlofku7blrZjlnKhcbmlmICghZnMuZXhpc3RzU3luYyhyZWNvcmRzRmlsZSkpIHtcbiAgZnMud3JpdGVGaWxlU3luYyhyZWNvcmRzRmlsZSwgSlNPTi5zdHJpbmdpZnkoW10pKTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihyZXE6IE5leHRBcGlSZXF1ZXN0LCByZXM6IE5leHRBcGlSZXNwb25zZSkge1xuICBjb25zdCB7IGFjdGlvbiB9ID0gcmVxLnF1ZXJ5O1xuXG4gIGNvbnNvbGUubG9nKGBSZWNlaXZlZCAke3JlcS5tZXRob2R9IHJlcXVlc3QgZm9yIGFjdGlvbjogJHthY3Rpb259YCk7XG5cbiAgdHJ5IHtcbiAgICAvLyDlj6rlnKjpnIDopoHkvb/nlKggRkZtcGVnIOeahOaTjeS9nOS4rei/m+ihjOajgOafpVxuICAgIGlmIChhY3Rpb24gPT09ICdleHRyYWN0QXVkaW8nKSB7XG4gICAgICBjb25zdCBmZm1wZWdBdmFpbGFibGUgPSBhd2FpdCBjaGVja0ZGbXBlZygpO1xuICAgICAgaWYgKCFmZm1wZWdBdmFpbGFibGUpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6ICdGRm1wZWcgaXMgbm90IGF2YWlsYWJsZScgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgc3dpdGNoIChhY3Rpb24pIHtcbiAgICAgIGNhc2UgJ3VwbG9hZCc6XG4gICAgICAgIGlmIChyZXEubWV0aG9kID09PSAnUE9TVCcpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZygnUHJvY2Vzc2luZyBmaWxlIHVwbG9hZCcpO1xuICAgICAgICAgIGNvbnN0IGZvcm0gPSBmb3JtaWRhYmxlKHtcbiAgICAgICAgICAgIHVwbG9hZERpcjogdXBsb2FkRGlyLFxuICAgICAgICAgICAga2VlcEV4dGVuc2lvbnM6IHRydWUsXG4gICAgICAgICAgICBtYXhGaWxlU2l6ZTogMjAwICogMTAyNCAqIDEwMjQsIC8vIDIwME1CXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBmb3JtLnBhcnNlKHJlcSwgKGVyciwgZmllbGRzLCBmaWxlcykgPT4ge1xuICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBwYXJzaW5nIGZvcm06JywgZXJyKTtcbiAgICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6ICdFcnJvciBwYXJzaW5nIGZvcm0gZGF0YScsIGRldGFpbHM6IGVyci5tZXNzYWdlIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnRm9ybSBwYXJzZWQgc3VjY2Vzc2Z1bGx5Jyk7XG5cbiAgICAgICAgICAgIGNvbnN0IGZpbGUgPSAoZmlsZXMuZmlsZSBhcyBGaWxlW10pPy5bMF07XG4gICAgICAgICAgICBpZiAoIWZpbGUpIHtcbiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignTm8gZmlsZSB1cGxvYWRlZCcpO1xuICAgICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogJ05vIGZpbGUgdXBsb2FkZWQnIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnRmlsZSByZWNlaXZlZDonLCBmaWxlLm9yaWdpbmFsRmlsZW5hbWUpO1xuXG4gICAgICAgICAgICBpZiAoZmlsZS5zaXplID4gMjAwICogMTAyNCAqIDEwMjQpIHtcbiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignRmlsZSBzaXplIGV4Y2VlZHMgbGltaXQ6JywgZmlsZS5zaXplKTtcbiAgICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6ICdGaWxlIHNpemUgZXhjZWVkcyAyMDBNQiBsaW1pdCcgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChmaWxlLm1pbWV0eXBlICE9PSAndmlkZW8vbXA0Jykge1xuICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdJbnZhbGlkIGZpbGUgdHlwZTonLCBmaWxlLm1pbWV0eXBlKTtcbiAgICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6ICdPbmx5IE1QNCBmaWxlcyBhcmUgYWxsb3dlZCcgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIOeUn+aIkOaWsOeahOaWh+S7tuWQjVxuICAgICAgICAgICAgY29uc3Qgb3JpZ2luYWxOYW1lID0gcGF0aC5wYXJzZShmaWxlLm9yaWdpbmFsRmlsZW5hbWUgfHwgJycpLm5hbWU7XG4gICAgICAgICAgICBjb25zdCBleHRlbnNpb24gPSBwYXRoLnBhcnNlKGZpbGUub3JpZ2luYWxGaWxlbmFtZSB8fCAnJykuZXh0O1xuICAgICAgICAgICAgbGV0IG5ld0ZpbGVuYW1lID0gYCR7b3JpZ2luYWxOYW1lfSR7ZXh0ZW5zaW9ufWA7XG4gICAgICAgICAgICBsZXQgY291bnRlciA9IDE7XG5cbiAgICAgICAgICAgIC8vIOajgOafpeaWh+S7tuaYr+WQpuW3suWtmOWcqO+8jOWmguaenOWtmOWcqOWImemHjeWRveWQjVxuICAgICAgICAgICAgd2hpbGUgKGZzLmV4aXN0c1N5bmMocGF0aC5qb2luKHVwbG9hZERpciwgbmV3RmlsZW5hbWUpKSkge1xuICAgICAgICAgICAgICBuZXdGaWxlbmFtZSA9IGAke29yaWdpbmFsTmFtZX0oJHtjb3VudGVyfSkke2V4dGVuc2lvbn1gO1xuICAgICAgICAgICAgICBjb3VudGVyKys7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IG5ld1BhdGggPSBwYXRoLmpvaW4odXBsb2FkRGlyLCBuZXdGaWxlbmFtZSk7XG4gICAgICAgICAgICBmcy5yZW5hbWVTeW5jKGZpbGUuZmlsZXBhdGgsIG5ld1BhdGgpO1xuXG4gICAgICAgICAgICBjb25zdCBmaWxlSW5mbyA9IHtcbiAgICAgICAgICAgICAgb3JpZ2luYWxOYW1lOiBmaWxlLm9yaWdpbmFsRmlsZW5hbWUsXG4gICAgICAgICAgICAgIG5hbWU6IG5ld0ZpbGVuYW1lLFxuICAgICAgICAgICAgICBzaXplOiBmaWxlLnNpemUsXG4gICAgICAgICAgICAgIHR5cGU6IGZpbGUubWltZXR5cGUsXG4gICAgICAgICAgICAgIHVwbG9hZGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8vIOa3u+WKoOaWh+S7tuiusOW9lVxuICAgICAgICAgICAgY29uc3QgcmVjb3JkcyA9IEpTT04ucGFyc2UoZnMucmVhZEZpbGVTeW5jKHJlY29yZHNGaWxlLCAndXRmLTgnKSk7XG4gICAgICAgICAgICByZWNvcmRzLnB1c2goZmlsZUluZm8pO1xuICAgICAgICAgICAgZnMud3JpdGVGaWxlU3luYyhyZWNvcmRzRmlsZSwgSlNPTi5zdHJpbmdpZnkocmVjb3JkcywgbnVsbCwgMikpO1xuXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnRmlsZSB1cGxvYWRlZCBzdWNjZXNzZnVsbHk6JywgZmlsZUluZm8pO1xuXG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oeyBtZXNzYWdlOiAnRmlsZSB1cGxvYWRlZCBzdWNjZXNzZnVsbHknLCBmaWxlSW5mbyB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXMuc2V0SGVhZGVyKCdBbGxvdycsIFsnUE9TVCddKTtcbiAgICAgICAgICByZXMuc3RhdHVzKDQwNSkuZW5kKGBNZXRob2QgJHtyZXEubWV0aG9kfSBOb3QgQWxsb3dlZGApO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlICdsaXN0JzpcbiAgICAgICAgaWYgKHJlcS5tZXRob2QgPT09ICdHRVQnKSB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHJlY29yZHMgPSBKU09OLnBhcnNlKGZzLnJlYWRGaWxlU3luYyhyZWNvcmRzRmlsZSwgJ3V0Zi04JykpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1JlY29yZHMgcmV0cmlldmVkOicsIHJlY29yZHMpO1xuICAgICAgICAgICAgcmVzLnN0YXR1cygyMDApLmpzb24ocmVjb3Jkcyk7XG4gICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHJlYWRpbmcgcmVjb3JkcyBmaWxlOicsIGVycm9yKTtcbiAgICAgICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6ICdFcnJvciByZXRyaWV2aW5nIGZpbGUgcmVjb3JkcycgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlcy5zZXRIZWFkZXIoJ0FsbG93JywgWydHRVQnXSk7XG4gICAgICAgICAgcmVzLnN0YXR1cyg0MDUpLmVuZChgTWV0aG9kICR7cmVxLm1ldGhvZH0gTm90IEFsbG93ZWRgKTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSAnZGVsZXRlJzpcbiAgICAgICAgaWYgKHJlcS5tZXRob2QgPT09ICdERUxFVEUnKSB7XG4gICAgICAgICAgLy8g5L2/55SoIFVSTCDlj4LmlbDogIzkuI3mmK/or7fmsYLkvZNcbiAgICAgICAgICBjb25zdCB7IGZpbGVuYW1lIH0gPSByZXEucXVlcnk7XG4gICAgICAgICAgaWYgKCFmaWxlbmFtZSB8fCB0eXBlb2YgZmlsZW5hbWUgIT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogJ0ZpbGVuYW1lIGlzIHJlcXVpcmVkJyB9KTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBjb25zdCBmaWxlUGF0aCA9IHBhdGguam9pbih1cGxvYWREaXIsIGZpbGVuYW1lKTtcbiAgICAgICAgICBjb25zdCBhdWRpb0ZpbGVQYXRoID0gcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksICdkb3dubG9hZCcsICdtcDMnLCBgJHtwYXRoLnBhcnNlKGZpbGVuYW1lKS5uYW1lfS5tcDNgKTtcbiAgICAgICAgICBcbiAgICAgICAgICBjb25zb2xlLmxvZygnQXR0ZW1wdGluZyB0byBkZWxldGUgZmlsZTonLCBmaWxlUGF0aCk7XG4gICAgICAgICAgXG4gICAgICAgICAgaWYgKGZzLmV4aXN0c1N5bmMoZmlsZVBhdGgpKSB7XG4gICAgICAgICAgICBmcy51bmxpbmtTeW5jKGZpbGVQYXRoKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdWaWRlbyBmaWxlIGRlbGV0ZWQgc3VjY2Vzc2Z1bGx5Jyk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIOWIoOmZpOWvueW6lOeahOmfs+mikeaWh+S7tu+8iOWmguaenOWtmO+/ve+/ve+8iVxuICAgICAgICAgICAgaWYgKGZzLmV4aXN0c1N5bmMoYXVkaW9GaWxlUGF0aCkpIHtcbiAgICAgICAgICAgICAgZnMudW5saW5rU3luYyhhdWRpb0ZpbGVQYXRoKTtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0F1ZGlvIGZpbGUgZGVsZXRlZCBzdWNjZXNzZnVsbHknKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8g5pu05paw6K6w5b2V5paH5Lu2XG4gICAgICAgICAgICBjb25zdCByZWNvcmRzID0gSlNPTi5wYXJzZShmcy5yZWFkRmlsZVN5bmMocmVjb3Jkc0ZpbGUsICd1dGYtOCcpKTtcbiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZWRSZWNvcmRzID0gcmVjb3Jkcy5maWx0ZXIoKHJlY29yZDogRmlsZUluZm8pID0+IHJlY29yZC5uYW1lICE9PSBmaWxlbmFtZSk7XG4gICAgICAgICAgICBmcy53cml0ZUZpbGVTeW5jKHJlY29yZHNGaWxlLCBKU09OLnN0cmluZ2lmeSh1cGRhdGVkUmVjb3JkcywgbnVsbCwgMikpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXMuc3RhdHVzKDIwMCkuanNvbih7IG1lc3NhZ2U6ICdGaWxlIGRlbGV0ZWQgc3VjY2Vzc2Z1bGx5JyB9KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ0ZpbGUgbm90IGZvdW5kOicsIGZpbGVQYXRoKTtcbiAgICAgICAgICAgIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgZXJyb3I6ICdGaWxlIG5vdCBmb3VuZCcgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlcy5zZXRIZWFkZXIoJ0FsbG93JywgWydERUxFVEUnXSk7XG4gICAgICAgICAgcmVzLnN0YXR1cyg0MDUpLmVuZChgTWV0aG9kICR7cmVxLm1ldGhvZH0gTm90IEFsbG93ZWRgKTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSAncmVuYW1lJzpcbiAgICAgICAgaWYgKHJlcS5tZXRob2QgPT09ICdQVVQnKSB7XG4gICAgICAgICAgY29uc3QgeyBvbGROYW1lLCBuZXdOYW1lIH0gPSByZXEuYm9keTtcbiAgICAgICAgICBjb25zdCBvbGRQYXRoID0gcGF0aC5qb2luKHVwbG9hZERpciwgb2xkTmFtZSk7XG4gICAgICAgICAgY29uc3QgbmV3UGF0aCA9IHBhdGguam9pbih1cGxvYWREaXIsIG5ld05hbWUpO1xuICAgICAgICAgIGlmIChmcy5leGlzdHNTeW5jKG9sZFBhdGgpKSB7XG4gICAgICAgICAgICBmcy5yZW5hbWVTeW5jKG9sZFBhdGgsIG5ld1BhdGgpO1xuICAgICAgICAgICAgcmVzLnN0YXR1cygyMDApLmpzb24oeyBtZXNzYWdlOiAnRmlsZSByZW5hbWVkIHN1Y2Nlc3NmdWxseScgfSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgZXJyb3I6ICdGaWxlIG5vdCBmb3VuZCcgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlcy5zZXRIZWFkZXIoJ0FsbG93JywgWydQVVQnXSk7XG4gICAgICAgICAgcmVzLnN0YXR1cyg0MDUpLmVuZChgTWV0aG9kICR7cmVxLm1ldGhvZH0gTm90IEFsbG93ZWRgKTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSAnZXh0cmFjdEF1ZGlvJzpcbiAgICAgICAgaWYgKHJlcS5tZXRob2QgPT09ICdQT1NUJykge1xuICAgICAgICAgIGNvbnN0IGZvcm0gPSBmb3JtaWRhYmxlKCk7XG4gICAgICAgICAgZm9ybS5wYXJzZShyZXEsIGFzeW5jIChlcnIsIGZpZWxkcywgZmlsZXMpID0+IHtcbiAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgcGFyc2luZyBmb3JtOicsIGVycik7XG4gICAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yOiAnRXJyb3IgcGFyc2luZyBmb3JtIGRhdGEnIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCBmaWxlbmFtZSA9IEFycmF5LmlzQXJyYXkoZmllbGRzLmZpbGVuYW1lKSA/IGZpZWxkcy5maWxlbmFtZVswXSA6IGZpZWxkcy5maWxlbmFtZTtcbiAgICAgICAgICAgIGlmICghZmlsZW5hbWUpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6ICdGaWxlbmFtZSBpcyByZXF1aXJlZCcgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdFeHRyYWN0aW5nIGF1ZGlvIGZvciBmaWxlOicsIGZpbGVuYW1lKTtcblxuICAgICAgICAgICAgY29uc3QgdmlkZW9QYXRoID0gcGF0aC5qb2luKHVwbG9hZERpciwgZmlsZW5hbWUpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ0Z1bGwgdmlkZW8gcGF0aDonLCB2aWRlb1BhdGgpO1xuXG4gICAgICAgICAgICBpZiAoIWZzLmV4aXN0c1N5bmModmlkZW9QYXRoKSkge1xuICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdWaWRlbyBmaWxlIG5vdCBmb3VuZDonLCB2aWRlb1BhdGgpO1xuICAgICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBlcnJvcjogJ1ZpZGVvIGZpbGUgbm90IGZvdW5kJyB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgLy8g5Zyo5o+Q5Y+W6Z+z6aKR5LmL5YmN5qOA5p+lIEZGbXBlZ1xuICAgICAgICAgICAgICBjb25zdCBmZm1wZWdBdmFpbGFibGUgPSBhd2FpdCBjaGVja0ZGbXBlZygpO1xuICAgICAgICAgICAgICBpZiAoIWZmbXBlZ0F2YWlsYWJsZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yOiAnRkZtcGVnIGlzIG5vdCBhdmFpbGFibGUnIH0pO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgLy8g6I635Y+WIEZGbXBlZyDniYjmnKxcbiAgICAgICAgICAgICAgY29uc3QgZmZtcGVnVmVyc2lvbiA9IGF3YWl0IGdldEZGbXBlZ1ZlcnNpb24oKTtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0ZGbXBlZyB2ZXJzaW9uOicsIGZmbXBlZ1ZlcnNpb24pO1xuXG4gICAgICAgICAgICAgIC8vIOS9v+eUqCBTU0UgKFNlcnZlci1TZW50IEV2ZW50cykg5p2l5oql5ZGK6L+b5bqmXG4gICAgICAgICAgICAgIHJlcy53cml0ZUhlYWQoMjAwLCB7XG4gICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICd0ZXh0L2V2ZW50LXN0cmVhbScsXG4gICAgICAgICAgICAgICAgJ0NhY2hlLUNvbnRyb2wnOiAnbm8tY2FjaGUnLFxuICAgICAgICAgICAgICAgICdDb25uZWN0aW9uJzogJ2tlZXAtYWxpdmUnXG4gICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgIGNvbnN0IGF1ZGlvUGF0aCA9IGF3YWl0IGV4dHJhY3RBdWRpbyh2aWRlb1BhdGgpO1xuICAgICAgICAgICAgICBjb25zdCBhdWRpb0ZpbGVuYW1lID0gcGF0aC5iYXNlbmFtZShhdWRpb1BhdGgpO1xuICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0F1ZGlvIGV4dHJhY3RlZCBzdWNjZXNzZnVsbHk6JywgYXVkaW9GaWxlbmFtZSk7XG5cbiAgICAgICAgICAgICAgLy8g6I635Y+W6Z+z6aKR5pe26ZW/XG4gICAgICAgICAgICAgIGNvbnN0IGR1cmF0aW9uID0gYXdhaXQgZ2V0QXVkaW9EdXJhdGlvbihhdWRpb1BhdGgpO1xuXG4gICAgICAgICAgICAgIC8vIOiOt+WPlumfs+mikeaWh+S7tuWkp+Wwj1xuICAgICAgICAgICAgICBjb25zdCB7IHNpemUgfSA9IGZzLnN0YXRTeW5jKGF1ZGlvUGF0aCk7XG5cbiAgICAgICAgICAgICAgLy8g5pu05paw5paH5Lu26K6w5b2VXG4gICAgICAgICAgICAgIGNvbnN0IHJlY29yZHMgPSBKU09OLnBhcnNlKGZzLnJlYWRGaWxlU3luYyhyZWNvcmRzRmlsZSwgJ3V0Zi04JykpO1xuICAgICAgICAgICAgICBjb25zdCB1cGRhdGVkUmVjb3JkcyA9IHJlY29yZHMubWFwKChyZWNvcmQ6IEZpbGVJbmZvKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHJlY29yZC5uYW1lID09PSBmaWxlbmFtZSkge1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgLi4ucmVjb3JkLCBhdWRpb0ZpbGU6IGF1ZGlvRmlsZW5hbWUgfTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlY29yZDtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIGZzLndyaXRlRmlsZVN5bmMocmVjb3Jkc0ZpbGUsIEpTT04uc3RyaW5naWZ5KHVwZGF0ZWRSZWNvcmRzLCBudWxsLCAyKSk7XG5cbiAgICAgICAgICAgICAgcmVzLndyaXRlKGBkYXRhOiAke0pTT04uc3RyaW5naWZ5KHsgY29tcGxldGU6IHRydWUsIGF1ZGlvRmlsZTogYXVkaW9GaWxlbmFtZSwgZHVyYXRpb24sIHNpemUgfSl9XFxuXFxuYCk7XG4gICAgICAgICAgICAgIHJlcy5lbmQoKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGV4dHJhY3RpbmcgYXVkaW86JywgZXJyb3IpO1xuICAgICAgICAgICAgICByZXMud3JpdGUoYGRhdGE6ICR7SlNPTi5zdHJpbmdpZnkoeyBlcnJvcjogJ0Vycm9yIGV4dHJhY3RpbmcgYXVkaW8nLCBkZXRhaWxzOiAoZXJyb3IgYXMgRXJyb3IpLm1lc3NhZ2UgfSl9XFxuXFxuYCk7XG4gICAgICAgICAgICAgIHJlcy5lbmQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXMuc2V0SGVhZGVyKCdBbGxvdycsIFsnUE9TVCddKTtcbiAgICAgICAgICByZXMuc3RhdHVzKDQwNSkuZW5kKGBNZXRob2QgJHtyZXEubWV0aG9kfSBOb3QgQWxsb3dlZGApO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlICdnZXRBdWRpbyc6XG4gICAgICAgIGlmIChyZXEubWV0aG9kID09PSAnR0VUJykge1xuICAgICAgICAgIGNvbnN0IHsgZmlsZW5hbWUgfSA9IHJlcS5xdWVyeTtcbiAgICAgICAgICBpZiAoIWZpbGVuYW1lIHx8IHR5cGVvZiBmaWxlbmFtZSAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiAnRmlsZW5hbWUgaXMgcmVxdWlyZWQnIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCBhdWRpb1BhdGggPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJ2Rvd25sb2FkJywgJ21wMycsIGZpbGVuYW1lKTtcbiAgICAgICAgICBjb25zb2xlLmxvZygnQXR0ZW1wdGluZyB0byBzZXJ2ZSBhdWRpbyBmaWxlOicsIGF1ZGlvUGF0aCk7XG4gICAgICAgICAgaWYgKGZzLmV4aXN0c1N5bmMoYXVkaW9QYXRoKSkge1xuICAgICAgICAgICAgY29uc3Qgc3RhdCA9IGZzLnN0YXRTeW5jKGF1ZGlvUGF0aCk7XG4gICAgICAgICAgICByZXMud3JpdGVIZWFkKDIwMCwge1xuICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2F1ZGlvL21wZWcnLFxuICAgICAgICAgICAgICAnQ29udGVudC1MZW5ndGgnOiBzdGF0LnNpemVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY29uc3QgcmVhZFN0cmVhbSA9IGZzLmNyZWF0ZVJlYWRTdHJlYW0oYXVkaW9QYXRoKTtcbiAgICAgICAgICAgIHJlYWRTdHJlYW0ucGlwZShyZXMpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnQXVkaW8gZmlsZSBub3QgZm91bmQ6JywgYXVkaW9QYXRoKTtcbiAgICAgICAgICAgIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgZXJyb3I6ICdBdWRpbyBmaWxlIG5vdCBmb3VuZCcgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlcy5zZXRIZWFkZXIoJ0FsbG93JywgWydHRVQnXSk7XG4gICAgICAgICAgcmVzLnN0YXR1cyg0MDUpLmVuZChgTWV0aG9kICR7cmVxLm1ldGhvZH0gTm90IEFsbG93ZWRgKTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSAnZ2V0QXVkaW9VcmwnOlxuICAgICAgICBpZiAocmVxLm1ldGhvZCA9PT0gJ0dFVCcpIHtcbiAgICAgICAgICBjb25zdCB7IGZpbGVuYW1lIH0gPSByZXEucXVlcnk7XG4gICAgICAgICAgaWYgKHR5cGVvZiBmaWxlbmFtZSAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiAnSW52YWxpZCBmaWxlbmFtZScgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCB1cmwgPSBhd2FpdCBnZXRBdWRpb0ZpbGVVcmwoZmlsZW5hbWUpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ0F1ZGlvIFVSTCBnZW5lcmF0ZWQ6JywgdXJsKTsgLy8g5re75Yqg5pel5b+XXG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oeyB1cmwgfSk7XG4gICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGdldHRpbmcgYXVkaW8gVVJMOicsIGVycm9yKTsgLy8g5re75Yqg6ZSZ6K+v5pel5b+XXG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBlcnJvcjogJ0F1ZGlvIGZpbGUgbm90IGZvdW5kJyB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzLnNldEhlYWRlcignQWxsb3cnLCBbJ0dFVCddKTtcbiAgICAgICAgICByZXMuc3RhdHVzKDQwNSkuZW5kKGBNZXRob2QgJHtyZXEubWV0aG9kfSBOb3QgQWxsb3dlZGApO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBkZWZhdWx0OlxuICAgICAgICBjb25zb2xlLmVycm9yKCdJbnZhbGlkIGFjdGlvbjonLCBhY3Rpb24pO1xuICAgICAgICByZXMuc3RhdHVzKDQwNCkuanNvbih7IGVycm9yOiAnQWN0aW9uIG5vdCBmb3VuZCcgfSk7XG4gICAgfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1VuZXhwZWN0ZWQgZXJyb3I6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6ICdBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkJywgZGV0YWlsczogKGVycm9yIGFzIEVycm9yKS5tZXNzYWdlIH0pO1xuICB9XG59XG4iXSwibmFtZXMiOlsiZm9ybWlkYWJsZSIsImZzIiwicGF0aCIsImV4dHJhY3RBdWRpbyIsImdldEF1ZGlvRHVyYXRpb24iLCJjaGVja0ZGbXBlZyIsImdldEZGbXBlZ1ZlcnNpb24iLCJnZXRBdWRpb0ZpbGVVcmwiLCJjb25maWciLCJhcGkiLCJib2R5UGFyc2VyIiwidXBsb2FkRGlyIiwiam9pbiIsInByb2Nlc3MiLCJjd2QiLCJyZWNvcmRzRmlsZSIsImV4aXN0c1N5bmMiLCJta2RpclN5bmMiLCJyZWN1cnNpdmUiLCJ3cml0ZUZpbGVTeW5jIiwiSlNPTiIsInN0cmluZ2lmeSIsImhhbmRsZXIiLCJyZXEiLCJyZXMiLCJhY3Rpb24iLCJxdWVyeSIsImNvbnNvbGUiLCJsb2ciLCJtZXRob2QiLCJmZm1wZWdBdmFpbGFibGUiLCJzdGF0dXMiLCJqc29uIiwiZXJyb3IiLCJmb3JtIiwia2VlcEV4dGVuc2lvbnMiLCJtYXhGaWxlU2l6ZSIsInBhcnNlIiwiZXJyIiwiZmllbGRzIiwiZmlsZXMiLCJkZXRhaWxzIiwibWVzc2FnZSIsImZpbGUiLCJvcmlnaW5hbEZpbGVuYW1lIiwic2l6ZSIsIm1pbWV0eXBlIiwib3JpZ2luYWxOYW1lIiwibmFtZSIsImV4dGVuc2lvbiIsImV4dCIsIm5ld0ZpbGVuYW1lIiwiY291bnRlciIsIm5ld1BhdGgiLCJyZW5hbWVTeW5jIiwiZmlsZXBhdGgiLCJmaWxlSW5mbyIsInR5cGUiLCJ1cGxvYWRlZEF0IiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwicmVjb3JkcyIsInJlYWRGaWxlU3luYyIsInB1c2giLCJzZXRIZWFkZXIiLCJlbmQiLCJmaWxlbmFtZSIsImZpbGVQYXRoIiwiYXVkaW9GaWxlUGF0aCIsInVubGlua1N5bmMiLCJ1cGRhdGVkUmVjb3JkcyIsImZpbHRlciIsInJlY29yZCIsIm9sZE5hbWUiLCJuZXdOYW1lIiwiYm9keSIsIm9sZFBhdGgiLCJBcnJheSIsImlzQXJyYXkiLCJ2aWRlb1BhdGgiLCJmZm1wZWdWZXJzaW9uIiwid3JpdGVIZWFkIiwiYXVkaW9QYXRoIiwiYXVkaW9GaWxlbmFtZSIsImJhc2VuYW1lIiwiZHVyYXRpb24iLCJzdGF0U3luYyIsIm1hcCIsImF1ZGlvRmlsZSIsIndyaXRlIiwiY29tcGxldGUiLCJzdGF0IiwicmVhZFN0cmVhbSIsImNyZWF0ZVJlYWRTdHJlYW0iLCJwaXBlIiwidXJsIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./pages/api/files/[action].ts\n");

/***/ }),

/***/ "(api)/./utils/videoProcessor.ts":
/*!*********************************!*\
  !*** ./utils/videoProcessor.ts ***!
  \*********************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   checkFFmpeg: () => (/* binding */ checkFFmpeg),\n/* harmony export */   cleanText: () => (/* binding */ cleanText),\n/* harmony export */   convertSpeechToText: () => (/* binding */ convertSpeechToText),\n/* harmony export */   extractAudio: () => (/* binding */ extractAudio),\n/* harmony export */   getAudioDuration: () => (/* binding */ getAudioDuration),\n/* harmony export */   getAudioFileUrl: () => (/* binding */ getAudioFileUrl),\n/* harmony export */   getFFmpegVersion: () => (/* binding */ getFFmpegVersion),\n/* harmony export */   processVideo: () => (/* binding */ processVideo)\n/* harmony export */ });\n/* harmony import */ var child_process__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! child_process */ \"child_process\");\n/* harmony import */ var child_process__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(child_process__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var openai__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! openai */ \"openai\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_4__);\n/* harmony import */ var fluent_ffmpeg__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! fluent-ffmpeg */ \"fluent-ffmpeg\");\n/* harmony import */ var fluent_ffmpeg__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(fluent_ffmpeg__WEBPACK_IMPORTED_MODULE_5__);\n/* harmony import */ var _ffmpeg_installer_ffmpeg__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @ffmpeg-installer/ffmpeg */ \"@ffmpeg-installer/ffmpeg\");\n/* harmony import */ var _ffmpeg_installer_ffmpeg__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(_ffmpeg_installer_ffmpeg__WEBPACK_IMPORTED_MODULE_6__);\n/* harmony import */ var _ffprobe_installer_ffprobe__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @ffprobe-installer/ffprobe */ \"@ffprobe-installer/ffprobe\");\n/* harmony import */ var _ffprobe_installer_ffprobe__WEBPACK_IMPORTED_MODULE_7___default = /*#__PURE__*/__webpack_require__.n(_ffprobe_installer_ffprobe__WEBPACK_IMPORTED_MODULE_7__);\n/* harmony import */ var util__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! util */ \"util\");\n/* harmony import */ var util__WEBPACK_IMPORTED_MODULE_8___default = /*#__PURE__*/__webpack_require__.n(util__WEBPACK_IMPORTED_MODULE_8__);\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([openai__WEBPACK_IMPORTED_MODULE_3__]);\nopenai__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n\n\n\n\n\n\nconst configuration = new openai__WEBPACK_IMPORTED_MODULE_3__.Configuration({\n    apiKey: process.env.OPENAI_API_KEY,\n    basePath: \"https://api.openai-hub.com/v1\"\n});\nconst openai = new openai__WEBPACK_IMPORTED_MODULE_3__.OpenAIApi(configuration);\nconst mongoUri = process.env.MONGODB_URI;\nif (!mongoUri) {\n    console.error(\"MONGODB_URI is not defined in the environment variables\");\n    process.exit(1);\n}\nconsole.log(\"MongoDB URI:\", mongoUri);\nlet mongoClient = null;\nasync function getMongoClient() {\n    if (!mongoUri) {\n        throw new Error(\"MONGODB_URI is not defined\");\n    }\n    if (!mongoClient) {\n        try {\n            mongoClient = new mongodb__WEBPACK_IMPORTED_MODULE_4__.MongoClient(mongoUri);\n            await mongoClient.connect();\n            console.log(\"Connected successfully to MongoDB\");\n        } catch (error) {\n            console.error(\"Failed to connect to MongoDB:\", error);\n            throw error;\n        }\n    }\n    return mongoClient;\n}\nfunction runCommand(command) {\n    return new Promise((resolve, reject)=>{\n        (0,child_process__WEBPACK_IMPORTED_MODULE_0__.exec)(command, {\n            encoding: \"utf8\"\n        }, (error, stdout, stderr)=>{\n            if (error) {\n                console.error(`Error executing command: ${command}`);\n                console.error(`Error: ${error}`);\n                console.error(`stderr: ${stderr}`);\n                reject(error);\n            } else {\n                resolve(stdout);\n            }\n        });\n    });\n}\nasync function processVideo(filePath) {\n    try {\n        // 1. 音频分离\n        const audioFile = await extractAudio(filePath);\n        // 2. 音频转文本\n        const textContent = await convertSpeechToText(audioFile);\n        // 3. 文本清洗\n        const cleanedText = await cleanText(textContent);\n        // 4. 文本存储\n        await storeText([\n            cleanedText\n        ]);\n        // 5. 高级分析\n        const analysisResult = await performAdvancedAnalysis([\n            cleanedText\n        ]);\n        return analysisResult;\n    } catch (error) {\n        console.error(\"Error in video processing:\", error);\n        throw error;\n    }\n}\nfunction extractAudio(videoPath) {\n    return new Promise((resolve, reject)=>{\n        const outputDir = path__WEBPACK_IMPORTED_MODULE_2___default().join(process.cwd(), \"download\", \"mp3\");\n        if (!fs__WEBPACK_IMPORTED_MODULE_1___default().existsSync(outputDir)) {\n            fs__WEBPACK_IMPORTED_MODULE_1___default().mkdirSync(outputDir, {\n                recursive: true\n            });\n        }\n        const outputPath = path__WEBPACK_IMPORTED_MODULE_2___default().join(outputDir, `${path__WEBPACK_IMPORTED_MODULE_2___default().basename(videoPath, \".mp4\")}.mp3`);\n        console.log(\"Input video path:\", videoPath);\n        console.log(\"Output audio path:\", outputPath);\n        if (fs__WEBPACK_IMPORTED_MODULE_1___default().existsSync(outputPath)) {\n            fs__WEBPACK_IMPORTED_MODULE_1___default().unlinkSync(outputPath);\n        }\n        fluent_ffmpeg__WEBPACK_IMPORTED_MODULE_5___default()(videoPath).outputOptions(\"-vn\").audioCodec(\"libmp3lame\").audioChannels(2).audioBitrate(\"192k\").output(outputPath).on(\"end\", ()=>{\n            console.log(\"Audio extraction completed:\", outputPath);\n            resolve(outputPath);\n        }).on(\"error\", (err)=>{\n            console.error(\"Error during audio extraction:\", err);\n            reject(err);\n        }).run();\n    });\n}\nasync function convertSpeechToText(audioFile) {\n    try {\n        const response = await openai.createTranscription(fs__WEBPACK_IMPORTED_MODULE_1___default().createReadStream(audioFile), \"whisper-1\");\n        const transcription = response.data.text;\n        // 保存转录文本为 txt 文件\n        const txtFilePath = audioFile.replace(\".mp3\", \".txt\");\n        await fs__WEBPACK_IMPORTED_MODULE_1__.promises.writeFile(txtFilePath, transcription, \"utf-8\");\n        console.log(\"Transcription saved to:\", txtFilePath);\n        return transcription;\n    } catch (error) {\n        console.error(\"Error in speech to text conversion:\", error);\n        throw error;\n    }\n}\nasync function cleanText(text) {\n    // 这里可以实现文本清洗的逻辑\n    // 例如：移除特殊字符，纠正常见错误等\n    let cleanedText = text.replace(/[^\\w\\s.,?!]/g, \"\");\n    cleanedText = cleanedText.replace(/\\s+/g, \" \").trim();\n    return cleanedText;\n}\nasync function storeText(texts) {\n    const client = await getMongoClient();\n    try {\n        const db = client.db(\"video_analysis\");\n        const collection = db.collection(\"transcripts\");\n        await collection.insertMany(texts.map((text)=>({\n                content: text\n            })));\n        console.log(\"Texts stored successfully in MongoDB\");\n    } catch (error) {\n        console.error(\"Error storing texts in MongoDB:\", error);\n        throw error;\n    }\n}\nasync function performAdvancedAnalysis(texts) {\n    return {\n        analysis: \"Sample analysis result\"\n    };\n}\nasync function getAudioDuration(audioPath) {\n    return new Promise((resolve, reject)=>{\n        fluent_ffmpeg__WEBPACK_IMPORTED_MODULE_5___default().ffprobe(audioPath, (err, metadata)=>{\n            if (err) {\n                console.error(\"Error getting audio duration:\", err);\n                reject(err);\n            } else {\n                const duration = metadata.format.duration;\n                console.log(\"Audio duration:\", duration);\n                resolve(duration || 0); // 添加 || 0 来确保返回一个数字\n            }\n        });\n    });\n}\nasync function checkFFmpeg() {\n    try {\n        const getAvailableFormats = (0,util__WEBPACK_IMPORTED_MODULE_8__.promisify)((fluent_ffmpeg__WEBPACK_IMPORTED_MODULE_5___default().getAvailableFormats));\n        await getAvailableFormats();\n        console.log(\"FFmpeg is available\");\n        return true;\n    } catch (error) {\n        console.error(\"Error checking FFmpeg:\", error);\n        return false;\n    }\n}\nasync function getFFmpegVersion() {\n    try {\n        const getAvailableCodecs = (0,util__WEBPACK_IMPORTED_MODULE_8__.promisify)((fluent_ffmpeg__WEBPACK_IMPORTED_MODULE_5___default().getAvailableCodecs));\n        const getAvailableEncoders = (0,util__WEBPACK_IMPORTED_MODULE_8__.promisify)((fluent_ffmpeg__WEBPACK_IMPORTED_MODULE_5___default().getAvailableEncoders));\n        const codecs = await getAvailableCodecs();\n        const encoders = await getAvailableEncoders();\n        return `FFmpeg version: available (codecs: ${Object.keys(codecs).length}, encoders: ${Object.keys(encoders).length})`;\n    } catch (error) {\n        console.error(\"Error getting FFmpeg version:\", error);\n        return \"FFmpeg version: unavailable\";\n    }\n}\nfluent_ffmpeg__WEBPACK_IMPORTED_MODULE_5___default().setFfmpegPath((_ffmpeg_installer_ffmpeg__WEBPACK_IMPORTED_MODULE_6___default().path));\nfluent_ffmpeg__WEBPACK_IMPORTED_MODULE_5___default().setFfprobePath((_ffprobe_installer_ffprobe__WEBPACK_IMPORTED_MODULE_7___default().path));\nasync function getAudioFileUrl(filename) {\n    const filePath = path__WEBPACK_IMPORTED_MODULE_2___default().join(process.cwd(), \"download\", \"mp3\", filename);\n    console.log(\"Checking for audio file at:\", filePath); // 添加日志\n    if (fs__WEBPACK_IMPORTED_MODULE_1___default().existsSync(filePath)) {\n        return `/api/files/download/mp3/${encodeURIComponent(filename)}`;\n    } else {\n        console.error(\"Audio file not found:\", filePath); // 添加错误日志\n        throw new Error(\"Audio file not found\");\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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T0MsSUFBSSxDQUFDSCxRQUFRSSxNQUFNLENBQUMsWUFBWSxFQUFFRixPQUFPQyxJQUFJLENBQUNGLFVBQVVHLE1BQU0sQ0FBQyxDQUFDLENBQUM7SUFDdkgsRUFBRSxPQUFPN0UsT0FBTztRQUNkRCxRQUFRQyxLQUFLLENBQUMsaUNBQWlDQTtRQUMvQyxPQUFPO0lBQ1Q7QUFDRjtBQUVBaEIsa0VBQW9CLENBQUNDLHNFQUFvQjtBQUN6Q0QsbUVBQXFCLENBQUNFLHdFQUFxQjtBQUVwQyxlQUFlOEYsZ0JBQWdCQyxRQUFnQjtJQUNwRCxNQUFNakUsV0FBV3BDLGdEQUFTLENBQUNZLFFBQVFxQyxHQUFHLElBQUksWUFBWSxPQUFPb0Q7SUFDN0RsRixRQUFRRyxHQUFHLENBQUMsK0JBQStCYyxXQUFXLE9BQU87SUFDN0QsSUFBSXJDLG9EQUFhLENBQUNxQyxXQUFXO1FBQzNCLE9BQU8sQ0FBQyx3QkFBd0IsRUFBRWtFLG1CQUFtQkQsVUFBVSxDQUFDO0lBQ2xFLE9BQU87UUFDTGxGLFFBQVFDLEtBQUssQ0FBQyx5QkFBeUJnQixXQUFXLFNBQVM7UUFDM0QsTUFBTSxJQUFJWCxNQUFNO0lBQ2xCO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly92aWRlby1hbmFseXNpcy1zeXN0ZW0vLi91dGlscy92aWRlb1Byb2Nlc3Nvci50cz9kYjlkIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGV4ZWMgfSBmcm9tICdjaGlsZF9wcm9jZXNzJztcbmltcG9ydCBmcyBmcm9tICdmcyc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7IENvbmZpZ3VyYXRpb24sIE9wZW5BSUFwaSB9IGZyb20gJ29wZW5haSc7XG5pbXBvcnQgeyBNb25nb0NsaWVudCB9IGZyb20gJ21vbmdvZGInO1xuaW1wb3J0IGZmbXBlZyBmcm9tICdmbHVlbnQtZmZtcGVnJztcbmltcG9ydCBmZm1wZWdJbnN0YWxsZXIgZnJvbSAnQGZmbXBlZy1pbnN0YWxsZXIvZmZtcGVnJztcbmltcG9ydCBmZnByb2JlSW5zdGFsbGVyIGZyb20gJ0BmZnByb2JlLWluc3RhbGxlci9mZnByb2JlJztcbmltcG9ydCB7IHByb21pc2lmeSB9IGZyb20gJ3V0aWwnO1xuaW1wb3J0IHsgcHJvbWlzZXMgYXMgZnNQcm9taXNlcyB9IGZyb20gJ2ZzJztcblxuY29uc3QgY29uZmlndXJhdGlvbiA9IG5ldyBDb25maWd1cmF0aW9uKHtcbiAgYXBpS2V5OiBwcm9jZXNzLmVudi5PUEVOQUlfQVBJX0tFWSxcbiAgYmFzZVBhdGg6ICdodHRwczovL2FwaS5vcGVuYWktaHViLmNvbS92MScsIC8vIOS9v+eUqOaCqOaPkOS+m+eahOiHquWumuS5iSBVUkxcbn0pO1xuY29uc3Qgb3BlbmFpID0gbmV3IE9wZW5BSUFwaShjb25maWd1cmF0aW9uKTtcblxuY29uc3QgbW9uZ29VcmkgPSBwcm9jZXNzLmVudi5NT05HT0RCX1VSSTtcbmlmICghbW9uZ29VcmkpIHtcbiAgY29uc29sZS5lcnJvcignTU9OR09EQl9VUkkgaXMgbm90IGRlZmluZWQgaW4gdGhlIGVudmlyb25tZW50IHZhcmlhYmxlcycpO1xuICBwcm9jZXNzLmV4aXQoMSk7XG59XG5cbmNvbnNvbGUubG9nKCdNb25nb0RCIFVSSTonLCBtb25nb1VyaSk7XG5cbmxldCBtb25nb0NsaWVudDogTW9uZ29DbGllbnQgfCBudWxsID0gbnVsbDtcblxuYXN5bmMgZnVuY3Rpb24gZ2V0TW9uZ29DbGllbnQoKSB7XG4gIGlmICghbW9uZ29VcmkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ01PTkdPREJfVVJJIGlzIG5vdCBkZWZpbmVkJyk7XG4gIH1cbiAgaWYgKCFtb25nb0NsaWVudCkge1xuICAgIHRyeSB7XG4gICAgICBtb25nb0NsaWVudCA9IG5ldyBNb25nb0NsaWVudChtb25nb1VyaSk7XG4gICAgICBhd2FpdCBtb25nb0NsaWVudC5jb25uZWN0KCk7XG4gICAgICBjb25zb2xlLmxvZygnQ29ubmVjdGVkIHN1Y2Nlc3NmdWxseSB0byBNb25nb0RCJyk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBjb25uZWN0IHRvIE1vbmdvREI6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG4gIHJldHVybiBtb25nb0NsaWVudDtcbn1cblxuZnVuY3Rpb24gcnVuQ29tbWFuZChjb21tYW5kOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz4ge1xuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgIGV4ZWMoY29tbWFuZCwgeyBlbmNvZGluZzogJ3V0ZjgnIH0sIChlcnJvciwgc3Rkb3V0LCBzdGRlcnIpID0+IHtcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKGBFcnJvciBleGVjdXRpbmcgY29tbWFuZDogJHtjb21tYW5kfWApO1xuICAgICAgICBjb25zb2xlLmVycm9yKGBFcnJvcjogJHtlcnJvcn1gKTtcbiAgICAgICAgY29uc29sZS5lcnJvcihgc3RkZXJyOiAke3N0ZGVycn1gKTtcbiAgICAgICAgcmVqZWN0KGVycm9yKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlc29sdmUoc3Rkb3V0KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBwcm9jZXNzVmlkZW8oZmlsZVBhdGg6IHN0cmluZykge1xuICB0cnkge1xuICAgIC8vIDEuIOmfs+mikeWIhuemu1xuICAgIGNvbnN0IGF1ZGlvRmlsZSA9IGF3YWl0IGV4dHJhY3RBdWRpbyhmaWxlUGF0aCk7XG5cbiAgICAvLyAyLiDpn7PpopHovazmlofmnKxcbiAgICBjb25zdCB0ZXh0Q29udGVudCA9IGF3YWl0IGNvbnZlcnRTcGVlY2hUb1RleHQoYXVkaW9GaWxlKTtcblxuICAgIC8vIDMuIOaWh+acrOa4hea0l1xuICAgIGNvbnN0IGNsZWFuZWRUZXh0ID0gYXdhaXQgY2xlYW5UZXh0KHRleHRDb250ZW50KTtcblxuICAgIC8vIDQuIOaWh+acrOWtmOWCqFxuICAgIGF3YWl0IHN0b3JlVGV4dChbY2xlYW5lZFRleHRdKTtcblxuICAgIC8vIDUuIOmrmOe6p+WIhuaekFxuICAgIGNvbnN0IGFuYWx5c2lzUmVzdWx0ID0gYXdhaXQgcGVyZm9ybUFkdmFuY2VkQW5hbHlzaXMoW2NsZWFuZWRUZXh0XSk7XG5cbiAgICByZXR1cm4gYW5hbHlzaXNSZXN1bHQ7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gdmlkZW8gcHJvY2Vzc2luZzonLCBlcnJvcik7XG4gICAgdGhyb3cgZXJyb3I7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGV4dHJhY3RBdWRpbyh2aWRlb1BhdGg6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiB7XG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgY29uc3Qgb3V0cHV0RGlyID0gcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksICdkb3dubG9hZCcsICdtcDMnKTtcbiAgICBpZiAoIWZzLmV4aXN0c1N5bmMob3V0cHV0RGlyKSkge1xuICAgICAgZnMubWtkaXJTeW5jKG91dHB1dERpciwgeyByZWN1cnNpdmU6IHRydWUgfSk7XG4gICAgfVxuICAgIGNvbnN0IG91dHB1dFBhdGggPSBwYXRoLmpvaW4ob3V0cHV0RGlyLCBgJHtwYXRoLmJhc2VuYW1lKHZpZGVvUGF0aCwgJy5tcDQnKX0ubXAzYCk7XG4gICAgXG4gICAgY29uc29sZS5sb2coJ0lucHV0IHZpZGVvIHBhdGg6JywgdmlkZW9QYXRoKTtcbiAgICBjb25zb2xlLmxvZygnT3V0cHV0IGF1ZGlvIHBhdGg6Jywgb3V0cHV0UGF0aCk7XG5cbiAgICBpZiAoZnMuZXhpc3RzU3luYyhvdXRwdXRQYXRoKSkge1xuICAgICAgZnMudW5saW5rU3luYyhvdXRwdXRQYXRoKTtcbiAgICB9XG5cbiAgICBmZm1wZWcodmlkZW9QYXRoKVxuICAgICAgLm91dHB1dE9wdGlvbnMoJy12bicpXG4gICAgICAuYXVkaW9Db2RlYygnbGlibXAzbGFtZScpXG4gICAgICAuYXVkaW9DaGFubmVscygyKVxuICAgICAgLmF1ZGlvQml0cmF0ZSgnMTkyaycpXG4gICAgICAub3V0cHV0KG91dHB1dFBhdGgpXG4gICAgICAub24oJ2VuZCcsICgpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coJ0F1ZGlvIGV4dHJhY3Rpb24gY29tcGxldGVkOicsIG91dHB1dFBhdGgpO1xuICAgICAgICByZXNvbHZlKG91dHB1dFBhdGgpO1xuICAgICAgfSlcbiAgICAgIC5vbignZXJyb3InLCAoZXJyKSA9PiB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGR1cmluZyBhdWRpbyBleHRyYWN0aW9uOicsIGVycik7XG4gICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgfSlcbiAgICAgIC5ydW4oKTtcbiAgfSk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjb252ZXJ0U3BlZWNoVG9UZXh0KGF1ZGlvRmlsZTogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IG9wZW5haS5jcmVhdGVUcmFuc2NyaXB0aW9uKFxuICAgICAgZnMuY3JlYXRlUmVhZFN0cmVhbShhdWRpb0ZpbGUpIGFzIGFueSxcbiAgICAgIFwid2hpc3Blci0xXCJcbiAgICApO1xuICAgIGNvbnN0IHRyYW5zY3JpcHRpb24gPSByZXNwb25zZS5kYXRhLnRleHQ7XG4gICAgXG4gICAgLy8g5L+d5a2Y6L2s5b2V5paH5pys5Li6IHR4dCDmlofku7ZcbiAgICBjb25zdCB0eHRGaWxlUGF0aCA9IGF1ZGlvRmlsZS5yZXBsYWNlKCcubXAzJywgJy50eHQnKTtcbiAgICBhd2FpdCBmc1Byb21pc2VzLndyaXRlRmlsZSh0eHRGaWxlUGF0aCwgdHJhbnNjcmlwdGlvbiwgJ3V0Zi04Jyk7XG4gICAgXG4gICAgY29uc29sZS5sb2coJ1RyYW5zY3JpcHRpb24gc2F2ZWQgdG86JywgdHh0RmlsZVBhdGgpO1xuICAgIHJldHVybiB0cmFuc2NyaXB0aW9uO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIHNwZWVjaCB0byB0ZXh0IGNvbnZlcnNpb246JywgZXJyb3IpO1xuICAgIHRocm93IGVycm9yO1xuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjbGVhblRleHQodGV4dDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgLy8g6L+Z6YeM5Y+v5Lul5a6e546w5paH5pys5riF5rSX55qE6YC76L6RXG4gIC8vIOS+i+Wmgu+8muenu+mZpOeJueauiuWtl+espu+8jOe6oOato+W4uOingemUmeivr+etiVxuICBsZXQgY2xlYW5lZFRleHQgPSB0ZXh0LnJlcGxhY2UoL1teXFx3XFxzLiw/IV0vZywgJycpO1xuICBjbGVhbmVkVGV4dCA9IGNsZWFuZWRUZXh0LnJlcGxhY2UoL1xccysvZywgJyAnKS50cmltKCk7XG4gIHJldHVybiBjbGVhbmVkVGV4dDtcbn1cblxuYXN5bmMgZnVuY3Rpb24gc3RvcmVUZXh0KHRleHRzOiBzdHJpbmdbXSk6IFByb21pc2U8dm9pZD4ge1xuICBjb25zdCBjbGllbnQgPSBhd2FpdCBnZXRNb25nb0NsaWVudCgpO1xuICB0cnkge1xuICAgIGNvbnN0IGRiID0gY2xpZW50LmRiKCd2aWRlb19hbmFseXNpcycpO1xuICAgIGNvbnN0IGNvbGxlY3Rpb24gPSBkYi5jb2xsZWN0aW9uKCd0cmFuc2NyaXB0cycpO1xuICAgIGF3YWl0IGNvbGxlY3Rpb24uaW5zZXJ0TWFueSh0ZXh0cy5tYXAodGV4dCA9PiAoeyBjb250ZW50OiB0ZXh0IH0pKSk7XG4gICAgY29uc29sZS5sb2coJ1RleHRzIHN0b3JlZCBzdWNjZXNzZnVsbHkgaW4gTW9uZ29EQicpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHN0b3JpbmcgdGV4dHMgaW4gTW9uZ29EQjonLCBlcnJvcik7XG4gICAgdGhyb3cgZXJyb3I7XG4gIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gcGVyZm9ybUFkdmFuY2VkQW5hbHlzaXModGV4dHM6IHN0cmluZ1tdKTogUHJvbWlzZTxhbnk+IHtcbiAgcmV0dXJuIHsgYW5hbHlzaXM6IFwiU2FtcGxlIGFuYWx5c2lzIHJlc3VsdFwiIH07XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBdWRpb0R1cmF0aW9uKGF1ZGlvUGF0aDogc3RyaW5nKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICBmZm1wZWcuZmZwcm9iZShhdWRpb1BhdGgsIChlcnIsIG1ldGFkYXRhKSA9PiB7XG4gICAgICBpZiAoZXJyKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGdldHRpbmcgYXVkaW8gZHVyYXRpb246JywgZXJyKTtcbiAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBkdXJhdGlvbiA9IG1ldGFkYXRhLmZvcm1hdC5kdXJhdGlvbjtcbiAgICAgICAgY29uc29sZS5sb2coJ0F1ZGlvIGR1cmF0aW9uOicsIGR1cmF0aW9uKTtcbiAgICAgICAgcmVzb2x2ZShkdXJhdGlvbiB8fCAwKTsgLy8g5re75YqgIHx8IDAg5p2l56Gu5L+d6L+U5Zue5LiA5Liq5pWw5a2XXG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY2hlY2tGRm1wZWcoKTogUHJvbWlzZTxib29sZWFuPiB7XG4gIHRyeSB7XG4gICAgY29uc3QgZ2V0QXZhaWxhYmxlRm9ybWF0cyA9IHByb21pc2lmeShmZm1wZWcuZ2V0QXZhaWxhYmxlRm9ybWF0cyk7XG4gICAgYXdhaXQgZ2V0QXZhaWxhYmxlRm9ybWF0cygpO1xuICAgIGNvbnNvbGUubG9nKCdGRm1wZWcgaXMgYXZhaWxhYmxlJyk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgY2hlY2tpbmcgRkZtcGVnOicsIGVycm9yKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEZGbXBlZ1ZlcnNpb24oKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBnZXRBdmFpbGFibGVDb2RlY3MgPSBwcm9taXNpZnkoZmZtcGVnLmdldEF2YWlsYWJsZUNvZGVjcyk7XG4gICAgY29uc3QgZ2V0QXZhaWxhYmxlRW5jb2RlcnMgPSBwcm9taXNpZnkoZmZtcGVnLmdldEF2YWlsYWJsZUVuY29kZXJzKTtcbiAgICBcbiAgICBjb25zdCBjb2RlY3MgPSBhd2FpdCBnZXRBdmFpbGFibGVDb2RlY3MoKTtcbiAgICBjb25zdCBlbmNvZGVycyA9IGF3YWl0IGdldEF2YWlsYWJsZUVuY29kZXJzKCk7XG4gICAgXG4gICAgcmV0dXJuIGBGRm1wZWcgdmVyc2lvbjogYXZhaWxhYmxlIChjb2RlY3M6ICR7T2JqZWN0LmtleXMoY29kZWNzKS5sZW5ndGh9LCBlbmNvZGVyczogJHtPYmplY3Qua2V5cyhlbmNvZGVycykubGVuZ3RofSlgO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGdldHRpbmcgRkZtcGVnIHZlcnNpb246JywgZXJyb3IpO1xuICAgIHJldHVybiAnRkZtcGVnIHZlcnNpb246IHVuYXZhaWxhYmxlJztcbiAgfVxufVxuXG5mZm1wZWcuc2V0RmZtcGVnUGF0aChmZm1wZWdJbnN0YWxsZXIucGF0aCk7XG5mZm1wZWcuc2V0RmZwcm9iZVBhdGgoZmZwcm9iZUluc3RhbGxlci5wYXRoKTtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEF1ZGlvRmlsZVVybChmaWxlbmFtZTogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgY29uc3QgZmlsZVBhdGggPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJ2Rvd25sb2FkJywgJ21wMycsIGZpbGVuYW1lKTtcbiAgY29uc29sZS5sb2coJ0NoZWNraW5nIGZvciBhdWRpbyBmaWxlIGF0OicsIGZpbGVQYXRoKTsgLy8g5re75Yqg5pel5b+XXG4gIGlmIChmcy5leGlzdHNTeW5jKGZpbGVQYXRoKSkge1xuICAgIHJldHVybiBgL2FwaS9maWxlcy9kb3dubG9hZC9tcDMvJHtlbmNvZGVVUklDb21wb25lbnQoZmlsZW5hbWUpfWA7XG4gIH0gZWxzZSB7XG4gICAgY29uc29sZS5lcnJvcignQXVkaW8gZmlsZSBub3QgZm91bmQ6JywgZmlsZVBhdGgpOyAvLyDmt7vliqDplJnor6/ml6Xlv5dcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0F1ZGlvIGZpbGUgbm90IGZvdW5kJyk7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJleGVjIiwiZnMiLCJwYXRoIiwiQ29uZmlndXJhdGlvbiIsIk9wZW5BSUFwaSIsIk1vbmdvQ2xpZW50IiwiZmZtcGVnIiwiZmZtcGVnSW5zdGFsbGVyIiwiZmZwcm9iZUluc3RhbGxlciIsInByb21pc2lmeSIsInByb21pc2VzIiwiZnNQcm9taXNlcyIsImNvbmZpZ3VyYXRpb24iLCJhcGlLZXkiLCJwcm9jZXNzIiwiZW52IiwiT1BFTkFJX0FQSV9LRVkiLCJiYXNlUGF0aCIsIm9wZW5haSIsIm1vbmdvVXJpIiwiTU9OR09EQl9VUkkiLCJjb25zb2xlIiwiZXJyb3IiLCJleGl0IiwibG9nIiwibW9uZ29DbGllbnQiLCJnZXRNb25nb0NsaWVudCIsIkVycm9yIiwiY29ubmVjdCIsInJ1bkNvbW1hbmQiLCJjb21tYW5kIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJlbmNvZGluZyIsInN0ZG91dCIsInN0ZGVyciIsInByb2Nlc3NWaWRlbyIsImZpbGVQYXRoIiwiYXVkaW9GaWxlIiwiZXh0cmFjdEF1ZGlvIiwidGV4dENvbnRlbnQiLCJjb252ZXJ0U3BlZWNoVG9UZXh0IiwiY2xlYW5lZFRleHQiLCJjbGVhblRleHQiLCJzdG9yZVRleHQiLCJhbmFseXNpc1Jlc3VsdCIsInBlcmZvcm1BZHZhbmNlZEFuYWx5c2lzIiwidmlkZW9QYXRoIiwib3V0cHV0RGlyIiwiam9pbiIsImN3ZCIsImV4aXN0c1N5bmMiLCJta2RpclN5bmMiLCJyZWN1cnNpdmUiLCJvdXRwdXRQYXRoIiwiYmFzZW5hbWUiLCJ1bmxpbmtTeW5jIiwib3V0cHV0T3B0aW9ucyIsImF1ZGlvQ29kZWMiLCJhdWRpb0NoYW5uZWxzIiwiYXVkaW9CaXRyYXRlIiwib3V0cHV0Iiwib24iLCJlcnIiLCJydW4iLCJyZXNwb25zZSIsImNyZWF0ZVRyYW5zY3JpcHRpb24iLCJjcmVhdGVSZWFkU3RyZWFtIiwidHJhbnNjcmlwdGlvbiIsImRhdGEiLCJ0ZXh0IiwidHh0RmlsZVBhdGgiLCJyZXBsYWNlIiwid3JpdGVGaWxlIiwidHJpbSIsInRleHRzIiwiY2xpZW50IiwiZGIiLCJjb2xsZWN0aW9uIiwiaW5zZXJ0TWFueSIsIm1hcCIsImNvbnRlbnQiLCJhbmFseXNpcyIsImdldEF1ZGlvRHVyYXRpb24iLCJhdWRpb1BhdGgiLCJmZnByb2JlIiwibWV0YWRhdGEiLCJkdXJhdGlvbiIsImZvcm1hdCIsImNoZWNrRkZtcGVnIiwiZ2V0QXZhaWxhYmxlRm9ybWF0cyIsImdldEZGbXBlZ1ZlcnNpb24iLCJnZXRBdmFpbGFibGVDb2RlY3MiLCJnZXRBdmFpbGFibGVFbmNvZGVycyIsImNvZGVjcyIsImVuY29kZXJzIiwiT2JqZWN0Iiwia2V5cyIsImxlbmd0aCIsInNldEZmbXBlZ1BhdGgiLCJzZXRGZnByb2JlUGF0aCIsImdldEF1ZGlvRmlsZVVybCIsImZpbGVuYW1lIiwiZW5jb2RlVVJJQ29tcG9uZW50Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./utils/videoProcessor.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = (__webpack_exec__("(api)/./pages/api/files/[action].ts"));
module.exports = __webpack_exports__;

})();