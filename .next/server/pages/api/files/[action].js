"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/files/[action]";
exports.ids = ["pages/api/files/[action]"];
exports.modules = {

/***/ "@ffmpeg-installer/ffmpeg":
/*!*******************************************!*\
  !*** external "@ffmpeg-installer/ffmpeg" ***!
  \*******************************************/
/***/ ((module) => {

module.exports = require("@ffmpeg-installer/ffmpeg");

/***/ }),

/***/ "@ffprobe-installer/ffprobe":
/*!*********************************************!*\
  !*** external "@ffprobe-installer/ffprobe" ***!
  \*********************************************/
/***/ ((module) => {

module.exports = require("@ffprobe-installer/ffprobe");

/***/ }),

/***/ "fluent-ffmpeg":
/*!********************************!*\
  !*** external "fluent-ffmpeg" ***!
  \********************************/
/***/ ((module) => {

module.exports = require("fluent-ffmpeg");

/***/ }),

/***/ "mongodb":
/*!**************************!*\
  !*** external "mongodb" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("mongodb");

/***/ }),

/***/ "formidable":
/*!*****************************!*\
  !*** external "formidable" ***!
  \*****************************/
/***/ ((module) => {

module.exports = import("formidable");;

/***/ }),

/***/ "openai":
/*!*************************!*\
  !*** external "openai" ***!
  \*************************/
/***/ ((module) => {

module.exports = import("openai");;

/***/ }),

/***/ "child_process":
/*!********************************!*\
  !*** external "child_process" ***!
  \********************************/
/***/ ((module) => {

module.exports = require("child_process");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "(api)/./pages/api/files/[action].ts":
/*!*************************************!*\
  !*** ./pages/api/files/[action].ts ***!
  \*************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var formidable__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! formidable */ \"formidable\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _utils_videoProcessor__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../utils/videoProcessor */ \"(api)/./utils/videoProcessor.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([formidable__WEBPACK_IMPORTED_MODULE_0__, _utils_videoProcessor__WEBPACK_IMPORTED_MODULE_3__]);\n([formidable__WEBPACK_IMPORTED_MODULE_0__, _utils_videoProcessor__WEBPACK_IMPORTED_MODULE_3__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\nconst config = {\n    api: {\n        bodyParser: false\n    }\n};\nconst uploadDir = path__WEBPACK_IMPORTED_MODULE_2___default().join(process.cwd(), \"uploads\");\nconst recordsFile = path__WEBPACK_IMPORTED_MODULE_2___default().join(process.cwd(), \"upload_records.json\");\n// 确保上传目录存在\nif (!fs__WEBPACK_IMPORTED_MODULE_1___default().existsSync(uploadDir)) {\n    fs__WEBPACK_IMPORTED_MODULE_1___default().mkdirSync(uploadDir, {\n        recursive: true\n    });\n}\n// 确保记录文件存在\nif (!fs__WEBPACK_IMPORTED_MODULE_1___default().existsSync(recordsFile)) {\n    fs__WEBPACK_IMPORTED_MODULE_1___default().writeFileSync(recordsFile, JSON.stringify([]));\n}\nasync function handler(req, res) {\n    const { action } = req.query;\n    console.log(`Received ${req.method} request for action: ${action}`);\n    try {\n        // 只在需要使用 FFmpeg 的��作中进行检查\n        if (action === \"extractAudio\") {\n            const ffmpegAvailable = await (0,_utils_videoProcessor__WEBPACK_IMPORTED_MODULE_3__.checkFFmpeg)();\n            if (!ffmpegAvailable) {\n                return res.status(500).json({\n                    error: \"FFmpeg is not available\"\n                });\n            }\n        }\n        switch(action){\n            case \"upload\":\n                if (req.method === \"POST\") {\n                    console.log(\"Processing file upload\");\n                    const form = (0,formidable__WEBPACK_IMPORTED_MODULE_0__[\"default\"])({\n                        uploadDir: uploadDir,\n                        keepExtensions: true,\n                        maxFileSize: 200 * 1024 * 1024\n                    });\n                    form.parse(req, (err, fields, files)=>{\n                        if (err) {\n                            console.error(\"Error parsing form:\", err);\n                            return res.status(500).json({\n                                error: \"Error parsing form data\",\n                                details: err.message\n                            });\n                        }\n                        console.log(\"Form parsed successfully\");\n                        const file = files.file?.[0];\n                        if (!file) {\n                            console.error(\"No file uploaded\");\n                            return res.status(400).json({\n                                error: \"No file uploaded\"\n                            });\n                        }\n                        console.log(\"File received:\", file.originalFilename);\n                        if (file.size > 200 * 1024 * 1024) {\n                            console.error(\"File size exceeds limit:\", file.size);\n                            return res.status(400).json({\n                                error: \"File size exceeds 200MB limit\"\n                            });\n                        }\n                        if (file.mimetype !== \"video/mp4\") {\n                            console.error(\"Invalid file type:\", file.mimetype);\n                            return res.status(400).json({\n                                error: \"Only MP4 files are allowed\"\n                            });\n                        }\n                        // 生成新的文件名\n                        const originalName = path__WEBPACK_IMPORTED_MODULE_2___default().parse(file.originalFilename || \"\").name;\n                        const extension = path__WEBPACK_IMPORTED_MODULE_2___default().parse(file.originalFilename || \"\").ext;\n                        let newFilename = `${originalName}${extension}`;\n                        let counter = 1;\n                        // 检查文件是否已存在，如果存在则重命名\n                        while(fs__WEBPACK_IMPORTED_MODULE_1___default().existsSync(path__WEBPACK_IMPORTED_MODULE_2___default().join(uploadDir, newFilename))){\n                            newFilename = `${originalName}(${counter})${extension}`;\n                            counter++;\n                        }\n                        const newPath = path__WEBPACK_IMPORTED_MODULE_2___default().join(uploadDir, newFilename);\n                        fs__WEBPACK_IMPORTED_MODULE_1___default().renameSync(file.filepath, newPath);\n                        const fileInfo = {\n                            originalName: file.originalFilename,\n                            name: newFilename,\n                            size: file.size,\n                            type: file.mimetype,\n                            uploadedAt: new Date().toISOString()\n                        };\n                        // 添加文件记录\n                        const records = JSON.parse(fs__WEBPACK_IMPORTED_MODULE_1___default().readFileSync(recordsFile, \"utf-8\"));\n                        records.push(fileInfo);\n                        fs__WEBPACK_IMPORTED_MODULE_1___default().writeFileSync(recordsFile, JSON.stringify(records, null, 2));\n                        console.log(\"File uploaded successfully:\", fileInfo);\n                        return res.status(200).json({\n                            message: \"File uploaded successfully\",\n                            fileInfo\n                        });\n                    });\n                } else {\n                    res.setHeader(\"Allow\", [\n                        \"POST\"\n                    ]);\n                    res.status(405).end(`Method ${req.method} Not Allowed`);\n                }\n                break;\n            case \"list\":\n                if (req.method === \"GET\") {\n                    try {\n                        const records = JSON.parse(fs__WEBPACK_IMPORTED_MODULE_1___default().readFileSync(recordsFile, \"utf-8\"));\n                        console.log(\"Records retrieved:\", records);\n                        res.status(200).json(records);\n                    } catch (error) {\n                        console.error(\"Error reading records file:\", error);\n                        res.status(500).json({\n                            error: \"Error retrieving file records\"\n                        });\n                    }\n                } else {\n                    res.setHeader(\"Allow\", [\n                        \"GET\"\n                    ]);\n                    res.status(405).end(`Method ${req.method} Not Allowed`);\n                }\n                break;\n            case \"delete\":\n                if (req.method === \"DELETE\") {\n                    // 使用 URL 参数而不是请求体\n                    const { filename } = req.query;\n                    if (!filename || typeof filename !== \"string\") {\n                        return res.status(400).json({\n                            error: \"Filename is required\"\n                        });\n                    }\n                    const filePath = path__WEBPACK_IMPORTED_MODULE_2___default().join(uploadDir, filename);\n                    const audioFilePath = path__WEBPACK_IMPORTED_MODULE_2___default().join(process.cwd(), \"download\", \"mp3\", `${path__WEBPACK_IMPORTED_MODULE_2___default().parse(filename).name}.mp3`);\n                    console.log(\"Attempting to delete file:\", filePath);\n                    if (fs__WEBPACK_IMPORTED_MODULE_1___default().existsSync(filePath)) {\n                        fs__WEBPACK_IMPORTED_MODULE_1___default().unlinkSync(filePath);\n                        console.log(\"Video file deleted successfully\");\n                        // 删除对应的音频文件（如果存）\n                        if (fs__WEBPACK_IMPORTED_MODULE_1___default().existsSync(audioFilePath)) {\n                            fs__WEBPACK_IMPORTED_MODULE_1___default().unlinkSync(audioFilePath);\n                            console.log(\"Audio file deleted successfully\");\n                        }\n                        // 更新记录文件\n                        const records = JSON.parse(fs__WEBPACK_IMPORTED_MODULE_1___default().readFileSync(recordsFile, \"utf-8\"));\n                        const updatedRecords = records.filter((record)=>record.name !== filename);\n                        fs__WEBPACK_IMPORTED_MODULE_1___default().writeFileSync(recordsFile, JSON.stringify(updatedRecords, null, 2));\n                        res.status(200).json({\n                            message: \"File deleted successfully\"\n                        });\n                    } else {\n                        console.log(\"File not found:\", filePath);\n                        res.status(404).json({\n                            error: \"File not found\"\n                        });\n                    }\n                } else {\n                    res.setHeader(\"Allow\", [\n                        \"DELETE\"\n                    ]);\n                    res.status(405).end(`Method ${req.method} Not Allowed`);\n                }\n                break;\n            case \"rename\":\n                if (req.method === \"PUT\") {\n                    const { oldName, newName } = req.body;\n                    const oldPath = path__WEBPACK_IMPORTED_MODULE_2___default().join(uploadDir, oldName);\n                    const newPath = path__WEBPACK_IMPORTED_MODULE_2___default().join(uploadDir, newName);\n                    if (fs__WEBPACK_IMPORTED_MODULE_1___default().existsSync(oldPath)) {\n                        fs__WEBPACK_IMPORTED_MODULE_1___default().renameSync(oldPath, newPath);\n                        res.status(200).json({\n                            message: \"File renamed successfully\"\n                        });\n                    } else {\n                        res.status(404).json({\n                            error: \"File not found\"\n                        });\n                    }\n                } else {\n                    res.setHeader(\"Allow\", [\n                        \"PUT\"\n                    ]);\n                    res.status(405).end(`Method ${req.method} Not Allowed`);\n                }\n                break;\n            case \"extractAudio\":\n                if (req.method === \"POST\") {\n                    const form = (0,formidable__WEBPACK_IMPORTED_MODULE_0__[\"default\"])();\n                    form.parse(req, async (err, fields, files)=>{\n                        if (err) {\n                            console.error(\"Error parsing form:\", err);\n                            return res.status(500).json({\n                                error: \"Error parsing form data\"\n                            });\n                        }\n                        const filename = Array.isArray(fields.filename) ? fields.filename[0] : fields.filename;\n                        if (!filename) {\n                            return res.status(400).json({\n                                error: \"Filename is required\"\n                            });\n                        }\n                        console.log(\"Extracting audio for file:\", filename);\n                        // 检查多个可能的路径\n                        const possiblePaths = [\n                            path__WEBPACK_IMPORTED_MODULE_2___default().join(process.cwd(), \"uploads\", filename),\n                            path__WEBPACK_IMPORTED_MODULE_2___default().join(process.cwd(), \"public\", \"uploads\", filename),\n                            path__WEBPACK_IMPORTED_MODULE_2___default().join(process.cwd(), \"download\", \"mp4\", filename)\n                        ];\n                        let videoPath = \"\";\n                        for (const p of possiblePaths){\n                            console.log(\"Checking path:\", p);\n                            if (fs__WEBPACK_IMPORTED_MODULE_1___default().existsSync(p)) {\n                                videoPath = p;\n                                break;\n                            }\n                        }\n                        if (!videoPath) {\n                            console.error(\"Video file not found in any of the checked paths\");\n                            return res.status(404).json({\n                                error: \"Video file not found\"\n                            });\n                        }\n                        console.log(\"Found video file at:\", videoPath);\n                        try {\n                            // 在提取音频之前检查 FFmpeg\n                            const ffmpegAvailable = await (0,_utils_videoProcessor__WEBPACK_IMPORTED_MODULE_3__.checkFFmpeg)();\n                            if (!ffmpegAvailable) {\n                                return res.status(500).json({\n                                    error: \"FFmpeg is not available\"\n                                });\n                            }\n                            // 获取 FFmpeg 版本\n                            const ffmpegVersion = await (0,_utils_videoProcessor__WEBPACK_IMPORTED_MODULE_3__.getFFmpegVersion)();\n                            console.log(\"FFmpeg version:\", ffmpegVersion);\n                            // 使用 SSE (Server-Sent Events) 来报告进度\n                            res.writeHead(200, {\n                                \"Content-Type\": \"text/event-stream\",\n                                \"Cache-Control\": \"no-cache\",\n                                \"Connection\": \"keep-alive\"\n                            });\n                            const audioPath = await (0,_utils_videoProcessor__WEBPACK_IMPORTED_MODULE_3__.extractAudio)(videoPath);\n                            const audioFilename = path__WEBPACK_IMPORTED_MODULE_2___default().basename(audioPath);\n                            console.log(\"Audio extracted successfully:\", audioFilename);\n                            // 获取音频时长\n                            const duration = await (0,_utils_videoProcessor__WEBPACK_IMPORTED_MODULE_3__.getAudioDuration)(audioPath);\n                            // 获取音频文件大小\n                            const { size } = fs__WEBPACK_IMPORTED_MODULE_1___default().statSync(audioPath);\n                            // 更新文件记录\n                            const records = JSON.parse(fs__WEBPACK_IMPORTED_MODULE_1___default().readFileSync(recordsFile, \"utf-8\"));\n                            const updatedRecords = records.map((record)=>{\n                                if (record.name === filename) {\n                                    return {\n                                        ...record,\n                                        audioFile: audioFilename\n                                    };\n                                }\n                                return record;\n                            });\n                            fs__WEBPACK_IMPORTED_MODULE_1___default().writeFileSync(recordsFile, JSON.stringify(updatedRecords, null, 2));\n                            res.write(`data: ${JSON.stringify({\n                                complete: true,\n                                audioFile: audioFilename,\n                                duration,\n                                size\n                            })}\\n\\n`);\n                            res.end();\n                        } catch (error) {\n                            console.error(\"Error extracting audio:\", error);\n                            res.write(`data: ${JSON.stringify({\n                                error: \"Error extracting audio\",\n                                details: error.message\n                            })}\\n\\n`);\n                            res.end();\n                        }\n                    });\n                } else {\n                    res.setHeader(\"Allow\", [\n                        \"POST\"\n                    ]);\n                    res.status(405).end(`Method ${req.method} Not Allowed`);\n                }\n                break;\n            case \"getAudio\":\n                if (req.method === \"GET\") {\n                    const { filename } = req.query;\n                    if (typeof filename !== \"string\") {\n                        return res.status(400).json({\n                            error: \"Invalid filename\"\n                        });\n                    }\n                    try {\n                        const audioUrl = await (0,_utils_videoProcessor__WEBPACK_IMPORTED_MODULE_3__.getAudioFileUrl)(filename);\n                        res.status(200).json({\n                            url: audioUrl\n                        });\n                    } catch (error) {\n                        console.error(\"Error getting audio URL:\", error);\n                        res.status(404).json({\n                            error: \"Audio file not found\"\n                        });\n                    }\n                } else {\n                    res.setHeader(\"Allow\", [\n                        \"GET\"\n                    ]);\n                    res.status(405).end(`Method ${req.method} Not Allowed`);\n                }\n                break;\n            case \"getAudioUrl\":\n                if (req.method === \"GET\") {\n                    const { filename } = req.query;\n                    if (typeof filename !== \"string\") {\n                        return res.status(400).json({\n                            error: \"Invalid filename\"\n                        });\n                    }\n                    try {\n                        const url = await (0,_utils_videoProcessor__WEBPACK_IMPORTED_MODULE_3__.getAudioFileUrl)(filename);\n                        console.log(\"Audio URL generated:\", url); // 添加日志\n                        return res.status(200).json({\n                            url\n                        });\n                    } catch (error) {\n                        console.error(\"Error getting audio URL:\", error); // 添加错误日志\n                        return res.status(404).json({\n                            error: \"Audio file not found\"\n                        });\n                    }\n                } else {\n                    res.setHeader(\"Allow\", [\n                        \"GET\"\n                    ]);\n                    res.status(405).end(`Method ${req.method} Not Allowed`);\n                }\n                break;\n            default:\n                console.error(\"Invalid action:\", action);\n                res.status(404).json({\n                    error: \"Action not found\"\n                });\n        }\n    } catch (error) {\n        console.error(\"Unexpected error:\", error);\n        res.status(500).json({\n            error: \"An unexpected error occurred\",\n            details: error.message\n        });\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QnhDLElBQUlPLE1BQU0sQ0FBQyxLQUFLa0MsR0FBRyxDQUFDLENBQUMsT0FBTyxFQUFFMUMsSUFBSU0sTUFBTSxDQUFDLFlBQVksQ0FBQztnQkFDeEQ7Z0JBQ0E7WUFFRjtnQkFDRUYsUUFBUU0sS0FBSyxDQUFDLG1CQUFtQlI7Z0JBQ2pDRCxJQUFJTyxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO29CQUFFQyxPQUFPO2dCQUFtQjtRQUNyRDtJQUNGLEVBQUUsT0FBT0EsT0FBTztRQUNkTixRQUFRTSxLQUFLLENBQUMscUJBQXFCQTtRQUNuQ1QsSUFBSU8sTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUFFQyxPQUFPO1lBQWdDUSxTQUFTLE1BQWlCQyxPQUFPO1FBQUM7SUFDbEc7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL3ZpZGVvLWFuYWx5c2lzLXN5c3RlbS8uL3BhZ2VzL2FwaS9maWxlcy9bYWN0aW9uXS50cz9kMGJlIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRBcGlSZXF1ZXN0LCBOZXh0QXBpUmVzcG9uc2UgfSBmcm9tICduZXh0JztcbmltcG9ydCBmb3JtaWRhYmxlIGZyb20gJ2Zvcm1pZGFibGUnO1xuaW1wb3J0IGZzIGZyb20gJ2ZzJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHsgZXh0cmFjdEF1ZGlvLCBnZXRBdWRpb0R1cmF0aW9uLCBjaGVja0ZGbXBlZywgZ2V0RkZtcGVnVmVyc2lvbiwgZ2V0QXVkaW9GaWxlVXJsIH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvdmlkZW9Qcm9jZXNzb3InO1xuXG4vLyDlnKjmlofku7bpobbpg6jmt7vliqDov5nkuKrmjqXlj6PlrprkuYlcbmludGVyZmFjZSBGaWxlSW5mbyB7XG4gIG5hbWU6IHN0cmluZztcbiAgc2l6ZTogbnVtYmVyO1xuICB0eXBlOiBzdHJpbmc7XG4gIHVwbG9hZGVkQXQ6IHN0cmluZztcbiAgYXVkaW9GaWxlPzogc3RyaW5nO1xufVxuXG4vLyDlnKjmlofku7bpobbpg6jmt7vliqDov5nkuKrlr7zlhaVcbmltcG9ydCB7IEZpbGUgfSBmcm9tICdmb3JtaWRhYmxlJztcblxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IHtcbiAgYXBpOiB7XG4gICAgYm9keVBhcnNlcjogZmFsc2UsXG4gIH0sXG59O1xuXG5jb25zdCB1cGxvYWREaXIgPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJ3VwbG9hZHMnKTtcbmNvbnN0IHJlY29yZHNGaWxlID0gcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksICd1cGxvYWRfcmVjb3Jkcy5qc29uJyk7XG5cbi8vIOehruS/neS4iuS8oOebruW9leWtmOWcqFxuaWYgKCFmcy5leGlzdHNTeW5jKHVwbG9hZERpcikpIHtcbiAgZnMubWtkaXJTeW5jKHVwbG9hZERpciwgeyByZWN1cnNpdmU6IHRydWUgfSk7XG59XG5cbi8vIOehruS/neiusOW9leaWh+S7tuWtmOWcqFxuaWYgKCFmcy5leGlzdHNTeW5jKHJlY29yZHNGaWxlKSkge1xuICBmcy53cml0ZUZpbGVTeW5jKHJlY29yZHNGaWxlLCBKU09OLnN0cmluZ2lmeShbXSkpO1xufVxuXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKHJlcTogTmV4dEFwaVJlcXVlc3QsIHJlczogTmV4dEFwaVJlc3BvbnNlKSB7XG4gIGNvbnN0IHsgYWN0aW9uIH0gPSByZXEucXVlcnk7XG5cbiAgY29uc29sZS5sb2coYFJlY2VpdmVkICR7cmVxLm1ldGhvZH0gcmVxdWVzdCBmb3IgYWN0aW9uOiAke2FjdGlvbn1gKTtcblxuICB0cnkge1xuICAgIC8vIOWPquWcqOmcgOimgeS9v+eUqCBGRm1wZWcg55qE77+977+95L2c5Lit6L+b6KGM5qOA5p+lXG4gICAgaWYgKGFjdGlvbiA9PT0gJ2V4dHJhY3RBdWRpbycpIHtcbiAgICAgIGNvbnN0IGZmbXBlZ0F2YWlsYWJsZSA9IGF3YWl0IGNoZWNrRkZtcGVnKCk7XG4gICAgICBpZiAoIWZmbXBlZ0F2YWlsYWJsZSkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oeyBlcnJvcjogJ0ZGbXBlZyBpcyBub3QgYXZhaWxhYmxlJyB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBzd2l0Y2ggKGFjdGlvbikge1xuICAgICAgY2FzZSAndXBsb2FkJzpcbiAgICAgICAgaWYgKHJlcS5tZXRob2QgPT09ICdQT1NUJykge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdQcm9jZXNzaW5nIGZpbGUgdXBsb2FkJyk7XG4gICAgICAgICAgY29uc3QgZm9ybSA9IGZvcm1pZGFibGUoe1xuICAgICAgICAgICAgdXBsb2FkRGlyOiB1cGxvYWREaXIsXG4gICAgICAgICAgICBrZWVwRXh0ZW5zaW9uczogdHJ1ZSxcbiAgICAgICAgICAgIG1heEZpbGVTaXplOiAyMDAgKiAxMDI0ICogMTAyNCwgLy8gMjAwTUJcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIGZvcm0ucGFyc2UocmVxLCAoZXJyLCBmaWVsZHMsIGZpbGVzKSA9PiB7XG4gICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHBhcnNpbmcgZm9ybTonLCBlcnIpO1xuICAgICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oeyBlcnJvcjogJ0Vycm9yIHBhcnNpbmcgZm9ybSBkYXRhJywgZGV0YWlsczogZXJyLm1lc3NhZ2UgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdGb3JtIHBhcnNlZCBzdWNjZXNzZnVsbHknKTtcblxuICAgICAgICAgICAgY29uc3QgZmlsZSA9IChmaWxlcy5maWxlIGFzIEZpbGVbXSk/LlswXTtcbiAgICAgICAgICAgIGlmICghZmlsZSkge1xuICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdObyBmaWxlIHVwbG9hZGVkJyk7XG4gICAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiAnTm8gZmlsZSB1cGxvYWRlZCcgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdGaWxlIHJlY2VpdmVkOicsIGZpbGUub3JpZ2luYWxGaWxlbmFtZSk7XG5cbiAgICAgICAgICAgIGlmIChmaWxlLnNpemUgPiAyMDAgKiAxMDI0ICogMTAyNCkge1xuICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdGaWxlIHNpemUgZXhjZWVkcyBsaW1pdDonLCBmaWxlLnNpemUpO1xuICAgICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogJ0ZpbGUgc2l6ZSBleGNlZWRzIDIwME1CIGxpbWl0JyB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGZpbGUubWltZXR5cGUgIT09ICd2aWRlby9tcDQnKSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ludmFsaWQgZmlsZSB0eXBlOicsIGZpbGUubWltZXR5cGUpO1xuICAgICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogJ09ubHkgTVA0IGZpbGVzIGFyZSBhbGxvd2VkJyB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8g55Sf5oiQ5paw55qE5paH5Lu25ZCNXG4gICAgICAgICAgICBjb25zdCBvcmlnaW5hbE5hbWUgPSBwYXRoLnBhcnNlKGZpbGUub3JpZ2luYWxGaWxlbmFtZSB8fCAnJykubmFtZTtcbiAgICAgICAgICAgIGNvbnN0IGV4dGVuc2lvbiA9IHBhdGgucGFyc2UoZmlsZS5vcmlnaW5hbEZpbGVuYW1lIHx8ICcnKS5leHQ7XG4gICAgICAgICAgICBsZXQgbmV3RmlsZW5hbWUgPSBgJHtvcmlnaW5hbE5hbWV9JHtleHRlbnNpb259YDtcbiAgICAgICAgICAgIGxldCBjb3VudGVyID0gMTtcblxuICAgICAgICAgICAgLy8g5qOA5p+l5paH5Lu25piv5ZCm5bey5a2Y5Zyo77yM5aaC5p6c5a2Y5Zyo5YiZ6YeN5ZG95ZCNXG4gICAgICAgICAgICB3aGlsZSAoZnMuZXhpc3RzU3luYyhwYXRoLmpvaW4odXBsb2FkRGlyLCBuZXdGaWxlbmFtZSkpKSB7XG4gICAgICAgICAgICAgIG5ld0ZpbGVuYW1lID0gYCR7b3JpZ2luYWxOYW1lfSgke2NvdW50ZXJ9KSR7ZXh0ZW5zaW9ufWA7XG4gICAgICAgICAgICAgIGNvdW50ZXIrKztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgbmV3UGF0aCA9IHBhdGguam9pbih1cGxvYWREaXIsIG5ld0ZpbGVuYW1lKTtcbiAgICAgICAgICAgIGZzLnJlbmFtZVN5bmMoZmlsZS5maWxlcGF0aCwgbmV3UGF0aCk7XG5cbiAgICAgICAgICAgIGNvbnN0IGZpbGVJbmZvID0ge1xuICAgICAgICAgICAgICBvcmlnaW5hbE5hbWU6IGZpbGUub3JpZ2luYWxGaWxlbmFtZSxcbiAgICAgICAgICAgICAgbmFtZTogbmV3RmlsZW5hbWUsXG4gICAgICAgICAgICAgIHNpemU6IGZpbGUuc2l6ZSxcbiAgICAgICAgICAgICAgdHlwZTogZmlsZS5taW1ldHlwZSxcbiAgICAgICAgICAgICAgdXBsb2FkZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLy8g5re75Yqg5paH5Lu26K6w5b2VXG4gICAgICAgICAgICBjb25zdCByZWNvcmRzID0gSlNPTi5wYXJzZShmcy5yZWFkRmlsZVN5bmMocmVjb3Jkc0ZpbGUsICd1dGYtOCcpKTtcbiAgICAgICAgICAgIHJlY29yZHMucHVzaChmaWxlSW5mbyk7XG4gICAgICAgICAgICBmcy53cml0ZUZpbGVTeW5jKHJlY29yZHNGaWxlLCBKU09OLnN0cmluZ2lmeShyZWNvcmRzLCBudWxsLCAyKSk7XG5cbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdGaWxlIHVwbG9hZGVkIHN1Y2Nlc3NmdWxseTonLCBmaWxlSW5mbyk7XG5cbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7IG1lc3NhZ2U6ICdGaWxlIHVwbG9hZGVkIHN1Y2Nlc3NmdWxseScsIGZpbGVJbmZvIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlcy5zZXRIZWFkZXIoJ0FsbG93JywgWydQT1NUJ10pO1xuICAgICAgICAgIHJlcy5zdGF0dXMoNDA1KS5lbmQoYE1ldGhvZCAke3JlcS5tZXRob2R9IE5vdCBBbGxvd2VkYCk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgJ2xpc3QnOlxuICAgICAgICBpZiAocmVxLm1ldGhvZCA9PT0gJ0dFVCcpIHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcmVjb3JkcyA9IEpTT04ucGFyc2UoZnMucmVhZEZpbGVTeW5jKHJlY29yZHNGaWxlLCAndXRmLTgnKSk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnUmVjb3JkcyByZXRyaWV2ZWQ6JywgcmVjb3Jkcyk7XG4gICAgICAgICAgICByZXMuc3RhdHVzKDIwMCkuanNvbihyZWNvcmRzKTtcbiAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgcmVhZGluZyByZWNvcmRzIGZpbGU6JywgZXJyb3IpO1xuICAgICAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBlcnJvcjogJ0Vycm9yIHJldHJpZXZpbmcgZmlsZSByZWNvcmRzJyB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzLnNldEhlYWRlcignQWxsb3cnLCBbJ0dFVCddKTtcbiAgICAgICAgICByZXMuc3RhdHVzKDQwNSkuZW5kKGBNZXRob2QgJHtyZXEubWV0aG9kfSBOb3QgQWxsb3dlZGApO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlICdkZWxldGUnOlxuICAgICAgICBpZiAocmVxLm1ldGhvZCA9PT0gJ0RFTEVURScpIHtcbiAgICAgICAgICAvLyDkvb/nlKggVVJMIOWPguaVsOiAjOS4jeaYr+ivt+axguS9k1xuICAgICAgICAgIGNvbnN0IHsgZmlsZW5hbWUgfSA9IHJlcS5xdWVyeTtcbiAgICAgICAgICBpZiAoIWZpbGVuYW1lIHx8IHR5cGVvZiBmaWxlbmFtZSAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiAnRmlsZW5hbWUgaXMgcmVxdWlyZWQnIH0pO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnN0IGZpbGVQYXRoID0gcGF0aC5qb2luKHVwbG9hZERpciwgZmlsZW5hbWUpO1xuICAgICAgICAgIGNvbnN0IGF1ZGlvRmlsZVBhdGggPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJ2Rvd25sb2FkJywgJ21wMycsIGAke3BhdGgucGFyc2UoZmlsZW5hbWUpLm5hbWV9Lm1wM2ApO1xuICAgICAgICAgIFxuICAgICAgICAgIGNvbnNvbGUubG9nKCdBdHRlbXB0aW5nIHRvIGRlbGV0ZSBmaWxlOicsIGZpbGVQYXRoKTtcbiAgICAgICAgICBcbiAgICAgICAgICBpZiAoZnMuZXhpc3RzU3luYyhmaWxlUGF0aCkpIHtcbiAgICAgICAgICAgIGZzLnVubGlua1N5bmMoZmlsZVBhdGgpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1ZpZGVvIGZpbGUgZGVsZXRlZCBzdWNjZXNzZnVsbHknKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8g5Yig6Zmk5a+55bqU55qE6Z+z6aKR5paH5Lu277yI5aaC5p6c5a2Y77yJXG4gICAgICAgICAgICBpZiAoZnMuZXhpc3RzU3luYyhhdWRpb0ZpbGVQYXRoKSkge1xuICAgICAgICAgICAgICBmcy51bmxpbmtTeW5jKGF1ZGlvRmlsZVBhdGgpO1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZygnQXVkaW8gZmlsZSBkZWxldGVkIHN1Y2Nlc3NmdWxseScpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyDmm7TmlrDorrDlvZXmlofku7ZcbiAgICAgICAgICAgIGNvbnN0IHJlY29yZHMgPSBKU09OLnBhcnNlKGZzLnJlYWRGaWxlU3luYyhyZWNvcmRzRmlsZSwgJ3V0Zi04JykpO1xuICAgICAgICAgICAgY29uc3QgdXBkYXRlZFJlY29yZHMgPSByZWNvcmRzLmZpbHRlcigocmVjb3JkOiBGaWxlSW5mbykgPT4gcmVjb3JkLm5hbWUgIT09IGZpbGVuYW1lKTtcbiAgICAgICAgICAgIGZzLndyaXRlRmlsZVN5bmMocmVjb3Jkc0ZpbGUsIEpTT04uc3RyaW5naWZ5KHVwZGF0ZWRSZWNvcmRzLCBudWxsLCAyKSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgbWVzc2FnZTogJ0ZpbGUgZGVsZXRlZCBzdWNjZXNzZnVsbHknIH0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnRmlsZSBub3QgZm91bmQ6JywgZmlsZVBhdGgpO1xuICAgICAgICAgICAgcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBlcnJvcjogJ0ZpbGUgbm90IGZvdW5kJyB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzLnNldEhlYWRlcignQWxsb3cnLCBbJ0RFTEVURSddKTtcbiAgICAgICAgICByZXMuc3RhdHVzKDQwNSkuZW5kKGBNZXRob2QgJHtyZXEubWV0aG9kfSBOb3QgQWxsb3dlZGApO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlICdyZW5hbWUnOlxuICAgICAgICBpZiAocmVxLm1ldGhvZCA9PT0gJ1BVVCcpIHtcbiAgICAgICAgICBjb25zdCB7IG9sZE5hbWUsIG5ld05hbWUgfSA9IHJlcS5ib2R5O1xuICAgICAgICAgIGNvbnN0IG9sZFBhdGggPSBwYXRoLmpvaW4odXBsb2FkRGlyLCBvbGROYW1lKTtcbiAgICAgICAgICBjb25zdCBuZXdQYXRoID0gcGF0aC5qb2luKHVwbG9hZERpciwgbmV3TmFtZSk7XG4gICAgICAgICAgaWYgKGZzLmV4aXN0c1N5bmMob2xkUGF0aCkpIHtcbiAgICAgICAgICAgIGZzLnJlbmFtZVN5bmMob2xkUGF0aCwgbmV3UGF0aCk7XG4gICAgICAgICAgICByZXMuc3RhdHVzKDIwMCkuanNvbih7IG1lc3NhZ2U6ICdGaWxlIHJlbmFtZWQgc3VjY2Vzc2Z1bGx5JyB9KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBlcnJvcjogJ0ZpbGUgbm90IGZvdW5kJyB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzLnNldEhlYWRlcignQWxsb3cnLCBbJ1BVVCddKTtcbiAgICAgICAgICByZXMuc3RhdHVzKDQwNSkuZW5kKGBNZXRob2QgJHtyZXEubWV0aG9kfSBOb3QgQWxsb3dlZGApO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlICdleHRyYWN0QXVkaW8nOlxuICAgICAgICBpZiAocmVxLm1ldGhvZCA9PT0gJ1BPU1QnKSB7XG4gICAgICAgICAgY29uc3QgZm9ybSA9IGZvcm1pZGFibGUoKTtcbiAgICAgICAgICBmb3JtLnBhcnNlKHJlcSwgYXN5bmMgKGVyciwgZmllbGRzLCBmaWxlcykgPT4ge1xuICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBwYXJzaW5nIGZvcm06JywgZXJyKTtcbiAgICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6ICdFcnJvciBwYXJzaW5nIGZvcm0gZGF0YScgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IGZpbGVuYW1lID0gQXJyYXkuaXNBcnJheShmaWVsZHMuZmlsZW5hbWUpID8gZmllbGRzLmZpbGVuYW1lWzBdIDogZmllbGRzLmZpbGVuYW1lO1xuICAgICAgICAgICAgaWYgKCFmaWxlbmFtZSkge1xuICAgICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogJ0ZpbGVuYW1lIGlzIHJlcXVpcmVkJyB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc29sZS5sb2coJ0V4dHJhY3RpbmcgYXVkaW8gZm9yIGZpbGU6JywgZmlsZW5hbWUpO1xuXG4gICAgICAgICAgICAvLyDmo4Dmn6XlpJrkuKrlj6/og73nmoTot6/lvoRcbiAgICAgICAgICAgIGNvbnN0IHBvc3NpYmxlUGF0aHMgPSBbXG4gICAgICAgICAgICAgIHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCAndXBsb2FkcycsIGZpbGVuYW1lKSxcbiAgICAgICAgICAgICAgcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksICdwdWJsaWMnLCAndXBsb2FkcycsIGZpbGVuYW1lKSxcbiAgICAgICAgICAgICAgcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksICdkb3dubG9hZCcsICdtcDQnLCBmaWxlbmFtZSlcbiAgICAgICAgICAgIF07XG5cbiAgICAgICAgICAgIGxldCB2aWRlb1BhdGggPSAnJztcbiAgICAgICAgICAgIGZvciAoY29uc3QgcCBvZiBwb3NzaWJsZVBhdGhzKSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdDaGVja2luZyBwYXRoOicsIHApO1xuICAgICAgICAgICAgICBpZiAoZnMuZXhpc3RzU3luYyhwKSkge1xuICAgICAgICAgICAgICAgIHZpZGVvUGF0aCA9IHA7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCF2aWRlb1BhdGgpIHtcbiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignVmlkZW8gZmlsZSBub3QgZm91bmQgaW4gYW55IG9mIHRoZSBjaGVja2VkIHBhdGhzJyk7XG4gICAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IGVycm9yOiAnVmlkZW8gZmlsZSBub3QgZm91bmQnIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnRm91bmQgdmlkZW8gZmlsZSBhdDonLCB2aWRlb1BhdGgpO1xuXG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAvLyDlnKjmj5Dlj5bpn7PpopHkuYvliY3mo4Dmn6UgRkZtcGVnXG4gICAgICAgICAgICAgIGNvbnN0IGZmbXBlZ0F2YWlsYWJsZSA9IGF3YWl0IGNoZWNrRkZtcGVnKCk7XG4gICAgICAgICAgICAgIGlmICghZmZtcGVnQXZhaWxhYmxlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6ICdGRm1wZWcgaXMgbm90IGF2YWlsYWJsZScgfSk7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAvLyDojrflj5YgRkZtcGVnIOeJiOacrFxuICAgICAgICAgICAgICBjb25zdCBmZm1wZWdWZXJzaW9uID0gYXdhaXQgZ2V0RkZtcGVnVmVyc2lvbigpO1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRkZtcGVnIHZlcnNpb246JywgZmZtcGVnVmVyc2lvbik7XG5cbiAgICAgICAgICAgICAgLy8g5L2/55SoIFNTRSAoU2VydmVyLVNlbnQgRXZlbnRzKSDmnaXmiqXlkYrov5vluqZcbiAgICAgICAgICAgICAgcmVzLndyaXRlSGVhZCgyMDAsIHtcbiAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ3RleHQvZXZlbnQtc3RyZWFtJyxcbiAgICAgICAgICAgICAgICAnQ2FjaGUtQ29udHJvbCc6ICduby1jYWNoZScsXG4gICAgICAgICAgICAgICAgJ0Nvbm5lY3Rpb24nOiAna2VlcC1hbGl2ZSdcbiAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgY29uc3QgYXVkaW9QYXRoID0gYXdhaXQgZXh0cmFjdEF1ZGlvKHZpZGVvUGF0aCk7XG4gICAgICAgICAgICAgIGNvbnN0IGF1ZGlvRmlsZW5hbWUgPSBwYXRoLmJhc2VuYW1lKGF1ZGlvUGF0aCk7XG4gICAgICAgICAgICAgIFxuICAgICAgICAgICAgICBjb25zb2xlLmxvZygnQXVkaW8gZXh0cmFjdGVkIHN1Y2Nlc3NmdWxseTonLCBhdWRpb0ZpbGVuYW1lKTtcblxuICAgICAgICAgICAgICAvLyDojrflj5bpn7PpopHml7bplb9cbiAgICAgICAgICAgICAgY29uc3QgZHVyYXRpb24gPSBhd2FpdCBnZXRBdWRpb0R1cmF0aW9uKGF1ZGlvUGF0aCk7XG5cbiAgICAgICAgICAgICAgLy8g6I635Y+W6Z+z6aKR5paH5Lu25aSn5bCPXG4gICAgICAgICAgICAgIGNvbnN0IHsgc2l6ZSB9ID0gZnMuc3RhdFN5bmMoYXVkaW9QYXRoKTtcblxuICAgICAgICAgICAgICAvLyDmm7TmlrDmlofku7borrDlvZVcbiAgICAgICAgICAgICAgY29uc3QgcmVjb3JkcyA9IEpTT04ucGFyc2UoZnMucmVhZEZpbGVTeW5jKHJlY29yZHNGaWxlLCAndXRmLTgnKSk7XG4gICAgICAgICAgICAgIGNvbnN0IHVwZGF0ZWRSZWNvcmRzID0gcmVjb3Jkcy5tYXAoKHJlY29yZDogRmlsZUluZm8pID0+IHtcbiAgICAgICAgICAgICAgICBpZiAocmVjb3JkLm5hbWUgPT09IGZpbGVuYW1lKSB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4geyAuLi5yZWNvcmQsIGF1ZGlvRmlsZTogYXVkaW9GaWxlbmFtZSB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gcmVjb3JkO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgZnMud3JpdGVGaWxlU3luYyhyZWNvcmRzRmlsZSwgSlNPTi5zdHJpbmdpZnkodXBkYXRlZFJlY29yZHMsIG51bGwsIDIpKTtcblxuICAgICAgICAgICAgICByZXMud3JpdGUoYGRhdGE6ICR7SlNPTi5zdHJpbmdpZnkoeyBjb21wbGV0ZTogdHJ1ZSwgYXVkaW9GaWxlOiBhdWRpb0ZpbGVuYW1lLCBkdXJhdGlvbiwgc2l6ZSB9KX1cXG5cXG5gKTtcbiAgICAgICAgICAgICAgcmVzLmVuZCgpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZXh0cmFjdGluZyBhdWRpbzonLCBlcnJvcik7XG4gICAgICAgICAgICAgIHJlcy53cml0ZShgZGF0YTogJHtKU09OLnN0cmluZ2lmeSh7IGVycm9yOiAnRXJyb3IgZXh0cmFjdGluZyBhdWRpbycsIGRldGFpbHM6IChlcnJvciBhcyBFcnJvcikubWVzc2FnZSB9KX1cXG5cXG5gKTtcbiAgICAgICAgICAgICAgcmVzLmVuZCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlcy5zZXRIZWFkZXIoJ0FsbG93JywgWydQT1NUJ10pO1xuICAgICAgICAgIHJlcy5zdGF0dXMoNDA1KS5lbmQoYE1ldGhvZCAke3JlcS5tZXRob2R9IE5vdCBBbGxvd2VkYCk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgJ2dldEF1ZGlvJzpcbiAgICAgICAgaWYgKHJlcS5tZXRob2QgPT09ICdHRVQnKSB7XG4gICAgICAgICAgY29uc3QgeyBmaWxlbmFtZSB9ID0gcmVxLnF1ZXJ5O1xuICAgICAgICAgIGlmICh0eXBlb2YgZmlsZW5hbWUgIT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogJ0ludmFsaWQgZmlsZW5hbWUnIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgYXVkaW9VcmwgPSBhd2FpdCBnZXRBdWRpb0ZpbGVVcmwoZmlsZW5hbWUpO1xuICAgICAgICAgICAgcmVzLnN0YXR1cygyMDApLmpzb24oeyB1cmw6IGF1ZGlvVXJsIH0pO1xuICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBnZXR0aW5nIGF1ZGlvIFVSTDonLCBlcnJvcik7XG4gICAgICAgICAgICByZXMuc3RhdHVzKDQwNCkuanNvbih7IGVycm9yOiAnQXVkaW8gZmlsZSBub3QgZm91bmQnIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXMuc2V0SGVhZGVyKCdBbGxvdycsIFsnR0VUJ10pO1xuICAgICAgICAgIHJlcy5zdGF0dXMoNDA1KS5lbmQoYE1ldGhvZCAke3JlcS5tZXRob2R9IE5vdCBBbGxvd2VkYCk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgJ2dldEF1ZGlvVXJsJzpcbiAgICAgICAgaWYgKHJlcS5tZXRob2QgPT09ICdHRVQnKSB7XG4gICAgICAgICAgY29uc3QgeyBmaWxlbmFtZSB9ID0gcmVxLnF1ZXJ5O1xuICAgICAgICAgIGlmICh0eXBlb2YgZmlsZW5hbWUgIT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogJ0ludmFsaWQgZmlsZW5hbWUnIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgdXJsID0gYXdhaXQgZ2V0QXVkaW9GaWxlVXJsKGZpbGVuYW1lKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdBdWRpbyBVUkwgZ2VuZXJhdGVkOicsIHVybCk7IC8vIOa3u+WKoOaXpeW/l1xuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgdXJsIH0pO1xuICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBnZXR0aW5nIGF1ZGlvIFVSTDonLCBlcnJvcik7IC8vIOa3u+WKoOmUmeivr+aXpeW/l1xuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgZXJyb3I6ICdBdWRpbyBmaWxlIG5vdCBmb3VuZCcgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlcy5zZXRIZWFkZXIoJ0FsbG93JywgWydHRVQnXSk7XG4gICAgICAgICAgcmVzLnN0YXR1cyg0MDUpLmVuZChgTWV0aG9kICR7cmVxLm1ldGhvZH0gTm90IEFsbG93ZWRgKTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcblxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgY29uc29sZS5lcnJvcignSW52YWxpZCBhY3Rpb246JywgYWN0aW9uKTtcbiAgICAgICAgcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBlcnJvcjogJ0FjdGlvbiBub3QgZm91bmQnIH0pO1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdVbmV4cGVjdGVkIGVycm9yOicsIGVycm9yKTtcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yOiAnQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZCcsIGRldGFpbHM6IChlcnJvciBhcyBFcnJvcikubWVzc2FnZSB9KTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbImZvcm1pZGFibGUiLCJmcyIsInBhdGgiLCJleHRyYWN0QXVkaW8iLCJnZXRBdWRpb0R1cmF0aW9uIiwiY2hlY2tGRm1wZWciLCJnZXRGRm1wZWdWZXJzaW9uIiwiZ2V0QXVkaW9GaWxlVXJsIiwiY29uZmlnIiwiYXBpIiwiYm9keVBhcnNlciIsInVwbG9hZERpciIsImpvaW4iLCJwcm9jZXNzIiwiY3dkIiwicmVjb3Jkc0ZpbGUiLCJleGlzdHNTeW5jIiwibWtkaXJTeW5jIiwicmVjdXJzaXZlIiwid3JpdGVGaWxlU3luYyIsIkpTT04iLCJzdHJpbmdpZnkiLCJoYW5kbGVyIiwicmVxIiwicmVzIiwiYWN0aW9uIiwicXVlcnkiLCJjb25zb2xlIiwibG9nIiwibWV0aG9kIiwiZmZtcGVnQXZhaWxhYmxlIiwic3RhdHVzIiwianNvbiIsImVycm9yIiwiZm9ybSIsImtlZXBFeHRlbnNpb25zIiwibWF4RmlsZVNpemUiLCJwYXJzZSIsImVyciIsImZpZWxkcyIsImZpbGVzIiwiZGV0YWlscyIsIm1lc3NhZ2UiLCJmaWxlIiwib3JpZ2luYWxGaWxlbmFtZSIsInNpemUiLCJtaW1ldHlwZSIsIm9yaWdpbmFsTmFtZSIsIm5hbWUiLCJleHRlbnNpb24iLCJleHQiLCJuZXdGaWxlbmFtZSIsImNvdW50ZXIiLCJuZXdQYXRoIiwicmVuYW1lU3luYyIsImZpbGVwYXRoIiwiZmlsZUluZm8iLCJ0eXBlIiwidXBsb2FkZWRBdCIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsInJlY29yZHMiLCJyZWFkRmlsZVN5bmMiLCJwdXNoIiwic2V0SGVhZGVyIiwiZW5kIiwiZmlsZW5hbWUiLCJmaWxlUGF0aCIsImF1ZGlvRmlsZVBhdGgiLCJ1bmxpbmtTeW5jIiwidXBkYXRlZFJlY29yZHMiLCJmaWx0ZXIiLCJyZWNvcmQiLCJvbGROYW1lIiwibmV3TmFtZSIsImJvZHkiLCJvbGRQYXRoIiwiQXJyYXkiLCJpc0FycmF5IiwicG9zc2libGVQYXRocyIsInZpZGVvUGF0aCIsInAiLCJmZm1wZWdWZXJzaW9uIiwid3JpdGVIZWFkIiwiYXVkaW9QYXRoIiwiYXVkaW9GaWxlbmFtZSIsImJhc2VuYW1lIiwiZHVyYXRpb24iLCJzdGF0U3luYyIsIm1hcCIsImF1ZGlvRmlsZSIsIndyaXRlIiwiY29tcGxldGUiLCJhdWRpb1VybCIsInVybCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./pages/api/files/[action].ts\n");

/***/ }),

/***/ "(api)/./utils/database.ts":
/*!***************************!*\
  !*** ./utils/database.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   connectToDatabase: () => (/* binding */ connectToDatabase)\n/* harmony export */ });\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_0__);\n\nconst MONGODB_URI = process.env.MONGODB_URI;\nif (!MONGODB_URI) {\n    throw new Error(\"Please define the MONGODB_URI environment variable inside .env.local\");\n}\nlet cached = global;\nif (!cached.mongo) {\n    cached.mongo = {\n        conn: null,\n        promise: null\n    };\n}\nasync function connectToDatabase() {\n    if (cached.mongo.conn) {\n        return cached.mongo.conn;\n    }\n    if (!cached.mongo.promise) {\n        const opts = {\n            useNewUrlParser: true,\n            useUnifiedTopology: true\n        };\n        cached.mongo.promise = mongodb__WEBPACK_IMPORTED_MODULE_0__.MongoClient.connect(MONGODB_URI, opts).then((client)=>{\n            console.log(\"New database connection established\");\n            return {\n                client,\n                db: client.db()\n            };\n        }).catch((error)=>{\n            console.error(\"Failed to connect to database:\", error);\n            throw error;\n        });\n    }\n    try {\n        cached.mongo.conn = await cached.mongo.promise;\n    } catch (e) {\n        cached.mongo.promise = null;\n        throw e;\n    }\n    return cached.mongo.conn;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi91dGlscy9kYXRhYmFzZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBc0M7QUFFdEMsTUFBTUMsY0FBY0MsUUFBUUMsR0FBRyxDQUFDRixXQUFXO0FBRTNDLElBQUksQ0FBQ0EsYUFBYTtJQUNoQixNQUFNLElBQUlHLE1BQU07QUFDbEI7QUFFQSxJQUFJQyxTQUFTQztBQUViLElBQUksQ0FBQ0QsT0FBT0UsS0FBSyxFQUFFO0lBQ2pCRixPQUFPRSxLQUFLLEdBQUc7UUFBRUMsTUFBTTtRQUFNQyxTQUFTO0lBQUs7QUFDN0M7QUFFTyxlQUFlQztJQUNwQixJQUFJTCxPQUFPRSxLQUFLLENBQUNDLElBQUksRUFBRTtRQUNyQixPQUFPSCxPQUFPRSxLQUFLLENBQUNDLElBQUk7SUFDMUI7SUFFQSxJQUFJLENBQUNILE9BQU9FLEtBQUssQ0FBQ0UsT0FBTyxFQUFFO1FBQ3pCLE1BQU1FLE9BQU87WUFDWEMsaUJBQWlCO1lBQ2pCQyxvQkFBb0I7UUFDdEI7UUFFQVIsT0FBT0UsS0FBSyxDQUFDRSxPQUFPLEdBQUdULGdEQUFXQSxDQUFDYyxPQUFPLENBQUNiLGFBQWNVLE1BQU1JLElBQUksQ0FBQyxDQUFDQztZQUNuRUMsUUFBUUMsR0FBRyxDQUFDO1lBQ1osT0FBTztnQkFDTEY7Z0JBQ0FHLElBQUlILE9BQU9HLEVBQUU7WUFDZjtRQUNGLEdBQUdDLEtBQUssQ0FBQyxDQUFDQztZQUNSSixRQUFRSSxLQUFLLENBQUMsa0NBQWtDQTtZQUNoRCxNQUFNQTtRQUNSO0lBQ0Y7SUFFQSxJQUFJO1FBQ0ZoQixPQUFPRSxLQUFLLENBQUNDLElBQUksR0FBRyxNQUFNSCxPQUFPRSxLQUFLLENBQUNFLE9BQU87SUFDaEQsRUFBRSxPQUFPYSxHQUFHO1FBQ1ZqQixPQUFPRSxLQUFLLENBQUNFLE9BQU8sR0FBRztRQUN2QixNQUFNYTtJQUNSO0lBRUEsT0FBT2pCLE9BQU9FLEtBQUssQ0FBQ0MsSUFBSTtBQUMxQiIsInNvdXJjZXMiOlsid2VicGFjazovL3ZpZGVvLWFuYWx5c2lzLXN5c3RlbS8uL3V0aWxzL2RhdGFiYXNlLnRzPzZhZjkiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTW9uZ29DbGllbnQgfSBmcm9tICdtb25nb2RiJztcblxuY29uc3QgTU9OR09EQl9VUkkgPSBwcm9jZXNzLmVudi5NT05HT0RCX1VSSTtcblxuaWYgKCFNT05HT0RCX1VSSSkge1xuICB0aHJvdyBuZXcgRXJyb3IoJ1BsZWFzZSBkZWZpbmUgdGhlIE1PTkdPREJfVVJJIGVudmlyb25tZW50IHZhcmlhYmxlIGluc2lkZSAuZW52LmxvY2FsJyk7XG59XG5cbmxldCBjYWNoZWQgPSBnbG9iYWwgYXMgYW55O1xuXG5pZiAoIWNhY2hlZC5tb25nbykge1xuICBjYWNoZWQubW9uZ28gPSB7IGNvbm46IG51bGwsIHByb21pc2U6IG51bGwgfTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNvbm5lY3RUb0RhdGFiYXNlKCkge1xuICBpZiAoY2FjaGVkLm1vbmdvLmNvbm4pIHtcbiAgICByZXR1cm4gY2FjaGVkLm1vbmdvLmNvbm47XG4gIH1cblxuICBpZiAoIWNhY2hlZC5tb25nby5wcm9taXNlKSB7XG4gICAgY29uc3Qgb3B0cyA9IHtcbiAgICAgIHVzZU5ld1VybFBhcnNlcjogdHJ1ZSxcbiAgICAgIHVzZVVuaWZpZWRUb3BvbG9neTogdHJ1ZSxcbiAgICB9O1xuXG4gICAgY2FjaGVkLm1vbmdvLnByb21pc2UgPSBNb25nb0NsaWVudC5jb25uZWN0KE1PTkdPREJfVVJJISwgb3B0cykudGhlbigoY2xpZW50KSA9PiB7XG4gICAgICBjb25zb2xlLmxvZygnTmV3IGRhdGFiYXNlIGNvbm5lY3Rpb24gZXN0YWJsaXNoZWQnKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNsaWVudCxcbiAgICAgICAgZGI6IGNsaWVudC5kYigpLFxuICAgICAgfTtcbiAgICB9KS5jYXRjaCgoZXJyb3IpID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBjb25uZWN0IHRvIGRhdGFiYXNlOicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH0pO1xuICB9XG5cbiAgdHJ5IHtcbiAgICBjYWNoZWQubW9uZ28uY29ubiA9IGF3YWl0IGNhY2hlZC5tb25nby5wcm9taXNlO1xuICB9IGNhdGNoIChlKSB7XG4gICAgY2FjaGVkLm1vbmdvLnByb21pc2UgPSBudWxsO1xuICAgIHRocm93IGU7XG4gIH1cblxuICByZXR1cm4gY2FjaGVkLm1vbmdvLmNvbm47XG59XG4iXSwibmFtZXMiOlsiTW9uZ29DbGllbnQiLCJNT05HT0RCX1VSSSIsInByb2Nlc3MiLCJlbnYiLCJFcnJvciIsImNhY2hlZCIsImdsb2JhbCIsIm1vbmdvIiwiY29ubiIsInByb21pc2UiLCJjb25uZWN0VG9EYXRhYmFzZSIsIm9wdHMiLCJ1c2VOZXdVcmxQYXJzZXIiLCJ1c2VVbmlmaWVkVG9wb2xvZ3kiLCJjb25uZWN0IiwidGhlbiIsImNsaWVudCIsImNvbnNvbGUiLCJsb2ciLCJkYiIsImNhdGNoIiwiZXJyb3IiLCJlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./utils/database.ts\n");

/***/ }),

/***/ "(api)/./utils/videoProcessor.ts":
/*!*********************************!*\
  !*** ./utils/videoProcessor.ts ***!
  \*********************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   checkFFmpeg: () => (/* binding */ checkFFmpeg),\n/* harmony export */   cleanText: () => (/* binding */ cleanText),\n/* harmony export */   convertSpeechToText: () => (/* binding */ convertSpeechToText),\n/* harmony export */   extractAudio: () => (/* binding */ extractAudio),\n/* harmony export */   getAudioDuration: () => (/* binding */ getAudioDuration),\n/* harmony export */   getAudioFileUrl: () => (/* binding */ getAudioFileUrl),\n/* harmony export */   getFFmpegVersion: () => (/* binding */ getFFmpegVersion),\n/* harmony export */   processVideo: () => (/* binding */ processVideo)\n/* harmony export */ });\n/* harmony import */ var child_process__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! child_process */ \"child_process\");\n/* harmony import */ var child_process__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(child_process__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var openai__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! openai */ \"openai\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_4__);\n/* harmony import */ var fluent_ffmpeg__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! fluent-ffmpeg */ \"fluent-ffmpeg\");\n/* harmony import */ var fluent_ffmpeg__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(fluent_ffmpeg__WEBPACK_IMPORTED_MODULE_5__);\n/* harmony import */ var _ffmpeg_installer_ffmpeg__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @ffmpeg-installer/ffmpeg */ \"@ffmpeg-installer/ffmpeg\");\n/* harmony import */ var _ffmpeg_installer_ffmpeg__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(_ffmpeg_installer_ffmpeg__WEBPACK_IMPORTED_MODULE_6__);\n/* harmony import */ var _ffprobe_installer_ffprobe__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @ffprobe-installer/ffprobe */ \"@ffprobe-installer/ffprobe\");\n/* harmony import */ var _ffprobe_installer_ffprobe__WEBPACK_IMPORTED_MODULE_7___default = /*#__PURE__*/__webpack_require__.n(_ffprobe_installer_ffprobe__WEBPACK_IMPORTED_MODULE_7__);\n/* harmony import */ var util__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! util */ \"util\");\n/* harmony import */ var util__WEBPACK_IMPORTED_MODULE_8___default = /*#__PURE__*/__webpack_require__.n(util__WEBPACK_IMPORTED_MODULE_8__);\n/* harmony import */ var _database__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./database */ \"(api)/./utils/database.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([openai__WEBPACK_IMPORTED_MODULE_3__]);\nopenai__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n\n\n\n\n\n\n\nconst openai = new openai__WEBPACK_IMPORTED_MODULE_3__[\"default\"]({\n    apiKey: process.env.OPENAI_API_KEY,\n    baseURL: \"https://api.openai-hub.com/v1\"\n});\nconst mongoUri = process.env.MONGODB_URI;\nif (!mongoUri) {\n    console.error(\"MONGODB_URI is not defined in the environment variables\");\n    process.exit(1);\n}\nconsole.log(\"MongoDB URI:\", mongoUri);\nlet mongoClient = null;\nasync function getMongoClient() {\n    if (!mongoUri) {\n        throw new Error(\"MONGODB_URI is not defined\");\n    }\n    if (!mongoClient) {\n        try {\n            mongoClient = new mongodb__WEBPACK_IMPORTED_MODULE_4__.MongoClient(mongoUri);\n            await mongoClient.connect();\n            console.log(\"Connected successfully to MongoDB\");\n        } catch (error) {\n            console.error(\"Failed to connect to MongoDB:\", error);\n            throw error;\n        }\n    }\n    return mongoClient;\n}\nfunction runCommand(command) {\n    return new Promise((resolve, reject)=>{\n        (0,child_process__WEBPACK_IMPORTED_MODULE_0__.exec)(command, {\n            encoding: \"utf8\"\n        }, (error, stdout, stderr)=>{\n            if (error) {\n                console.error(`Error executing command: ${command}`);\n                console.error(`Error: ${error}`);\n                console.error(`stderr: ${stderr}`);\n                reject(error);\n            } else {\n                resolve(stdout);\n            }\n        });\n    });\n}\nasync function processVideo(filePath) {\n    try {\n        // 1. 音频分离\n        const audioFile = await extractAudio(filePath);\n        // 2. 音频转文本\n        const textContent = await convertSpeechToText(audioFile);\n        // 3. 文本清洗\n        const cleanedText = await cleanText(textContent);\n        // 4. 文本存储\n        await storeText([\n            cleanedText\n        ]);\n        // 5. 高级分析\n        const analysisResult = await performAdvancedAnalysis([\n            cleanedText\n        ]);\n        return analysisResult;\n    } catch (error) {\n        console.error(\"Error in video processing:\", error);\n        throw error;\n    }\n}\nfunction extractAudio(videoPath) {\n    return new Promise((resolve, reject)=>{\n        const outputDir = path__WEBPACK_IMPORTED_MODULE_2___default().join(process.cwd(), \"public\", \"audio\");\n        if (!fs__WEBPACK_IMPORTED_MODULE_1___default().existsSync(outputDir)) {\n            fs__WEBPACK_IMPORTED_MODULE_1___default().mkdirSync(outputDir, {\n                recursive: true\n            });\n        }\n        const outputPath = path__WEBPACK_IMPORTED_MODULE_2___default().join(outputDir, `${path__WEBPACK_IMPORTED_MODULE_2___default().basename(videoPath, \".mp4\")}.mp3`);\n        console.log(\"Input video path:\", videoPath);\n        console.log(\"Output audio path:\", outputPath);\n        fluent_ffmpeg__WEBPACK_IMPORTED_MODULE_5___default()(videoPath).outputOptions(\"-vn\").audioCodec(\"libmp3lame\").audioChannels(2).audioBitrate(\"192k\").output(outputPath).on(\"end\", async ()=>{\n            console.log(\"Audio extraction completed:\", outputPath);\n            try {\n                const { db } = await (0,_database__WEBPACK_IMPORTED_MODULE_9__.connectToDatabase)();\n                const collection = db.collection(\"audio_files\");\n                const duration = await getAudioDuration(outputPath);\n                await collection.insertOne({\n                    name: path__WEBPACK_IMPORTED_MODULE_2___default().basename(outputPath),\n                    size: fs__WEBPACK_IMPORTED_MODULE_1___default().statSync(outputPath).size,\n                    createdAt: new Date(),\n                    path: outputPath,\n                    originalVideo: path__WEBPACK_IMPORTED_MODULE_2___default().basename(videoPath),\n                    duration: duration,\n                    transcriptionStatus: \"not_transcribed\"\n                });\n                resolve(outputPath);\n            } catch (error) {\n                console.error(\"Error saving audio file info to database:\", error);\n                reject(error);\n            }\n        }).on(\"error\", (err)=>{\n            console.error(\"Error during audio extraction:\", err);\n            reject(err);\n        }).run();\n    });\n}\nasync function convertSpeechToText(audioFile, progressCallback) {\n    try {\n        const audioPath = path__WEBPACK_IMPORTED_MODULE_2___default().join(process.cwd(), \"public\", \"audio\", audioFile);\n        if (!fs__WEBPACK_IMPORTED_MODULE_1___default().existsSync(audioPath)) {\n            throw new Error(`Audio file not found: ${audioPath}`);\n        }\n        // 模拟转录进度\n        for(let i = 0; i <= 100; i += 10){\n            await new Promise((resolve)=>setTimeout(resolve, 500)); // 每0.5秒更新一次进度\n            progressCallback && progressCallback(i);\n        }\n        const response = await openai.audio.transcriptions.create({\n            file: fs__WEBPACK_IMPORTED_MODULE_1___default().createReadStream(audioPath),\n            model: \"whisper-1\"\n        });\n        const transcription = response.text;\n        // 保存转录文本为 txt 文件\n        const txtFilePath = audioPath.replace(\".mp3\", \".txt\");\n        await fs__WEBPACK_IMPORTED_MODULE_1__.promises.writeFile(txtFilePath, transcription, \"utf-8\");\n        console.log(\"Transcription saved to:\", txtFilePath);\n        return transcription;\n    } catch (error) {\n        console.error(\"Error in speech to text conversion:\", error);\n        throw error;\n    }\n}\nasync function cleanText(text) {\n    // 这里可以实现文本清洗的逻辑\n    // 例如：移除特殊字符，纠正常见错误等\n    let cleanedText = text.replace(/[^\\w\\s.,?!]/g, \"\");\n    cleanedText = cleanedText.replace(/\\s+/g, \" \").trim();\n    return cleanedText;\n}\nasync function storeText(texts) {\n    const client = await getMongoClient();\n    try {\n        const db = client.db(\"video_analysis\");\n        const collection = db.collection(\"transcripts\");\n        await collection.insertMany(texts.map((text)=>({\n                content: text\n            })));\n        console.log(\"Texts stored successfully in MongoDB\");\n    } catch (error) {\n        console.error(\"Error storing texts in MongoDB:\", error);\n        throw error;\n    }\n}\nasync function performAdvancedAnalysis(texts) {\n    return {\n        analysis: \"Sample analysis result\"\n    };\n}\nasync function getAudioDuration(filePath) {\n    return new Promise((resolve, reject)=>{\n        fluent_ffmpeg__WEBPACK_IMPORTED_MODULE_5___default().ffprobe(filePath, (err, metadata)=>{\n            if (err) {\n                reject(err);\n                return;\n            }\n            const durationInSeconds = metadata.format.duration;\n            resolve(durationInSeconds);\n        });\n    });\n}\nasync function checkFFmpeg() {\n    try {\n        const getAvailableFormats = (0,util__WEBPACK_IMPORTED_MODULE_8__.promisify)((fluent_ffmpeg__WEBPACK_IMPORTED_MODULE_5___default().getAvailableFormats));\n        await getAvailableFormats();\n        console.log(\"FFmpeg is available\");\n        return true;\n    } catch (error) {\n        console.error(\"Error checking FFmpeg:\", error);\n        return false;\n    }\n}\nasync function getFFmpegVersion() {\n    try {\n        const getAvailableCodecs = (0,util__WEBPACK_IMPORTED_MODULE_8__.promisify)((fluent_ffmpeg__WEBPACK_IMPORTED_MODULE_5___default().getAvailableCodecs));\n        const getAvailableEncoders = (0,util__WEBPACK_IMPORTED_MODULE_8__.promisify)((fluent_ffmpeg__WEBPACK_IMPORTED_MODULE_5___default().getAvailableEncoders));\n        const codecs = await getAvailableCodecs();\n        const encoders = await getAvailableEncoders();\n        return `FFmpeg version: available (codecs: ${Object.keys(codecs).length}, encoders: ${Object.keys(encoders).length})`;\n    } catch (error) {\n        console.error(\"Error getting FFmpeg version:\", error);\n        return \"FFmpeg version: unavailable\";\n    }\n}\nfluent_ffmpeg__WEBPACK_IMPORTED_MODULE_5___default().setFfmpegPath((_ffmpeg_installer_ffmpeg__WEBPACK_IMPORTED_MODULE_6___default().path));\nfluent_ffmpeg__WEBPACK_IMPORTED_MODULE_5___default().setFfprobePath((_ffprobe_installer_ffprobe__WEBPACK_IMPORTED_MODULE_7___default().path));\nasync function getAudioFileUrl(filename) {\n    // 检查多个可能的路径\n    const possiblePaths = [\n        path__WEBPACK_IMPORTED_MODULE_2___default().join(process.cwd(), \"download\", \"mp3\", filename),\n        path__WEBPACK_IMPORTED_MODULE_2___default().join(process.cwd(), \"public\", \"audio\", filename),\n        path__WEBPACK_IMPORTED_MODULE_2___default().join(process.cwd(), \"public\", \"uploads\", filename)\n    ];\n    for (const filePath of possiblePaths){\n        console.log(\"Checking for audio file at:\", filePath);\n        if (fs__WEBPACK_IMPORTED_MODULE_1___default().existsSync(filePath)) {\n            console.log(\"Audio file found at:\", filePath);\n            // 返回相对于公共目录的路径\n            return `/audio/${encodeURIComponent(filename)}`;\n        }\n    }\n    console.error(\"Audio file not found:\", filename);\n    console.error(\"Checked paths:\", possiblePaths);\n    throw new Error(`Audio file not found: ${filename}`);\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QyxHQUFHLElBQUksVUFBVSxTQUFTa0U7UUFDNUNsSCxnREFBUyxDQUFDWSxRQUFRb0MsR0FBRyxJQUFJLFVBQVUsV0FBV2tFO0tBQy9DO0lBRUQsS0FBSyxNQUFNL0UsWUFBWWdGLGNBQWU7UUFDcENqRyxRQUFRRyxHQUFHLENBQUMsK0JBQStCYztRQUMzQyxJQUFJcEMsb0RBQWEsQ0FBQ29DLFdBQVc7WUFDM0JqQixRQUFRRyxHQUFHLENBQUMsd0JBQXdCYztZQUNwQyxlQUFlO1lBQ2YsT0FBTyxDQUFDLE9BQU8sRUFBRWlGLG1CQUFtQkYsVUFBVSxDQUFDO1FBQ2pEO0lBQ0Y7SUFFQWhHLFFBQVFDLEtBQUssQ0FBQyx5QkFBeUIrRjtJQUN2Q2hHLFFBQVFDLEtBQUssQ0FBQyxrQkFBa0JnRztJQUNoQyxNQUFNLElBQUkzRixNQUFNLENBQUMsc0JBQXNCLEVBQUUwRixTQUFTLENBQUM7QUFDckQiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly92aWRlby1hbmFseXNpcy1zeXN0ZW0vLi91dGlscy92aWRlb1Byb2Nlc3Nvci50cz9kYjlkIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGV4ZWMgfSBmcm9tICdjaGlsZF9wcm9jZXNzJztcbmltcG9ydCBmcyBmcm9tICdmcyc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCBPcGVuQUkgZnJvbSAnb3BlbmFpJztcbmltcG9ydCB7IE1vbmdvQ2xpZW50IH0gZnJvbSAnbW9uZ29kYic7XG5pbXBvcnQgZmZtcGVnIGZyb20gJ2ZsdWVudC1mZm1wZWcnO1xuaW1wb3J0IGZmbXBlZ0luc3RhbGxlciBmcm9tICdAZmZtcGVnLWluc3RhbGxlci9mZm1wZWcnO1xuaW1wb3J0IGZmcHJvYmVJbnN0YWxsZXIgZnJvbSAnQGZmcHJvYmUtaW5zdGFsbGVyL2ZmcHJvYmUnO1xuaW1wb3J0IHsgcHJvbWlzaWZ5IH0gZnJvbSAndXRpbCc7XG5pbXBvcnQgeyBwcm9taXNlcyBhcyBmc1Byb21pc2VzIH0gZnJvbSAnZnMnO1xuaW1wb3J0IHsgY29ubmVjdFRvRGF0YWJhc2UgfSBmcm9tICcuL2RhdGFiYXNlJztcblxuY29uc3Qgb3BlbmFpID0gbmV3IE9wZW5BSSh7XG4gIGFwaUtleTogcHJvY2Vzcy5lbnYuT1BFTkFJX0FQSV9LRVksXG4gIGJhc2VVUkw6ICdodHRwczovL2FwaS5vcGVuYWktaHViLmNvbS92MScsIC8vIOS9v+eUqOaCqOaPkOS+m+eahOiHquWumuS5iSBVUkxcbn0pO1xuXG5jb25zdCBtb25nb1VyaSA9IHByb2Nlc3MuZW52Lk1PTkdPREJfVVJJO1xuaWYgKCFtb25nb1VyaSkge1xuICBjb25zb2xlLmVycm9yKCdNT05HT0RCX1VSSSBpcyBub3QgZGVmaW5lZCBpbiB0aGUgZW52aXJvbm1lbnQgdmFyaWFibGVzJyk7XG4gIHByb2Nlc3MuZXhpdCgxKTtcbn1cblxuY29uc29sZS5sb2coJ01vbmdvREIgVVJJOicsIG1vbmdvVXJpKTtcblxubGV0IG1vbmdvQ2xpZW50OiBNb25nb0NsaWVudCB8IG51bGwgPSBudWxsO1xuXG5hc3luYyBmdW5jdGlvbiBnZXRNb25nb0NsaWVudCgpIHtcbiAgaWYgKCFtb25nb1VyaSkge1xuICAgIHRocm93IG5ldyBFcnJvcignTU9OR09EQl9VUkkgaXMgbm90IGRlZmluZWQnKTtcbiAgfVxuICBpZiAoIW1vbmdvQ2xpZW50KSB7XG4gICAgdHJ5IHtcbiAgICAgIG1vbmdvQ2xpZW50ID0gbmV3IE1vbmdvQ2xpZW50KG1vbmdvVXJpKTtcbiAgICAgIGF3YWl0IG1vbmdvQ2xpZW50LmNvbm5lY3QoKTtcbiAgICAgIGNvbnNvbGUubG9nKCdDb25uZWN0ZWQgc3VjY2Vzc2Z1bGx5IHRvIE1vbmdvREInKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGNvbm5lY3QgdG8gTW9uZ29EQjonLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG1vbmdvQ2xpZW50O1xufVxuXG5mdW5jdGlvbiBydW5Db21tYW5kKGNvbW1hbmQ6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiB7XG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgZXhlYyhjb21tYW5kLCB7IGVuY29kaW5nOiAndXRmOCcgfSwgKGVycm9yLCBzdGRvdXQsIHN0ZGVycikgPT4ge1xuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yIGV4ZWN1dGluZyBjb21tYW5kOiAke2NvbW1hbmR9YCk7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yOiAke2Vycm9yfWApO1xuICAgICAgICBjb25zb2xlLmVycm9yKGBzdGRlcnI6ICR7c3RkZXJyfWApO1xuICAgICAgICByZWplY3QoZXJyb3IpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzb2x2ZShzdGRvdXQpO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHByb2Nlc3NWaWRlbyhmaWxlUGF0aDogc3RyaW5nKSB7XG4gIHRyeSB7XG4gICAgLy8gMS4g6Z+z6aKR5YiG56a7XG4gICAgY29uc3QgYXVkaW9GaWxlID0gYXdhaXQgZXh0cmFjdEF1ZGlvKGZpbGVQYXRoKTtcblxuICAgIC8vIDIuIOmfs+mikei9rOaWh+acrFxuICAgIGNvbnN0IHRleHRDb250ZW50ID0gYXdhaXQgY29udmVydFNwZWVjaFRvVGV4dChhdWRpb0ZpbGUpO1xuXG4gICAgLy8gMy4g5paH5pys5riF5rSXXG4gICAgY29uc3QgY2xlYW5lZFRleHQgPSBhd2FpdCBjbGVhblRleHQodGV4dENvbnRlbnQpO1xuXG4gICAgLy8gNC4g5paH5pys5a2Y5YKoXG4gICAgYXdhaXQgc3RvcmVUZXh0KFtjbGVhbmVkVGV4dF0pO1xuXG4gICAgLy8gNS4g6auY57qn5YiG5p6QXG4gICAgY29uc3QgYW5hbHlzaXNSZXN1bHQgPSBhd2FpdCBwZXJmb3JtQWR2YW5jZWRBbmFseXNpcyhbY2xlYW5lZFRleHRdKTtcblxuICAgIHJldHVybiBhbmFseXNpc1Jlc3VsdDtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiB2aWRlbyBwcm9jZXNzaW5nOicsIGVycm9yKTtcbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZXh0cmFjdEF1ZGlvKHZpZGVvUGF0aDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICBjb25zdCBvdXRwdXREaXIgPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJ3B1YmxpYycsICdhdWRpbycpO1xuICAgIGlmICghZnMuZXhpc3RzU3luYyhvdXRwdXREaXIpKSB7XG4gICAgICBmcy5ta2RpclN5bmMob3V0cHV0RGlyLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcbiAgICB9XG4gICAgY29uc3Qgb3V0cHV0UGF0aCA9IHBhdGguam9pbihvdXRwdXREaXIsIGAke3BhdGguYmFzZW5hbWUodmlkZW9QYXRoLCAnLm1wNCcpfS5tcDNgKTtcbiAgICBcbiAgICBjb25zb2xlLmxvZygnSW5wdXQgdmlkZW8gcGF0aDonLCB2aWRlb1BhdGgpO1xuICAgIGNvbnNvbGUubG9nKCdPdXRwdXQgYXVkaW8gcGF0aDonLCBvdXRwdXRQYXRoKTtcblxuICAgIGZmbXBlZyh2aWRlb1BhdGgpXG4gICAgICAub3V0cHV0T3B0aW9ucygnLXZuJylcbiAgICAgIC5hdWRpb0NvZGVjKCdsaWJtcDNsYW1lJylcbiAgICAgIC5hdWRpb0NoYW5uZWxzKDIpXG4gICAgICAuYXVkaW9CaXRyYXRlKCcxOTJrJylcbiAgICAgIC5vdXRwdXQob3V0cHV0UGF0aClcbiAgICAgIC5vbignZW5kJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZygnQXVkaW8gZXh0cmFjdGlvbiBjb21wbGV0ZWQ6Jywgb3V0cHV0UGF0aCk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgeyBkYiB9ID0gYXdhaXQgY29ubmVjdFRvRGF0YWJhc2UoKTtcbiAgICAgICAgICBjb25zdCBjb2xsZWN0aW9uID0gZGIuY29sbGVjdGlvbignYXVkaW9fZmlsZXMnKTtcbiAgICAgICAgICBjb25zdCBkdXJhdGlvbiA9IGF3YWl0IGdldEF1ZGlvRHVyYXRpb24ob3V0cHV0UGF0aCk7XG4gICAgICAgICAgYXdhaXQgY29sbGVjdGlvbi5pbnNlcnRPbmUoe1xuICAgICAgICAgICAgbmFtZTogcGF0aC5iYXNlbmFtZShvdXRwdXRQYXRoKSxcbiAgICAgICAgICAgIHNpemU6IGZzLnN0YXRTeW5jKG91dHB1dFBhdGgpLnNpemUsXG4gICAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICBwYXRoOiBvdXRwdXRQYXRoLFxuICAgICAgICAgICAgb3JpZ2luYWxWaWRlbzogcGF0aC5iYXNlbmFtZSh2aWRlb1BhdGgpLFxuICAgICAgICAgICAgZHVyYXRpb246IGR1cmF0aW9uLFxuICAgICAgICAgICAgdHJhbnNjcmlwdGlvblN0YXR1czogJ25vdF90cmFuc2NyaWJlZCdcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXNvbHZlKG91dHB1dFBhdGgpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHNhdmluZyBhdWRpbyBmaWxlIGluZm8gdG8gZGF0YWJhc2U6JywgZXJyb3IpO1xuICAgICAgICAgIHJlamVjdChlcnJvcik7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICAub24oJ2Vycm9yJywgKGVycikgPT4ge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBkdXJpbmcgYXVkaW8gZXh0cmFjdGlvbjonLCBlcnIpO1xuICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgIH0pXG4gICAgICAucnVuKCk7XG4gIH0pO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY29udmVydFNwZWVjaFRvVGV4dChhdWRpb0ZpbGU6IHN0cmluZywgcHJvZ3Jlc3NDYWxsYmFjaz86IChwcm9ncmVzczogbnVtYmVyKSA9PiB2b2lkKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBhdWRpb1BhdGggPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJ3B1YmxpYycsICdhdWRpbycsIGF1ZGlvRmlsZSk7XG4gICAgaWYgKCFmcy5leGlzdHNTeW5jKGF1ZGlvUGF0aCkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgQXVkaW8gZmlsZSBub3QgZm91bmQ6ICR7YXVkaW9QYXRofWApO1xuICAgIH1cblxuICAgIC8vIOaooeaLn+i9rOW9lei/m+W6plxuICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IDEwMDsgaSArPSAxMCkge1xuICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDUwMCkpOyAvLyDmr48wLjXnp5Lmm7TmlrDkuIDmrKHov5vluqZcbiAgICAgIHByb2dyZXNzQ2FsbGJhY2sgJiYgcHJvZ3Jlc3NDYWxsYmFjayhpKTtcbiAgICB9XG5cbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IG9wZW5haS5hdWRpby50cmFuc2NyaXB0aW9ucy5jcmVhdGUoe1xuICAgICAgZmlsZTogZnMuY3JlYXRlUmVhZFN0cmVhbShhdWRpb1BhdGgpLFxuICAgICAgbW9kZWw6IFwid2hpc3Blci0xXCIsXG4gICAgfSk7XG4gICAgXG4gICAgY29uc3QgdHJhbnNjcmlwdGlvbiA9IHJlc3BvbnNlLnRleHQ7XG4gICAgXG4gICAgLy8g5L+d5a2Y6L2s5b2V5paH5pys5Li6IHR4dCDmlofku7ZcbiAgICBjb25zdCB0eHRGaWxlUGF0aCA9IGF1ZGlvUGF0aC5yZXBsYWNlKCcubXAzJywgJy50eHQnKTtcbiAgICBhd2FpdCBmc1Byb21pc2VzLndyaXRlRmlsZSh0eHRGaWxlUGF0aCwgdHJhbnNjcmlwdGlvbiwgJ3V0Zi04Jyk7XG4gICAgXG4gICAgY29uc29sZS5sb2coJ1RyYW5zY3JpcHRpb24gc2F2ZWQgdG86JywgdHh0RmlsZVBhdGgpO1xuICAgIHJldHVybiB0cmFuc2NyaXB0aW9uO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIHNwZWVjaCB0byB0ZXh0IGNvbnZlcnNpb246JywgZXJyb3IpO1xuICAgIHRocm93IGVycm9yO1xuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjbGVhblRleHQodGV4dDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgLy8g6L+Z6YeM5Y+v5Lul5a6e546w5paH5pys5riF5rSX55qE6YC76L6RXG4gIC8vIOS+i+Wmgu+8muenu+mZpOeJueauiuWtl+espu+8jOe6oOato+W4uOingemUmeivr+etiVxuICBsZXQgY2xlYW5lZFRleHQgPSB0ZXh0LnJlcGxhY2UoL1teXFx3XFxzLiw/IV0vZywgJycpO1xuICBjbGVhbmVkVGV4dCA9IGNsZWFuZWRUZXh0LnJlcGxhY2UoL1xccysvZywgJyAnKS50cmltKCk7XG4gIHJldHVybiBjbGVhbmVkVGV4dDtcbn1cblxuYXN5bmMgZnVuY3Rpb24gc3RvcmVUZXh0KHRleHRzOiBzdHJpbmdbXSk6IFByb21pc2U8dm9pZD4ge1xuICBjb25zdCBjbGllbnQgPSBhd2FpdCBnZXRNb25nb0NsaWVudCgpO1xuICB0cnkge1xuICAgIGNvbnN0IGRiID0gY2xpZW50LmRiKCd2aWRlb19hbmFseXNpcycpO1xuICAgIGNvbnN0IGNvbGxlY3Rpb24gPSBkYi5jb2xsZWN0aW9uKCd0cmFuc2NyaXB0cycpO1xuICAgIGF3YWl0IGNvbGxlY3Rpb24uaW5zZXJ0TWFueSh0ZXh0cy5tYXAodGV4dCA9PiAoeyBjb250ZW50OiB0ZXh0IH0pKSk7XG4gICAgY29uc29sZS5sb2coJ1RleHRzIHN0b3JlZCBzdWNjZXNzZnVsbHkgaW4gTW9uZ29EQicpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHN0b3JpbmcgdGV4dHMgaW4gTW9uZ29EQjonLCBlcnJvcik7XG4gICAgdGhyb3cgZXJyb3I7XG4gIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gcGVyZm9ybUFkdmFuY2VkQW5hbHlzaXModGV4dHM6IHN0cmluZ1tdKTogUHJvbWlzZTxhbnk+IHtcbiAgcmV0dXJuIHsgYW5hbHlzaXM6IFwiU2FtcGxlIGFuYWx5c2lzIHJlc3VsdFwiIH07XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBdWRpb0R1cmF0aW9uKGZpbGVQYXRoOiBzdHJpbmcpOiBQcm9taXNlPG51bWJlcj4ge1xuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgIGZmbXBlZy5mZnByb2JlKGZpbGVQYXRoLCAoZXJyLCBtZXRhZGF0YSkgPT4ge1xuICAgICAgaWYgKGVycikge1xuICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY29uc3QgZHVyYXRpb25JblNlY29uZHMgPSBtZXRhZGF0YS5mb3JtYXQuZHVyYXRpb247XG4gICAgICByZXNvbHZlKGR1cmF0aW9uSW5TZWNvbmRzKTtcbiAgICB9KTtcbiAgfSk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjaGVja0ZGbXBlZygpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBnZXRBdmFpbGFibGVGb3JtYXRzID0gcHJvbWlzaWZ5KGZmbXBlZy5nZXRBdmFpbGFibGVGb3JtYXRzKTtcbiAgICBhd2FpdCBnZXRBdmFpbGFibGVGb3JtYXRzKCk7XG4gICAgY29uc29sZS5sb2coJ0ZGbXBlZyBpcyBhdmFpbGFibGUnKTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjaGVja2luZyBGRm1wZWc6JywgZXJyb3IpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0RkZtcGVnVmVyc2lvbigpOiBQcm9taXNlPHN0cmluZz4ge1xuICB0cnkge1xuICAgIGNvbnN0IGdldEF2YWlsYWJsZUNvZGVjcyA9IHByb21pc2lmeShmZm1wZWcuZ2V0QXZhaWxhYmxlQ29kZWNzKTtcbiAgICBjb25zdCBnZXRBdmFpbGFibGVFbmNvZGVycyA9IHByb21pc2lmeShmZm1wZWcuZ2V0QXZhaWxhYmxlRW5jb2RlcnMpO1xuICAgIFxuICAgIGNvbnN0IGNvZGVjcyA9IGF3YWl0IGdldEF2YWlsYWJsZUNvZGVjcygpO1xuICAgIGNvbnN0IGVuY29kZXJzID0gYXdhaXQgZ2V0QXZhaWxhYmxlRW5jb2RlcnMoKTtcbiAgICBcbiAgICByZXR1cm4gYEZGbXBlZyB2ZXJzaW9uOiBhdmFpbGFibGUgKGNvZGVjczogJHtPYmplY3Qua2V5cyhjb2RlY3MpLmxlbmd0aH0sIGVuY29kZXJzOiAke09iamVjdC5rZXlzKGVuY29kZXJzKS5sZW5ndGh9KWA7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZ2V0dGluZyBGRm1wZWcgdmVyc2lvbjonLCBlcnJvcik7XG4gICAgcmV0dXJuICdGRm1wZWcgdmVyc2lvbjogdW5hdmFpbGFibGUnO1xuICB9XG59XG5cbmZmbXBlZy5zZXRGZm1wZWdQYXRoKGZmbXBlZ0luc3RhbGxlci5wYXRoKTtcbmZmbXBlZy5zZXRGZnByb2JlUGF0aChmZnByb2JlSW5zdGFsbGVyLnBhdGgpO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0QXVkaW9GaWxlVXJsKGZpbGVuYW1lOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz4ge1xuICAvLyDmo4Dmn6XlpJrkuKrlj6/og73nmoTot6/lvoRcbiAgY29uc3QgcG9zc2libGVQYXRocyA9IFtcbiAgICBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJ2Rvd25sb2FkJywgJ21wMycsIGZpbGVuYW1lKSxcbiAgICBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJ3B1YmxpYycsICdhdWRpbycsIGZpbGVuYW1lKSxcbiAgICBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJ3B1YmxpYycsICd1cGxvYWRzJywgZmlsZW5hbWUpXG4gIF07XG5cbiAgZm9yIChjb25zdCBmaWxlUGF0aCBvZiBwb3NzaWJsZVBhdGhzKSB7XG4gICAgY29uc29sZS5sb2coJ0NoZWNraW5nIGZvciBhdWRpbyBmaWxlIGF0OicsIGZpbGVQYXRoKTtcbiAgICBpZiAoZnMuZXhpc3RzU3luYyhmaWxlUGF0aCkpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdBdWRpbyBmaWxlIGZvdW5kIGF0OicsIGZpbGVQYXRoKTtcbiAgICAgIC8vIOi/lOWbnuebuOWvueS6juWFrOWFseebruW9leeahOi3r+W+hFxuICAgICAgcmV0dXJuIGAvYXVkaW8vJHtlbmNvZGVVUklDb21wb25lbnQoZmlsZW5hbWUpfWA7XG4gICAgfVxuICB9XG5cbiAgY29uc29sZS5lcnJvcignQXVkaW8gZmlsZSBub3QgZm91bmQ6JywgZmlsZW5hbWUpO1xuICBjb25zb2xlLmVycm9yKCdDaGVja2VkIHBhdGhzOicsIHBvc3NpYmxlUGF0aHMpO1xuICB0aHJvdyBuZXcgRXJyb3IoYEF1ZGlvIGZpbGUgbm90IGZvdW5kOiAke2ZpbGVuYW1lfWApO1xufVxuIl0sIm5hbWVzIjpbImV4ZWMiLCJmcyIsInBhdGgiLCJPcGVuQUkiLCJNb25nb0NsaWVudCIsImZmbXBlZyIsImZmbXBlZ0luc3RhbGxlciIsImZmcHJvYmVJbnN0YWxsZXIiLCJwcm9taXNpZnkiLCJwcm9taXNlcyIsImZzUHJvbWlzZXMiLCJjb25uZWN0VG9EYXRhYmFzZSIsIm9wZW5haSIsImFwaUtleSIsInByb2Nlc3MiLCJlbnYiLCJPUEVOQUlfQVBJX0tFWSIsImJhc2VVUkwiLCJtb25nb1VyaSIsIk1PTkdPREJfVVJJIiwiY29uc29sZSIsImVycm9yIiwiZXhpdCIsImxvZyIsIm1vbmdvQ2xpZW50IiwiZ2V0TW9uZ29DbGllbnQiLCJFcnJvciIsImNvbm5lY3QiLCJydW5Db21tYW5kIiwiY29tbWFuZCIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiZW5jb2RpbmciLCJzdGRvdXQiLCJzdGRlcnIiLCJwcm9jZXNzVmlkZW8iLCJmaWxlUGF0aCIsImF1ZGlvRmlsZSIsImV4dHJhY3RBdWRpbyIsInRleHRDb250ZW50IiwiY29udmVydFNwZWVjaFRvVGV4dCIsImNsZWFuZWRUZXh0IiwiY2xlYW5UZXh0Iiwic3RvcmVUZXh0IiwiYW5hbHlzaXNSZXN1bHQiLCJwZXJmb3JtQWR2YW5jZWRBbmFseXNpcyIsInZpZGVvUGF0aCIsIm91dHB1dERpciIsImpvaW4iLCJjd2QiLCJleGlzdHNTeW5jIiwibWtkaXJTeW5jIiwicmVjdXJzaXZlIiwib3V0cHV0UGF0aCIsImJhc2VuYW1lIiwib3V0cHV0T3B0aW9ucyIsImF1ZGlvQ29kZWMiLCJhdWRpb0NoYW5uZWxzIiwiYXVkaW9CaXRyYXRlIiwib3V0cHV0Iiwib24iLCJkYiIsImNvbGxlY3Rpb24iLCJkdXJhdGlvbiIsImdldEF1ZGlvRHVyYXRpb24iLCJpbnNlcnRPbmUiLCJuYW1lIiwic2l6ZSIsInN0YXRTeW5jIiwiY3JlYXRlZEF0IiwiRGF0ZSIsIm9yaWdpbmFsVmlkZW8iLCJ0cmFuc2NyaXB0aW9uU3RhdHVzIiwiZXJyIiwicnVuIiwicHJvZ3Jlc3NDYWxsYmFjayIsImF1ZGlvUGF0aCIsImkiLCJzZXRUaW1lb3V0IiwicmVzcG9uc2UiLCJhdWRpbyIsInRyYW5zY3JpcHRpb25zIiwiY3JlYXRlIiwiZmlsZSIsImNyZWF0ZVJlYWRTdHJlYW0iLCJtb2RlbCIsInRyYW5zY3JpcHRpb24iLCJ0ZXh0IiwidHh0RmlsZVBhdGgiLCJyZXBsYWNlIiwid3JpdGVGaWxlIiwidHJpbSIsInRleHRzIiwiY2xpZW50IiwiaW5zZXJ0TWFueSIsIm1hcCIsImNvbnRlbnQiLCJhbmFseXNpcyIsImZmcHJvYmUiLCJtZXRhZGF0YSIsImR1cmF0aW9uSW5TZWNvbmRzIiwiZm9ybWF0IiwiY2hlY2tGRm1wZWciLCJnZXRBdmFpbGFibGVGb3JtYXRzIiwiZ2V0RkZtcGVnVmVyc2lvbiIsImdldEF2YWlsYWJsZUNvZGVjcyIsImdldEF2YWlsYWJsZUVuY29kZXJzIiwiY29kZWNzIiwiZW5jb2RlcnMiLCJPYmplY3QiLCJrZXlzIiwibGVuZ3RoIiwic2V0RmZtcGVnUGF0aCIsInNldEZmcHJvYmVQYXRoIiwiZ2V0QXVkaW9GaWxlVXJsIiwiZmlsZW5hbWUiLCJwb3NzaWJsZVBhdGhzIiwiZW5jb2RlVVJJQ29tcG9uZW50Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./utils/videoProcessor.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = (__webpack_exec__("(api)/./pages/api/files/[action].ts"));
module.exports = __webpack_exports__;

})();